[{"id":"b02cdf3a.5d46e","type":"tab","label":"Central system","disabled":false,"info":""},{"id":"dea130da.51821","type":"tab","label":"Warehouse","disabled":false,"info":""},{"id":"4e6fdd47.e9b2b4","type":"tab","label":"Scanner RFID","disabled":false,"info":""},{"id":"dcdaf8f4.e91878","type":"tab","label":"Vehicle","disabled":false,"info":""},{"id":"b1c7abcb.eb6ad8","type":"tab","label":"Vehicle simulation","disabled":false,"info":""},{"id":"176e4c69.a78804","type":"subflow","name":"Check Read Error","info":"","in":[{"x":100,"y":220,"wires":[{"id":"76cd714.0b25b9"}]}],"out":[{"x":760,"y":320,"wires":[{"id":"894ac093.18cb1","port":1}]}]},{"id":"37dfc7a4.d17a78","type":"subflow","name":"Check Write Error","info":"","in":[{"x":50,"y":30,"wires":[{"id":"ee46d402.5a10c8"}]}],"out":[{"x":680,"y":240,"wires":[{"id":"a315c81d.080f08","port":1}]}]},{"id":"aa4b2613.717028","type":"subflow","name":"Check find DB error","info":"","in":[{"x":220,"y":160,"wires":[{"id":"75c5d1fe.1ecde"}]}],"out":[{"x":580,"y":260,"wires":[{"id":"1832147b.682a4c","port":0}]},{"x":580,"y":140,"wires":[{"id":"75c5d1fe.1ecde","port":0}]}]},{"id":"f16fa519.d79ca8","type":"subflow","name":"Check find DB error (2)","info":"","in":[{"x":220,"y":160,"wires":[{"id":"f600a2f8.72ef3"}]}],"out":[{"x":580,"y":260,"wires":[{"id":"7d3390c0.4c924","port":0}]},{"x":580,"y":140,"wires":[{"id":"f600a2f8.72ef3","port":0}]}]},{"id":"8c5719d3.6d6278","type":"subflow","name":"Get waypoints","info":"","in":[{"x":53,"y":95,"wires":[{"id":"29967fc1.18538"}]}],"out":[{"x":950,"y":94,"wires":[{"id":"87c3e0cd.abc19","port":0}]}]},{"id":"fb60b192.47c6a","type":"subflow","name":"Check Vehicle Error ","info":"","in":[{"x":50,"y":30,"wires":[{"id":"5ac01d3c.d6be84"}]}],"out":[{"x":740,"y":120,"wires":[{"id":"a58be731.803e48","port":"0"}]},{"x":740,"y":195,"wires":[{"id":"a58be731.803e48","port":1}]}]},{"id":"785d99ff.c78688","type":"subflow","name":"Check Vehicle Error  (2)","info":"","in":[{"x":50,"y":30,"wires":[{"id":"3c602bc2.951e14"}]}],"out":[{"x":740,"y":120,"wires":[{"id":"fc364e0e.a5fed","port":"0"}]},{"x":740,"y":195,"wires":[{"id":"fc364e0e.a5fed","port":1}]}]},{"id":"4b28b945.1a1528","type":"mqtt-broker","z":"","broker":"localhost","port":"1883","clientid":"","usetls":false,"compatmode":true,"keepalive":"60","cleansession":true,"birthTopic":"test","birthQos":"0","birthPayload":"start","willTopic":"test","willQos":"0","willPayload":""},{"id":"a25aeb8e.472a18","type":"mongodb3","z":"b02cdf3a.5d46e","uri":"mongodb://localhost/eshipping","name":"MongoLocal","options":"","parallelism":"-1"},{"id":"f5308fa.c5c517","type":"ui_group","z":"b02cdf3a.5d46e","name":"Commands","tab":"57f4e0a4.0bb14","order":1,"disp":true,"width":"6","collapse":false},{"id":"f3ba5adc.cff538","type":"mqtt-broker","z":"","broker":"localhost","port":"1883","clientid":"","usetls":false,"compatmode":true,"keepalive":"60","cleansession":true,"birthTopic":"test","birthQos":"0","birthPayload":"start","willTopic":"test","willQos":"0","willPayload":""},{"id":"9a7edbcb.ffc6a8","type":"mqtt-broker","z":"","broker":"localhost","port":"1883","clientid":"","usetls":false,"compatmode":true,"keepalive":"60","cleansession":true,"birthTopic":"test","birthQos":"0","birthPayload":"start","willTopic":"test","willQos":"0","willPayload":""},{"id":"5ac4dda0.055f24","type":"mqtt-broker","z":"","broker":"localhost","port":"1883","clientid":"","usetls":false,"compatmode":true,"keepalive":"60","cleansession":true,"birthTopic":"test","birthQos":"0","birthPayload":"start","willTopic":"test","willQos":"0","willPayload":""},{"id":"ab8ddb21.b751b8","type":"mqtt-broker","z":"","broker":"localhost","port":"1883","clientid":"","usetls":false,"compatmode":true,"keepalive":"60","cleansession":true,"birthTopic":"test","birthQos":"0","birthPayload":"start","willTopic":"test","willQos":"0","willPayload":""},{"id":"43e7c7ae.b5cf18","type":"mqtt-broker","z":"","broker":"localhost","port":"1883","clientid":"","usetls":false,"compatmode":true,"keepalive":"60","cleansession":true,"birthTopic":"test","birthQos":"0","birthPayload":"start","willTopic":"test","willQos":"0","willPayload":""},{"id":"23785252.1b673e","type":"mqtt-broker","z":"","broker":"localhost","port":"1883","clientid":"","usetls":false,"compatmode":true,"keepalive":"60","cleansession":true,"birthTopic":"test","birthQos":"0","birthPayload":"start","willTopic":"test","willQos":"0","willPayload":""},{"id":"b78f2004.bdddb","type":"mqtt-broker","z":"","broker":"localhost","port":"1883","clientid":"","usetls":false,"compatmode":true,"keepalive":"60","cleansession":true,"birthTopic":"test","birthQos":"0","birthPayload":"start","willTopic":"test","willQos":"0","willPayload":""},{"id":"d76d5071.9a24d","type":"mqtt-broker","z":"","name":"","broker":"localhost","port":"1883","clientid":"","usetls":false,"compatmode":true,"keepalive":"60","cleansession":true,"birthTopic":"test","birthQos":"0","birthRetain":"false","birthPayload":"start","willTopic":"test","willQos":"0","willRetain":"false","willPayload":""},{"id":"1f3fc10b.635fef","type":"mqtt-broker","z":"","broker":"localhost","port":"1883","clientid":"","usetls":false,"compatmode":true,"keepalive":"60","cleansession":true,"birthTopic":"test","birthQos":"0","birthPayload":"start","willTopic":"test","willQos":"0","willPayload":""},{"id":"4ef22acf.5c8814","type":"mongodb3","z":"","uri":"mongodb://localhost/eshipping","name":"MongoLocal","options":"","parallelism":"-1"},{"id":"a4d02af7.c60f58","type":"ui_group","z":"","name":"Commands","tab":"f6616f3c.f6e73","order":1,"disp":true,"width":"6","collapse":false},{"id":"80474ea8.9a951","type":"mqtt-broker","z":"","broker":"localhost","port":"1883","clientid":"","usetls":false,"compatmode":true,"keepalive":"60","cleansession":true,"birthTopic":"test","birthQos":"0","birthPayload":"start","willTopic":"test","willQos":"0","willPayload":""},{"id":"63ce6e83.8ba4e","type":"ui_group","z":"","name":"Vehicle 000","tab":"49fe2034.0ab4d","order":1,"disp":true,"width":"5","collapse":true},{"id":"9706cd08.73513","type":"ui_group","z":"","name":"Vehicle 001","tab":"49fe2034.0ab4d","order":2,"disp":true,"width":"5","collapse":true},{"id":"76b5e9ae.5e5068","type":"ui_group","z":"","name":"Vehicle 002","tab":"49fe2034.0ab4d","order":3,"disp":true,"width":"5","collapse":true},{"id":"5b5979ba.325888","type":"ui_group","z":"","name":"Vehicle 003","tab":"49fe2034.0ab4d","order":4,"disp":true,"width":"5","collapse":true},{"id":"9cc32162.f807e","type":"ui_group","z":"","name":"Vehicle 004","tab":"49fe2034.0ab4d","order":5,"disp":true,"width":"5","collapse":true},{"id":"6dbdbf4b.b9cc4","type":"ui_group","z":"","name":"Vehicles position","tab":"f6616f3c.f6e73","order":2,"disp":true,"width":"20","collapse":false},{"id":"3da3ef80.285e1","type":"ui_group","z":"","name":"Commands","tab":"c7f78bd3.56bac8","order":1,"disp":true,"width":"6","collapse":false},{"id":"a0b5d56f.745558","type":"ui_group","z":"","name":"Alarms","tab":"c7f78bd3.56bac8","order":3,"disp":true,"width":"6","collapse":false},{"id":"a5086385.6031e","type":"ui_group","z":"","name":"Products","tab":"c7f78bd3.56bac8","order":2,"disp":true,"width":"6","collapse":false},{"id":"5a236ca9.ae3bd4","type":"mongodb3","z":"","uri":"mongodb://localhost/eshipping","name":"MongoLocal","options":"","parallelism":"-1"},{"id":"77beb897.a26738","type":"ui_group","z":"","name":"Delivery Types","tab":"c7f78bd3.56bac8","order":4,"disp":true,"width":"6","collapse":false},{"id":"f6616f3c.f6e73","type":"ui_tab","z":"","name":"HOME","icon":"dashboard","order":1},{"id":"49fe2034.0ab4d","type":"ui_tab","z":"","name":"VEHICLES","icon":"dashboard","order":2},{"id":"c7f78bd3.56bac8","type":"ui_tab","z":"","name":"DATABASE","icon":"dashboard","order":2},{"id":"7e40374f.4607e8","type":"mqtt-broker","z":"","broker":"localhost","port":"1883","clientid":"","usetls":false,"compatmode":true,"keepalive":"60","cleansession":true,"birthTopic":"test","birthQos":"0","birthPayload":"start","willTopic":"test","willQos":"0","willPayload":""},{"id":"c237b681.3e8028","type":"mongodb3","z":"","uri":"mongodb://localhost/eshipping","name":"MongoLocal","options":"","parallelism":"-1"},{"id":"1b2b9aa3.dd8225","type":"mqtt-broker","z":"","broker":"localhost","port":"1883","clientid":"","usetls":false,"compatmode":true,"keepalive":"60","cleansession":true,"birthTopic":"test","birthQos":"0","birthPayload":"start","willTopic":"test","willQos":"0","willPayload":""},{"id":"1cf99f41.c3c031","type":"mqtt-broker","z":"","name":"","broker":"localhost","port":"1883","clientid":"","usetls":false,"compatmode":true,"keepalive":"60","cleansession":true,"birthTopic":"test","birthQos":"0","birthRetain":"false","birthPayload":"start","willTopic":"test","willQos":"0","willRetain":"false","willPayload":""},{"id":"552f4d84.0e9b84","type":"mqtt-broker","z":"","broker":"localhost","port":"1883","clientid":"","usetls":false,"compatmode":true,"keepalive":"60","cleansession":true,"birthTopic":"test","birthQos":"0","birthPayload":"start","willTopic":"test","willQos":"0","willPayload":""},{"id":"737ce9f5.5b77d8","type":"mqtt-broker","z":"","name":"","broker":"localhost","port":"1883","clientid":"","usetls":false,"compatmode":true,"keepalive":"60","cleansession":true,"birthTopic":"test","birthQos":"0","birthRetain":"false","birthPayload":"start","willTopic":"test","willQos":"0","willRetain":"false","willPayload":""},{"id":"3434a624.97253a","type":"mqtt-broker","z":"","broker":"localhost","port":"1883","clientid":"","usetls":false,"compatmode":true,"keepalive":"60","cleansession":true,"birthTopic":"test","birthQos":"0","birthPayload":"start","willTopic":"test","willQos":"0","willPayload":""},{"id":"7fcb248.85cd9dc","type":"ui_base","theme":{"name":"theme-light","lightTheme":{"default":"#0094CE","baseColor":"#0094CE","baseFont":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif","edited":true,"reset":false},"darkTheme":{"default":"#097479","baseColor":"#097479","baseFont":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif","edited":false},"customTheme":{"name":"Untitled Theme 1","default":"#4B7930","baseColor":"#4B7930","baseFont":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif"},"themeState":{"base-color":{"default":"#0094CE","value":"#0094CE","edited":false},"page-titlebar-backgroundColor":{"value":"#0094CE","edited":false},"page-backgroundColor":{"value":"#fafafa","edited":false},"page-sidebar-backgroundColor":{"value":"#ffffff","edited":false},"group-textColor":{"value":"#1bbfff","edited":false},"group-borderColor":{"value":"#ffffff","edited":false},"group-backgroundColor":{"value":"#ffffff","edited":false},"widget-textColor":{"value":"#111111","edited":false},"widget-backgroundColor":{"value":"#0094ce","edited":false},"widget-borderColor":{"value":"#ffffff","edited":false},"base-font":{"value":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif"}}},"site":{"name":"Node-RED Dashboard","hideToolbar":"false","allowSwipe":"false","allowTempTheme":"true","dateFormat":"DD/MM/YYYY","sizes":{"sx":45,"sy":40,"gx":6,"gy":6,"cx":3,"cy":3,"px":10,"py":10}}},{"id":"f1c0ea0.e6b3818","type":"function","z":"b02cdf3a.5d46e","name":"find_products_TOSELL_query","func":"msg.operation=\"find.toArray\";\nmsg.payload={\"status\" : \"TOSELL\"};\nreturn msg;","outputs":1,"noerr":0,"x":310,"y":180,"wires":[["3ec41f94.0d3c7"]]},{"id":"20fa3a2a.c7be16","type":"function","z":"b02cdf3a.5d46e","name":"read_answer","func":"var array = msg.payload;\nvar arrayLength = array.length;\n\nif(arrayLength === 0){\n    msg.payload = \"ERROR no_products_to_sell\"\n}\n\nreturn msg;","outputs":1,"noerr":0,"x":470,"y":308,"wires":[["203ad87e.3bcf08"]]},{"id":"87020f6d.7c3b4","type":"comment","z":"b02cdf3a.5d46e","name":"Notify a delivey to the warehouse","info":"","x":170,"y":60,"wires":[]},{"id":"79e2452d.e3422c","type":"mqtt out","z":"b02cdf3a.5d46e","name":"eshipping/warehouse/toDeliver","topic":"eshipping/warehouse/toDeliver","qos":"2","retain":"","broker":"4b28b945.1a1528","x":870,"y":500,"wires":[]},{"id":"203ad87e.3bcf08","type":"switch","z":"b02cdf3a.5d46e","name":"","property":"payload","propertyType":"msg","rules":[{"t":"istype","v":"string","vt":"string"},{"t":"istype","v":"array","vt":"array"}],"checkall":"true","repair":false,"outputs":2,"x":552,"y":366,"wires":[["94edfa09.3f9a58"],["584e82fe.791bdc"]]},{"id":"584e82fe.791bdc","type":"function","z":"b02cdf3a.5d46e","name":"take_random_product","func":"var array = msg.payload;\nvar arrayLength = array.length;\n\nvar n = getRandomArbitrary(0,arrayLength);\nmsg.payload = array[n];\n\nreturn msg;\n\nfunction getRandomArbitrary(min,max){\n    return Math.floor(Math.random()*(max));\n}","outputs":1,"noerr":0,"x":674,"y":432,"wires":[["79e2452d.e3422c"]]},{"id":"94edfa09.3f9a58","type":"mqtt out","z":"b02cdf3a.5d46e","name":"eshipping/warehouse/error","topic":"eshipping/warehouse/error","qos":"2","retain":"","broker":"4b28b945.1a1528","x":783,"y":324,"wires":[]},{"id":"3ec41f94.0d3c7","type":"mongodb3 in","z":"b02cdf3a.5d46e","service":"_ext_","configNode":"4ef22acf.5c8814","name":"E-Shipping DB","collection":"products","operation":"","x":410,"y":240,"wires":[["20fa3a2a.c7be16"]]},{"id":"7b9a5e5f.52c2f","type":"ui_button","z":"b02cdf3a.5d46e","name":"","group":"a4d02af7.c60f58","order":1,"width":"0","height":"0","passthru":false,"label":"Notify purchase","color":"","bgcolor":"","icon":"","payload":"","payloadType":"str","topic":"","x":120,"y":120,"wires":[["f1c0ea0.e6b3818"]]},{"id":"66585f23.e0691","type":"mqtt out","z":"176e4c69.a78804","name":"scannerRFID/error","topic":"eshipping/scannerRFID/error","qos":"2","retain":"","broker":"f3ba5adc.cff538","x":870,"y":220,"wires":[]},{"id":"7cd0a1f7.480f9","type":"function","z":"176e4c69.a78804","name":"Manage Error","func":"msg.payload = msg.payload.message; \n\nreturn msg;","outputs":1,"noerr":0,"x":640,"y":220,"wires":[["66585f23.e0691"]]},{"id":"894ac093.18cb1","type":"switch","z":"176e4c69.a78804","name":"","property":"payload.answer","propertyType":"msg","rules":[{"t":"eq","v":"ERROR","vt":"str"},{"t":"eq","v":"OK","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":410,"y":220,"wires":[["7cd0a1f7.480f9"],[]]},{"id":"76cd714.0b25b9","type":"function","z":"176e4c69.a78804","name":"Check","func":"var string = msg.payload.toString(\"utf8\");\nvar splitted = string.split(\" \");\nmsg.payload = {};\nmsg.payload.answer = splitted[0];\nmsg.payload.message = splitted[1];\n\nreturn msg;","outputs":1,"noerr":0,"x":260,"y":220,"wires":[["894ac093.18cb1"]]},{"id":"4bf313a5.17dfcc","type":"mqtt out","z":"37dfc7a4.d17a78","name":"scannerRFID/error","topic":"eshipping/scannerRFID/error","qos":"2","retain":"","broker":"f3ba5adc.cff538","x":830,"y":160,"wires":[]},{"id":"d88a6332.2c6b5","type":"function","z":"37dfc7a4.d17a78","name":"Manage Error","func":"msg.payload = msg.payload.message; \nreturn msg;","outputs":1,"noerr":0,"x":600,"y":160,"wires":[["4bf313a5.17dfcc"]]},{"id":"a315c81d.080f08","type":"switch","z":"37dfc7a4.d17a78","name":"","property":"payload.answer","propertyType":"msg","rules":[{"t":"eq","v":"ERROR","vt":"str"},{"t":"eq","v":"OK","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":370,"y":160,"wires":[["d88a6332.2c6b5"],[]]},{"id":"ee46d402.5a10c8","type":"function","z":"37dfc7a4.d17a78","name":"Check","func":"var string = msg.payload.toString(\"utf8\");\nvar splitted = string.split(\" \");\nmsg.payload = {};\nmsg.payload.answer = splitted[0];\nmsg.payload.message = splitted[1];\n\nreturn msg;","outputs":1,"noerr":0,"x":220,"y":160,"wires":[["a315c81d.080f08"]]},{"id":"651c618a.1fe6e","type":"function","z":"4e6fdd47.e9b2b4","name":"set_command","func":"var productID = msg.payload;\n\nif(productID !== null){\n    msg.payload = {};\n    msg.payload = \"READ \" + productID +\" \\n\";\n}\n\nreturn msg;","outputs":1,"noerr":0,"x":259,"y":830,"wires":[["110c2392.355c3c"]]},{"id":"7991420c.86879c","type":"encrypt","z":"4e6fdd47.e9b2b4","name":"ENCRYPT INFO","algorithm":"AES","key":"eshipping_password","x":424,"y":174,"wires":[["f77e4c5d.767bf"]]},{"id":"5bbda38a.0e48bc","type":"function","z":"4e6fdd47.e9b2b4","name":"get_product_info","func":"var str = msg.payload.toString();\nvar splitted = str.split(\":\");\nmsg.payload = splitted[1];\nreturn msg;","outputs":1,"noerr":0,"x":367,"y":119,"wires":[["7991420c.86879c"]]},{"id":"ea0d15c6.f88048","type":"mqtt in","z":"4e6fdd47.e9b2b4","name":"scannerRFID/toEncrypt","topic":"eshipping/scannerRFID/toEncrypt","qos":"2","broker":"9a7edbcb.ffc6a8","x":139,"y":110,"wires":[["5bbda38a.0e48bc","c4966c54.8d8e8"]]},{"id":"54bcbd30.6bed44","type":"function","z":"4e6fdd47.e9b2b4","name":"set_command","func":"var obj1 = msg.payload[0];\nvar obj2 = msg.payload[1];\n\nmsg.payload = Object.assign(obj1,obj2);\n\nvar encryptedInfo = msg.payload.encryptedInfo;\nvar tagID = msg.payload.tagID;\nmsg.payload = \"WRITE \" + tagID + \" \" +encryptedInfo +\" \\n\";\nreturn msg;","outputs":1,"noerr":0,"x":619,"y":350,"wires":[["dc33b723.c56448"]]},{"id":"53bbe72d.814858","type":"mqtt in","z":"4e6fdd47.e9b2b4","name":"scannerRFID/toDecrypt","topic":"eshipping/scannerRFID/toDecrypt","qos":"2","broker":"9a7edbcb.ffc6a8","x":159,"y":770,"wires":[["651c618a.1fe6e"]]},{"id":"98785997.efb918","type":"decrypt","z":"4e6fdd47.e9b2b4","name":"DECRYPT INFO","algorithm":"AES","key":"eshipping_password","x":609,"y":1070,"wires":[["51158348.312d4c"]]},{"id":"dc33b723.c56448","type":"tcp request","z":"4e6fdd47.e9b2b4","server":"localhost","port":"9005","out":"char","splitc":"\\n","name":"WRITE tag","x":689,"y":410,"wires":[["8e585ef7.5c92a"]]},{"id":"110c2392.355c3c","type":"tcp request","z":"4e6fdd47.e9b2b4","server":"localhost","port":"9005","out":"char","splitc":"\\n","name":"READ tag","x":299,"y":890,"wires":[["5d67b576.3944fc"]]},{"id":"c4966c54.8d8e8","type":"function","z":"4e6fdd47.e9b2b4","name":"get_product_ID","func":"var str = msg.payload.toString();\nvar splitted = str.split(\":\");\nmsg.payload =  {};\nmsg.payload.tagID = splitted[0];\nreturn msg;","outputs":1,"noerr":0,"x":219,"y":390,"wires":[["7de47ac6.513e64","d61313f1.660af"]]},{"id":"7de47ac6.513e64","type":"join","z":"4e6fdd47.e9b2b4","name":"","mode":"custom","build":"array","property":"payload","propertyType":"msg","key":"topic","joiner":"\\n","joinerType":"str","accumulate":false,"timeout":"","count":"2","reduceRight":false,"reduceExp":"","reduceInit":"","reduceInitType":"","reduceFixup":"","x":829,"y":550,"wires":[["9d61d538.13fef8"]]},{"id":"853d2591.0f0bf8","type":"function","z":"4e6fdd47.e9b2b4","name":"get_encrypted_info","func":"var encryptedInfo = msg.payload.message;\nmsg.payload = {};\nmsg.payload = encryptedInfo;\nreturn msg;","outputs":1,"noerr":0,"x":509,"y":1010,"wires":[["98785997.efb918"]]},{"id":"8e585ef7.5c92a","type":"subflow:37dfc7a4.d17a78","z":"4e6fdd47.e9b2b4","name":"","x":789,"y":470,"wires":[["7de47ac6.513e64"]]},{"id":"5d67b576.3944fc","type":"subflow:176e4c69.a78804","z":"4e6fdd47.e9b2b4","x":389,"y":950,"wires":[["853d2591.0f0bf8"]]},{"id":"51158348.312d4c","type":"mqtt out","z":"4e6fdd47.e9b2b4","name":"eshipping/scannerRFID/decrypted","topic":"eshipping/scannerRFID/decrypted","qos":"2","retain":"","broker":"f3ba5adc.cff538","x":779,"y":1130,"wires":[]},{"id":"ae21c2e6.e22b4","type":"comment","z":"4e6fdd47.e9b2b4","name":"Encrypt product info","info":"","x":129,"y":50,"wires":[]},{"id":"f69d3324.fec0e","type":"comment","z":"4e6fdd47.e9b2b4","name":"Decrypt product info","info":"","x":149,"y":710,"wires":[]},{"id":"d61313f1.660af","type":"join","z":"4e6fdd47.e9b2b4","name":"","mode":"custom","build":"array","property":"payload","propertyType":"msg","key":"topic","joiner":"\\n","joinerType":"str","accumulate":false,"timeout":"","count":"2","reduceRight":false,"reduceExp":"","reduceInit":"","reduceInitType":"","reduceFixup":"","x":529,"y":290,"wires":[["54bcbd30.6bed44"]]},{"id":"8eb67fae.2fc3c","type":"mqtt out","z":"4e6fdd47.e9b2b4","name":"scannerRFID/encrypted","topic":"eshipping/scannerRFID/encrypted","qos":"2","retain":"","broker":"5ac4dda0.055f24","x":1109,"y":670,"wires":[]},{"id":"9d61d538.13fef8","type":"function","z":"4e6fdd47.e9b2b4","name":"confirm_operation","func":"var obj1 = msg.payload[0];\nvar obj2 = msg.payload[1];\n\nmsg.payload = Object.assign(obj1,obj2);\nvar tagID = msg.payload.tagID;\n\nmsg.payload = {};\nmsg.payload = tagID;\n\nreturn msg;","outputs":1,"noerr":0,"x":949,"y":610,"wires":[["8eb67fae.2fc3c"]]},{"id":"f77e4c5d.767bf","type":"function","z":"4e6fdd47.e9b2b4","name":"get_encryption","func":"var encryptedInfo = msg.payload;\nmsg.payload =  {};\nmsg.payload.encryptedInfo = encryptedInfo;\n\nreturn msg;","outputs":1,"noerr":0,"x":532.5,"y":230.60000610351562,"wires":[["d61313f1.660af"]]},{"id":"75c5d1fe.1ecde","type":"switch","z":"aa4b2613.717028","name":"","property":"payload","propertyType":"msg","rules":[{"t":"istype","v":"string","vt":"string"},{"t":"istype","v":"array","vt":"array"}],"checkall":"true","repair":false,"outputs":2,"x":370,"y":180,"wires":[["d4b0e63f.c51948"],["1832147b.682a4c"]]},{"id":"1832147b.682a4c","type":"function","z":"aa4b2613.717028","name":"get_first","func":"var array = msg.payload;\nvar jsonObject = array[0];\n\nmsg.payload = {};\nmsg.payload = jsonObject;\n\nreturn msg;","outputs":1,"noerr":0,"x":440,"y":240,"wires":[[]]},{"id":"d4b0e63f.c51948","type":"mqtt out","z":"aa4b2613.717028","name":"eshipping/warehouse/error","topic":"eshipping/warehouse/error","qos":"2","retain":"","broker":"ab8ddb21.b751b8","x":631,"y":81,"wires":[]},{"id":"b35843be.08f22","type":"mqtt out","z":"dea130da.51821","name":"scannerRFID/toEncrypt","topic":"eshipping/scannerRFID/toEncrypt","qos":"2","retain":"","broker":"43e7c7ae.b5cf18","x":844,"y":104,"wires":[]},{"id":"fecfa58f.1b2ce8","type":"function","z":"dea130da.51821","name":"set_message","func":"var object = msg.payload;\nvar id = object.id;\nvar info = object.id + \"_\" + object.description + \"_\" + object.destination + \"_\" + object.type;\nmsg.payload = id + \":\" + info;\nreturn msg;","outputs":1,"noerr":0,"x":621,"y":105,"wires":[["b35843be.08f22"]]},{"id":"6961a87d.6d19a8","type":"json","z":"dea130da.51821","name":"Convert to JS object","property":"payload","action":"obj","pretty":false,"x":411,"y":105,"wires":[["fecfa58f.1b2ce8"]]},{"id":"b1cea5a1.d064a8","type":"debug","z":"dea130da.51821","name":"Error","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","x":283,"y":1004.28564453125,"wires":[]},{"id":"87257060.5ad74","type":"mqtt in","z":"dea130da.51821","name":"eshipping/+/error","topic":"eshipping/+/error","qos":"2","broker":"23785252.1b673e","x":91,"y":1000,"wires":[["b1cea5a1.d064a8","a5466825.d628d8"]]},{"id":"3dc64a2.50caab6","type":"comment","z":"dea130da.51821","name":"Receiving Order from central system","info":"","x":151,"y":45,"wires":[]},{"id":"50b4bb4f.f2d274","type":"comment","z":"dea130da.51821","name":"Error management","info":"","x":101,"y":940,"wires":[]},{"id":"99854fd5.ef025","type":"function","z":"dea130da.51821","name":"find_vehicle_AVAILABLE_query","func":"msg.operation=\"find.toArray\";\nmsg.payload={\"status\" : \"AVAILABLE\"};\nreturn msg;","outputs":1,"noerr":0,"x":401,"y":385,"wires":[["8d2fdba0.59b7e8"]]},{"id":"f0d1b4c5.092ad8","type":"function","z":"dea130da.51821","name":"read_answer","func":"var array = msg.payload;\n\nif(array.length === 0){\n        msg.payload = {};\n        msg.payload = \"ERROR no_vehicles_available\";\n} \n\nreturn msg;\n","outputs":1,"noerr":0,"x":661,"y":505,"wires":[["30d13c67.04d3f4"]]},{"id":"4c68e533.5d266c","type":"function","z":"dea130da.51821","name":"get_vehicle_ID","func":"var object = msg.payload;\nvar vehicleID = object.id;\nmsg.payload = vehicleID;\nreturn msg;","outputs":1,"noerr":0,"x":1031,"y":545,"wires":[["a2a53a5a.8ca798"]]},{"id":"e0b5ca0a.fce388","type":"mqtt out","z":"dea130da.51821","name":"scannerRFID/toDecrypt","topic":"eshipping/scannerRFID/toDecrypt","qos":"","retain":"","broker":"43e7c7ae.b5cf18","x":821,"y":645,"wires":[]},{"id":"422dfe8f.2fd6f","type":"mqtt in","z":"dea130da.51821","name":"eshipping/scannerRFID/decrypted","topic":"eshipping/scannerRFID/decrypted","qos":"2","broker":"b78f2004.bdddb","x":791,"y":785,"wires":[["a2a53a5a.8ca798"]]},{"id":"668a99d3.e02ab8","type":"function","z":"dea130da.51821","name":"set_message","func":"var vehicleID = msg.payload.vehicleID;\nvar productInfo = msg.payload.productInfo;\n\nmsg.payload = vehicleID + \"###\" + productInfo;\nmsg.topic = \"eshipping/vehicle/\" + vehicleID + \"/start\"\n\nreturn msg;","outputs":1,"noerr":0,"x":1501,"y":885,"wires":[["5afec5d9.62614c"]]},{"id":"5afec5d9.62614c","type":"mqtt out","z":"dea130da.51821","name":"eshipping/vehicle/+/start","topic":"","qos":"2","retain":"","broker":"d76d5071.9a24d","x":1721,"y":885,"wires":[]},{"id":"e2ffa85b.be9a68","type":"mqtt in","z":"dea130da.51821","name":"scannerRFID/encrypted","topic":"eshipping/scannerRFID/encrypted","qos":"2","broker":"1f3fc10b.635fef","x":111,"y":245,"wires":[["5ff19244.5692dc","c7617768.9b44b8"]]},{"id":"5ff19244.5692dc","type":"function","z":"dea130da.51821","name":"update_product_query","func":"var id = msg.payload;\nmsg.payload = {};\nmsg.operation = \"updateOne\";\nmsg.payload=[{\"id\": id},\n                {$set:{\"status\" : \"TODELIVER\"}},\n                {},\n                undefined];\n\nreturn msg;","outputs":1,"noerr":0,"x":361,"y":245,"wires":[["6a47f7be.49df88"]]},{"id":"8d2fdba0.59b7e8","type":"mongodb3 in","z":"dea130da.51821","service":"_ext_","configNode":"4ef22acf.5c8814","name":"E-Shipping DB","collection":"vehicles","operation":"","x":551,"y":445,"wires":[["f0d1b4c5.092ad8"]]},{"id":"6a47f7be.49df88","type":"mongodb3 in","z":"dea130da.51821","service":"_ext_","configNode":"4ef22acf.5c8814","name":"E-Shipping DB","collection":"products","operation":"","x":581,"y":245,"wires":[[]]},{"id":"8ca49035.c9e2","type":"ui_button","z":"dea130da.51821","name":"","group":"a4d02af7.c60f58","order":2,"width":0,"height":0,"passthru":false,"label":"Try delivery","color":"","bgcolor":"","icon":"","payload":"","payloadType":"str","topic":"","x":81,"y":385,"wires":[["5c164342.920ccc","99854fd5.ef025"]]},{"id":"5c164342.920ccc","type":"function","z":"dea130da.51821","name":"find_product_TODELIVER_query","func":"msg.operation=\"find.toArray\";\nmsg.payload={\"status\" : \"TODELIVER\"};\nmsg.projection={\"_id\": 0 , \"id\" : 1};\nreturn msg;","outputs":1,"noerr":0,"x":163,"y":477,"wires":[["ad9c092b.bdd848"]]},{"id":"e5cff83f.96af88","type":"function","z":"dea130da.51821","name":"read_answer","func":"var array = msg.payload;\n\nif(array.length === 0){\n        msg.payload = {};\n        msg.payload = \"ERROR no_products_to_deliver\";\n} \n\nreturn msg;","outputs":1,"noerr":0,"x":321,"y":645,"wires":[["af2ce373.cd8c3"]]},{"id":"ad9c092b.bdd848","type":"mongodb3 in","z":"dea130da.51821","service":"_ext_","configNode":"4ef22acf.5c8814","name":"E-Shipping DB","collection":"products","operation":"","x":231,"y":565,"wires":[["e5cff83f.96af88"]]},{"id":"e5b504a6.946718","type":"function","z":"dea130da.51821","name":"update_vehicle_query","func":"var vehicleID = msg.payload.vehicleID;\nvar productInfo = msg.payload.productInfo;\nvar productArray = productInfo.split(\"_\");\nvar productID = productArray[0];\nvar productType = productArray[3];\n\nmsg.payload = {};\nmsg.operation = \"updateOne\";\nmsg.payload=[{\"id\": vehicleID},\n                {$set:{\n                    \"status\" : \"INDELIVERY\",\n                    \"productID\" : productID,\n                    \"sensorType\" : productType}\n                },\n                {},\n                undefined];\n\nreturn msg;","outputs":1,"noerr":0,"x":1531,"y":805,"wires":[["2eefe09a.85491"]]},{"id":"cd191086.a7543","type":"function","z":"dea130da.51821","name":"get_product_ID","func":"var object = msg.payload;\nvar productID = object.id;\nmsg.payload = productID;\nreturn msg;","outputs":1,"noerr":0,"x":611,"y":645,"wires":[["e0b5ca0a.fce388"]]},{"id":"36ea0c67.2e2ef4","type":"mongodb3 in","z":"dea130da.51821","service":"_ext_","configNode":"4ef22acf.5c8814","name":"E-Shipping DB","collection":"products","operation":"","x":1771,"y":725,"wires":[[]]},{"id":"278982de.8e2b1e","type":"function","z":"dea130da.51821","name":"update_product_query","func":"var productInfo = msg.payload.productInfo;\nvar productArray = productInfo.split(\"_\");\nvar productID = productArray[0];\nvar productType = productArray[3];\n\n\nmsg.payload = {};\nmsg.operation = \"updateOne\";\nmsg.payload=[{\"id\": productID},\n                {$set:{\"status\" : \"INDELIVERY\"}},\n                {},\n                undefined];\n\nreturn msg;","outputs":1,"noerr":0,"x":1541,"y":725,"wires":[["36ea0c67.2e2ef4"]]},{"id":"be066446.390808","type":"mqtt in","z":"dea130da.51821","name":"eshipping/warehouse/toDeliver","topic":"eshipping/warehouse/toDeliver","qos":"2","broker":"1f3fc10b.635fef","x":141,"y":105,"wires":[["6961a87d.6d19a8"]]},{"id":"2eefe09a.85491","type":"mongodb3 in","z":"dea130da.51821","service":"_ext_","configNode":"4ef22acf.5c8814","name":"E-Shipping DB","collection":"vehicles","operation":"","x":1771,"y":805,"wires":[[]]},{"id":"8f1bbc17.8445f","type":"function","z":"dea130da.51821","name":"detect_info","func":"var array = msg.payload.split(\"###\");\nvar vehicleID;\nvar productInfo;\n\nif(array[0].includes(\"_\")){\n        vehicleID = array[1];\n        productInfo = array[0];\n}\nelse{\n        vehicleID = array[0];\n        productInfo = array[1];\n}\n\nmsg.payload = {};\nmsg.payload.vehicleID = vehicleID;\nmsg.payload.productInfo = productInfo;\n\nreturn msg;","outputs":1,"noerr":0,"x":1301,"y":805,"wires":[["278982de.8e2b1e","e5b504a6.946718","668a99d3.e02ab8","28152284.fc6cae"]]},{"id":"30d13c67.04d3f4","type":"subflow:aa4b2613.717028","z":"dea130da.51821","name":"","x":811,"y":565,"wires":[["4c68e533.5d266c"],["a2a53a5a.8ca798"]]},{"id":"af2ce373.cd8c3","type":"subflow:aa4b2613.717028","z":"dea130da.51821","name":"","x":411,"y":705,"wires":[["cd191086.a7543"],["a2a53a5a.8ca798"]]},{"id":"a2a53a5a.8ca798","type":"join","z":"dea130da.51821","name":"","mode":"custom","build":"array","property":"payload","propertyType":"msg","key":"topic","joiner":"\\n","joinerType":"str","accumulate":false,"timeout":"","count":"2","reduceRight":false,"reduceExp":"","reduceInit":"","reduceInitType":"","reduceFixup":"","x":1081,"y":705,"wires":[["3309174b.98de88"]]},{"id":"3309174b.98de88","type":"function","z":"dea130da.51821","name":"set_check","func":"var array = msg.payload\n\nmsg.payload = {};\nmsg.payload = array[0] + \"###\" +  array[1]; \n\nreturn msg;","outputs":1,"noerr":0,"x":1230,"y":670,"wires":[["dc9c6fd8.11cd1"]]},{"id":"dc9c6fd8.11cd1","type":"switch","z":"dea130da.51821","name":"","property":"payload","propertyType":"msg","rules":[{"t":"cont","v":"ERROR","vt":"str"},{"t":"else"}],"checkall":"true","repair":false,"outputs":2,"x":1381,"y":665,"wires":[["ea93195e.bc53e8"],["8f1bbc17.8445f"]]},{"id":"3d39a78d.c0a938","type":"ui_toast","z":"dea130da.51821","position":"dialog","displayTime":"3","highlight":"","outputs":1,"ok":"OK","cancel":"","topic":"WARNING","name":"","x":1743,"y":605,"wires":[[]]},{"id":"ea93195e.bc53e8","type":"function","z":"dea130da.51821","name":"set_notification","func":"msg.payload = \"Delivery failed\"\nreturn msg;","outputs":1,"noerr":0,"x":1551,"y":605,"wires":[["3d39a78d.c0a938"]]},{"id":"190dd8a.77c6727","type":"comment","z":"dea130da.51821","name":"Update product status","info":"","x":111,"y":185,"wires":[]},{"id":"6473b28f.540d8c","type":"comment","z":"dea130da.51821","name":"Check product to deliver and vehicle available","info":"","x":181,"y":325,"wires":[]},{"id":"279f6d8e.9013a2","type":"comment","z":"dea130da.51821","name":"Delivery ending","info":"","x":89,"y":1178,"wires":[]},{"id":"8523eb8d.38f108","type":"mqtt in","z":"dea130da.51821","name":"eshipping/vehicle/+/end","topic":"eshipping/vehicle/+/end","qos":"2","broker":"80474ea8.9a951","x":112,"y":1236,"wires":[["5f0f90e7.1df2f","16e4e448.b19cfc","ea8bad64.3f194"]]},{"id":"a5466825.d628d8","type":"ui_toast","z":"dea130da.51821","position":"top right","displayTime":"3","highlight":"","outputs":0,"ok":"OK","cancel":"","topic":"SYSTEM ERROR","name":"","x":301,"y":1068,"wires":[]},{"id":"e3aa5fb8.bb231","type":"ui_text","z":"dea130da.51821","group":"63ce6e83.8ba4e","order":1,"width":"0","height":"0","name":"lat_long","label":"LATITUDE LONGITUDE","format":"{{msg.payload.latlong}}","layout":"col-center","x":981,"y":1430,"wires":[]},{"id":"2e4575d1.5a605a","type":"ui_gauge","z":"dea130da.51821","name":"Temperature","group":"63ce6e83.8ba4e","order":2,"width":0,"height":0,"gtype":"gage","title":"Temperature","label":"°C","format":"{{msg.payload.temperature}}","min":0,"max":"15","colors":["#007be0","#03bd00","#ca3838"],"seg1":"6","seg2":"9","x":991,"y":1550,"wires":[]},{"id":"f558f595.851808","type":"mqtt in","z":"dea130da.51821","name":"eshipping/warehouse/dashboard/000","topic":"eshipping/warehouse/dashboard/000","qos":"2","broker":"80474ea8.9a951","x":151,"y":1470,"wires":[["bdae73f5.45511"]]},{"id":"bdae73f5.45511","type":"function","z":"dea130da.51821","name":"check_msg","func":"var info = msg.payload.split(\" \");\n\nmsg.payload = {};\nmsg.payload.type = info[0];\nmsg.payload.data = info[1];\nreturn msg;","outputs":1,"noerr":0,"x":421,"y":1470,"wires":[["dc1632ef.d9e2b"]]},{"id":"dc1632ef.d9e2b","type":"switch","z":"dea130da.51821","name":"","property":"payload.type","propertyType":"msg","rules":[{"t":"eq","v":"STANDARD","vt":"str"},{"t":"eq","v":"FRAGILE","vt":"str"},{"t":"eq","v":"FRIGO","vt":"str"}],"checkall":"true","repair":false,"outputs":3,"x":571,"y":1470,"wires":[["21649feb.85a0e"],["d0b9f605.2dffe8"],["9f754e58.f710d"]]},{"id":"21649feb.85a0e","type":"function","z":"dea130da.51821","name":"set_dash_std","func":"var data = msg.payload.data.split(\"_\");\n\nvar lat = data[0];\nvar long = data[1];\n\nmsg.payload.latlong = lat + \", \" + long;\nmsg.payload.vibration = 0;\nmsg.payload.temperature = 0;\nmsg.payload.humidity = 0;\n\nreturn msg;","outputs":1,"noerr":0,"x":751,"y":1430,"wires":[["e3aa5fb8.bb231","2e4575d1.5a605a","afefb1c.d73f65","9f6ced43.ea47b"]]},{"id":"d0b9f605.2dffe8","type":"function","z":"dea130da.51821","name":"set_dash_frg","func":"var data = msg.payload.data.split(\"_\");\n\nvar lat = data[0];\nvar long = data[1];\nvar vib = data[2];\n\nmsg.payload = {};\nmsg.payload.latlong = lat + \", \" + long;\nmsg.payload.vibration = vib;\nmsg.payload.temperature = 0;\nmsg.payload.humidity = 0;\nreturn msg;","outputs":1,"noerr":0,"x":751,"y":1470,"wires":[["2e4575d1.5a605a","e3aa5fb8.bb231","b3a8d7bf.53b538","afefb1c.d73f65","9f6ced43.ea47b"]]},{"id":"9f754e58.f710d","type":"function","z":"dea130da.51821","name":"set_dash_fri","func":"var data = msg.payload.data.split(\"_\");\n\nvar lat = data[0];\nvar long = data[1];\nvar tmp = data[2];\nvar alarm = data[3];\nvar hum = data[4];\n\nmsg.payload.latlong = lat + \", \" + long;\nmsg.payload.vibration = 0;\nmsg.payload.temperature = tmp;\nmsg.payload.alarm = alarm;\nmsg.payload.humidity = hum;\nreturn msg;","outputs":1,"noerr":0,"x":751,"y":1550,"wires":[["2e4575d1.5a605a","e3aa5fb8.bb231","cb118450.47a8e8","afefb1c.d73f65","9f6ced43.ea47b"]]},{"id":"cb118450.47a8e8","type":"switch","z":"dea130da.51821","name":"","property":"payload.alarm","propertyType":"msg","rules":[{"t":"eq","v":"true","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":971,"y":1590,"wires":[["ad31dabf.8ddd68","b8105b00.09b668"]]},{"id":"dfe6073b.8aeb38","type":"ui_toast","z":"dea130da.51821","position":"top right","displayTime":"3","highlight":"","outputs":0,"ok":"OK","cancel":"","topic":"ALARM","name":"","x":1321,"y":1591,"wires":[]},{"id":"ad31dabf.8ddd68","type":"function","z":"dea130da.51821","name":"alarm_msg","func":"msg.payload = {};\nmsg.payload = \"HIGH TEMPERATURE for vehicle 000\";\nreturn msg;","outputs":1,"noerr":0,"x":1131,"y":1590,"wires":[["dfe6073b.8aeb38"]]},{"id":"5f0f90e7.1df2f","type":"function","z":"dea130da.51821","name":"reset_vehicles_query","func":"var data = msg.payload.split(\"_\");\nvar idVehicle = data[0];\n\nmsg.payload = {};\n\nmsg.payload=[{\"id\":idVehicle},\n                {$set:{\n                        \"status\" : \"AVAILABLE\",\n                        \"productID\" : null,\n                        \"sensorType\" : null\n                }},\n                {},\n                undefined];\nreturn msg;","outputs":1,"noerr":0,"x":392,"y":1216,"wires":[["4c8cca9d.510514"]]},{"id":"16e4e448.b19cfc","type":"function","z":"dea130da.51821","name":"reset_products_query","func":"var data = msg.payload.split(\"_\");\nvar idProduct = data[1];\n\nmsg.payload = {};\n\nmsg.payload=[{\"id\":idProduct},\n                {$set:{\n                        \"status\" : \"DELIVERED\",\n                }},\n                {},\n                undefined];\nreturn msg;","outputs":1,"noerr":0,"x":382,"y":1256,"wires":[["2e84ff70.2a82c"]]},{"id":"2e84ff70.2a82c","type":"mongodb3 in","z":"dea130da.51821","service":"_ext_","configNode":"4ef22acf.5c8814","name":"E-Shipping DB","collection":"products","operation":"update","x":592,"y":1256,"wires":[[]]},{"id":"4c8cca9d.510514","type":"mongodb3 in","z":"dea130da.51821","service":"_ext_","configNode":"4ef22acf.5c8814","name":"E-Shipping DB","collection":"vehicles","operation":"update","x":606,"y":1216,"wires":[[]]},{"id":"ea8bad64.3f194","type":"function","z":"dea130da.51821","name":"set_notification","func":"var id = msg.payload.split(\"_\");\nmsg.payload = {};\nmsg.payload = \"Product \" + id[1] + \" delivered\";\nreturn msg;","outputs":1,"noerr":0,"x":362,"y":1176,"wires":[["ca23cf30.65afe"]]},{"id":"ca23cf30.65afe","type":"ui_toast","z":"dea130da.51821","position":"dialog","displayTime":"5","highlight":"","outputs":1,"ok":"OK","cancel":"","topic":"INFORMATION","name":"deliver_notify","x":562,"y":1176,"wires":[[]]},{"id":"b3a8d7bf.53b538","type":"switch","z":"dea130da.51821","name":"","property":"payload.vibration","propertyType":"msg","rules":[{"t":"gte","v":"4800","vt":"num"}],"checkall":"true","repair":false,"outputs":1,"x":971,"y":1510,"wires":[["86da3574.470ae8","b8105b00.09b668"]]},{"id":"86da3574.470ae8","type":"function","z":"dea130da.51821","name":"alarm_msg","func":"msg.payload = {};\nmsg.payload = \"HIGH VIBRATION for vehicle 000\";\nreturn msg;","outputs":1,"noerr":0,"x":1131,"y":1510,"wires":[["f1dd50e5.6f2d6"]]},{"id":"f1dd50e5.6f2d6","type":"ui_toast","z":"dea130da.51821","position":"top right","displayTime":"3","highlight":"","outputs":0,"ok":"OK","cancel":"","topic":"ALARM","name":"","x":1331,"y":1510,"wires":[]},{"id":"a8dbb300.726cc","type":"ui_text","z":"dea130da.51821","group":"9706cd08.73513","order":1,"width":"0","height":"0","name":"lat_long","label":"LATITUDE LONGITUDE","format":"{{msg.payload.latlong}}","layout":"col-center","x":977,"y":1778,"wires":[]},{"id":"3328d1be.aadb7e","type":"ui_gauge","z":"dea130da.51821","name":"Temperature","group":"9706cd08.73513","order":2,"width":0,"height":0,"gtype":"gage","title":"Temperature","label":"°C","format":"{{msg.payload.temperature}}","min":0,"max":"15","colors":["#007be0","#03bd00","#ca3838"],"seg1":"6","seg2":"9","x":987,"y":1898,"wires":[]},{"id":"920e50e.64012b","type":"mqtt in","z":"dea130da.51821","name":"eshipping/warehouse/dashboard/001","topic":"eshipping/warehouse/dashboard/001","qos":"2","broker":"80474ea8.9a951","x":147,"y":1818,"wires":[["f7186cc1.78c5d"]]},{"id":"f7186cc1.78c5d","type":"function","z":"dea130da.51821","name":"check_msg","func":"var info = msg.payload.split(\" \");\n\nmsg.payload = {};\nmsg.payload.type = info[0];\nmsg.payload.data = info[1];\nreturn msg;","outputs":1,"noerr":0,"x":417,"y":1818,"wires":[["75f84881.18aa68"]]},{"id":"75f84881.18aa68","type":"switch","z":"dea130da.51821","name":"","property":"payload.type","propertyType":"msg","rules":[{"t":"eq","v":"STANDARD","vt":"str"},{"t":"eq","v":"FRAGILE","vt":"str"},{"t":"eq","v":"FRIGO","vt":"str"}],"checkall":"true","repair":false,"outputs":3,"x":567,"y":1818,"wires":[["1e112c1a.9f9204"],["66289658.8c7af8"],["4ce86836.82c1c8"]]},{"id":"1e112c1a.9f9204","type":"function","z":"dea130da.51821","name":"set_dash_std","func":"var data = msg.payload.data.split(\"_\");\n\nvar lat = data[0];\nvar long = data[1];\n\nmsg.payload.latlong = lat + \", \" + long;\nmsg.payload.vibration = 0;\nmsg.payload.temperature = 0;\nmsg.payload.humidity = 0;\n\nreturn msg;","outputs":1,"noerr":0,"x":747,"y":1778,"wires":[["a8dbb300.726cc","3328d1be.aadb7e","1dfb190.122b2e7","77bc807a.08a8a"]]},{"id":"66289658.8c7af8","type":"function","z":"dea130da.51821","name":"set_dash_frg","func":"var data = msg.payload.data.split(\"_\");\n\nvar lat = data[0];\nvar long = data[1];\nvar vib = data[2];\n\nmsg.payload = {};\nmsg.payload.latlong = lat + \", \" + long;\nmsg.payload.vibration = vib;\nmsg.payload.temperature = 0;\nmsg.payload.humidity = 0;\nreturn msg;","outputs":1,"noerr":0,"x":747,"y":1818,"wires":[["3328d1be.aadb7e","a8dbb300.726cc","a8f2e9ed.894848","1dfb190.122b2e7","77bc807a.08a8a"]]},{"id":"4ce86836.82c1c8","type":"function","z":"dea130da.51821","name":"set_dash_fri","func":"var data = msg.payload.data.split(\"_\");\n\nvar lat = data[0];\nvar long = data[1];\nvar tmp = data[2];\nvar alarm = data[3];\nvar hum = data[4];\n\nmsg.payload.latlong = lat + \", \" + long;\nmsg.payload.vibration = 0;\nmsg.payload.temperature = tmp;\nmsg.payload.alarm = alarm;\nmsg.payload.humidity = hum;\nreturn msg;","outputs":1,"noerr":0,"x":747,"y":1898,"wires":[["3328d1be.aadb7e","a8dbb300.726cc","3b468d24.619fc2","1dfb190.122b2e7","77bc807a.08a8a"]]},{"id":"3b468d24.619fc2","type":"switch","z":"dea130da.51821","name":"","property":"payload.alarm","propertyType":"msg","rules":[{"t":"eq","v":"true","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":967,"y":1938,"wires":[["c5a81dc1.137d2","b9fb5de8.a0d13"]]},{"id":"53658c6d.7a6594","type":"ui_toast","z":"dea130da.51821","position":"top right","displayTime":"3","highlight":"","outputs":0,"ok":"OK","cancel":"","topic":"ALARM","name":"","x":1327,"y":1938,"wires":[]},{"id":"c5a81dc1.137d2","type":"function","z":"dea130da.51821","name":"alarm_msg","func":"msg.payload = {};\nmsg.payload = \"HIGH TEMPERATURE for vehicle 001\";\nreturn msg;","outputs":1,"noerr":0,"x":1127,"y":1938,"wires":[["53658c6d.7a6594"]]},{"id":"a8f2e9ed.894848","type":"switch","z":"dea130da.51821","name":"","property":"payload.vibration","propertyType":"msg","rules":[{"t":"gte","v":"4800","vt":"num"}],"checkall":"true","repair":false,"outputs":1,"x":967,"y":1858,"wires":[["c00175a0.5189d8","b9fb5de8.a0d13"]]},{"id":"c00175a0.5189d8","type":"function","z":"dea130da.51821","name":"alarm_msg","func":"msg.payload = {};\nmsg.payload = \"HIGH VIBRATION for vehicle 001\";\nreturn msg;","outputs":1,"noerr":0,"x":1127,"y":1858,"wires":[["218a3211.dc23ae"]]},{"id":"218a3211.dc23ae","type":"ui_toast","z":"dea130da.51821","position":"top right","displayTime":"3","highlight":"","outputs":0,"ok":"OK","cancel":"","topic":"ALARM","name":"","x":1327,"y":1858,"wires":[]},{"id":"56eafc4d.1350c4","type":"ui_text","z":"dea130da.51821","group":"76b5e9ae.5e5068","order":1,"width":"0","height":"0","name":"lat_long","label":"LATITUDE LONGITUDE","format":"{{msg.payload.latlong}}","layout":"col-center","x":977,"y":2116,"wires":[]},{"id":"8846fb3d.287488","type":"ui_gauge","z":"dea130da.51821","name":"Temperature","group":"76b5e9ae.5e5068","order":2,"width":0,"height":0,"gtype":"gage","title":"Temperature","label":"°C","format":"{{msg.payload.temperature}}","min":0,"max":"15","colors":["#007be0","#03bd00","#ca3838"],"seg1":"6","seg2":"9","x":987,"y":2236,"wires":[]},{"id":"fb280f61.4bbc","type":"mqtt in","z":"dea130da.51821","name":"eshipping/warehouse/dashboard/002","topic":"eshipping/warehouse/dashboard/002","qos":"2","broker":"80474ea8.9a951","x":147,"y":2156,"wires":[["d71756f2.a56068"]]},{"id":"d71756f2.a56068","type":"function","z":"dea130da.51821","name":"check_msg","func":"var info = msg.payload.split(\" \");\n\nmsg.payload = {};\nmsg.payload.type = info[0];\nmsg.payload.data = info[1];\nreturn msg;","outputs":1,"noerr":0,"x":417,"y":2156,"wires":[["6b3b8e56.83e78"]]},{"id":"6b3b8e56.83e78","type":"switch","z":"dea130da.51821","name":"","property":"payload.type","propertyType":"msg","rules":[{"t":"eq","v":"STANDARD","vt":"str"},{"t":"eq","v":"FRAGILE","vt":"str"},{"t":"eq","v":"FRIGO","vt":"str"}],"checkall":"true","repair":false,"outputs":3,"x":567,"y":2156,"wires":[["dd62590.654ada8"],["56ece2d4.350f3c"],["26e4b9.0b184b48"]]},{"id":"dd62590.654ada8","type":"function","z":"dea130da.51821","name":"set_dash_std","func":"var data = msg.payload.data.split(\"_\");\n\nvar lat = data[0];\nvar long = data[1];\n\nmsg.payload.latlong = lat + \", \" + long;\nmsg.payload.vibration = 0;\nmsg.payload.temperature = 0;\nmsg.payload.humidity = 0;\n\nreturn msg;","outputs":1,"noerr":0,"x":747,"y":2116,"wires":[["56eafc4d.1350c4","8846fb3d.287488","88029ffa.6fdb7","77f9ec1.2ff3b14"]]},{"id":"56ece2d4.350f3c","type":"function","z":"dea130da.51821","name":"set_dash_frg","func":"var data = msg.payload.data.split(\"_\");\n\nvar lat = data[0];\nvar long = data[1];\nvar vib = data[2];\n\nmsg.payload = {};\nmsg.payload.latlong = lat + \", \" + long;\nmsg.payload.vibration = vib;\nmsg.payload.temperature = 0;\nmsg.payload.humidity = 0;\nreturn msg;","outputs":1,"noerr":0,"x":747,"y":2156,"wires":[["8846fb3d.287488","56eafc4d.1350c4","4116f00.a7f3a1","88029ffa.6fdb7","77f9ec1.2ff3b14"]]},{"id":"26e4b9.0b184b48","type":"function","z":"dea130da.51821","name":"set_dash_fri","func":"var data = msg.payload.data.split(\"_\");\n\nvar lat = data[0];\nvar long = data[1];\nvar tmp = data[2];\nvar alarm = data[3];\nvar hum = data[4];\n\nmsg.payload.latlong = lat + \", \" + long;\nmsg.payload.vibration = 0;\nmsg.payload.temperature = tmp;\nmsg.payload.alarm = alarm;\nmsg.payload.humidity = hum;\nreturn msg;","outputs":1,"noerr":0,"x":747,"y":2236,"wires":[["8846fb3d.287488","56eafc4d.1350c4","48050c65.fb3784","88029ffa.6fdb7","77f9ec1.2ff3b14"]]},{"id":"48050c65.fb3784","type":"switch","z":"dea130da.51821","name":"","property":"payload.alarm","propertyType":"msg","rules":[{"t":"eq","v":"true","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":967,"y":2276,"wires":[["dc90454f.3b6568","2a52876c.30bdf8"]]},{"id":"ee434de1.8464","type":"ui_toast","z":"dea130da.51821","position":"top right","displayTime":"3","highlight":"","outputs":0,"ok":"OK","cancel":"","topic":"ALARM","name":"","x":1327,"y":2276,"wires":[]},{"id":"dc90454f.3b6568","type":"function","z":"dea130da.51821","name":"alarm_msg","func":"msg.payload = {};\nmsg.payload = \"HIGH TEMPERATURE for vehicle 002\";\nreturn msg;","outputs":1,"noerr":0,"x":1127,"y":2276,"wires":[["ee434de1.8464"]]},{"id":"4116f00.a7f3a1","type":"switch","z":"dea130da.51821","name":"","property":"payload.vibration","propertyType":"msg","rules":[{"t":"gte","v":"4800","vt":"num"}],"checkall":"true","repair":false,"outputs":1,"x":967,"y":2196,"wires":[["83d56007.dd0f7","2a52876c.30bdf8"]]},{"id":"83d56007.dd0f7","type":"function","z":"dea130da.51821","name":"alarm_msg","func":"msg.payload = {};\nmsg.payload = \"HIGH VIBRATION for vehicle 002\";\nreturn msg;","outputs":1,"noerr":0,"x":1127,"y":2196,"wires":[["1137023.f72e2fe"]]},{"id":"1137023.f72e2fe","type":"ui_toast","z":"dea130da.51821","position":"top right","displayTime":"3","highlight":"","outputs":0,"ok":"OK","cancel":"","topic":"ALARM","name":"","x":1327,"y":2196,"wires":[]},{"id":"7e1eda87.cee424","type":"ui_text","z":"dea130da.51821","group":"5b5979ba.325888","order":1,"width":"0","height":"0","name":"lat_long","label":"LATITUDE LONGITUDE","format":"{{msg.payload.latlong}}","layout":"col-center","x":975,"y":2446,"wires":[]},{"id":"6e1eaf75.b67d8","type":"ui_gauge","z":"dea130da.51821","name":"Temperature","group":"5b5979ba.325888","order":2,"width":0,"height":0,"gtype":"gage","title":"Temperature","label":"°C","format":"{{msg.payload.temperature}}","min":0,"max":"15","colors":["#007be0","#03bd00","#ca3838"],"seg1":"6","seg2":"9","x":985,"y":2566,"wires":[]},{"id":"b1e45b08.5682d8","type":"mqtt in","z":"dea130da.51821","name":"eshipping/warehouse/dashboard/003","topic":"eshipping/warehouse/dashboard/003","qos":"2","broker":"80474ea8.9a951","x":145,"y":2486,"wires":[["ecdebd78.017c3"]]},{"id":"ecdebd78.017c3","type":"function","z":"dea130da.51821","name":"check_msg","func":"var info = msg.payload.split(\" \");\n\nmsg.payload = {};\nmsg.payload.type = info[0];\nmsg.payload.data = info[1];\nreturn msg;","outputs":1,"noerr":0,"x":415,"y":2486,"wires":[["c33c504c.33be7"]]},{"id":"c33c504c.33be7","type":"switch","z":"dea130da.51821","name":"","property":"payload.type","propertyType":"msg","rules":[{"t":"eq","v":"STANDARD","vt":"str"},{"t":"eq","v":"FRAGILE","vt":"str"},{"t":"eq","v":"FRIGO","vt":"str"}],"checkall":"true","repair":false,"outputs":3,"x":565,"y":2486,"wires":[["97a1f450.471168"],["80bf567e.b40298"],["c27bef88.f6073"]]},{"id":"97a1f450.471168","type":"function","z":"dea130da.51821","name":"set_dash_std","func":"var data = msg.payload.data.split(\"_\");\n\nvar lat = data[0];\nvar long = data[1];\n\nmsg.payload.latlong = lat + \", \" + long;\nmsg.payload.vibration = 0;\nmsg.payload.temperature = 0;\nmsg.payload.humidity = 0;\n\nreturn msg;","outputs":1,"noerr":0,"x":745,"y":2446,"wires":[["7e1eda87.cee424","6e1eaf75.b67d8","4a1bb5f8.bf43ac","91d4a62e.0f3588"]]},{"id":"80bf567e.b40298","type":"function","z":"dea130da.51821","name":"set_dash_frg","func":"var data = msg.payload.data.split(\"_\");\n\nvar lat = data[0];\nvar long = data[1];\nvar vib = data[2];\n\nmsg.payload = {};\nmsg.payload.latlong = lat + \", \" + long;\nmsg.payload.vibration = vib;\nmsg.payload.temperature = 0;\nmsg.payload.humidity = 0;\nreturn msg;","outputs":1,"noerr":0,"x":745,"y":2486,"wires":[["6e1eaf75.b67d8","7e1eda87.cee424","4ac8bf79.89393","4a1bb5f8.bf43ac","91d4a62e.0f3588"]]},{"id":"c27bef88.f6073","type":"function","z":"dea130da.51821","name":"set_dash_fri","func":"var data = msg.payload.data.split(\"_\");\n\nvar lat = data[0];\nvar long = data[1];\nvar tmp = data[2];\nvar alarm = data[3];\nvar hum = data[4];\n\nmsg.payload.latlong = lat + \", \" + long;\nmsg.payload.vibration = 0;\nmsg.payload.temperature = tmp;\nmsg.payload.alarm = alarm;\nmsg.payload.humidity = hum;\nreturn msg;","outputs":1,"noerr":0,"x":745,"y":2566,"wires":[["6e1eaf75.b67d8","7e1eda87.cee424","7d4345a4.a3ba8c","4a1bb5f8.bf43ac","91d4a62e.0f3588"]]},{"id":"7d4345a4.a3ba8c","type":"switch","z":"dea130da.51821","name":"","property":"payload.alarm","propertyType":"msg","rules":[{"t":"eq","v":"true","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":965,"y":2606,"wires":[["abfb1bd3.6cab98","578122b8.80d33c"]]},{"id":"f535b736.aaad08","type":"ui_toast","z":"dea130da.51821","position":"top right","displayTime":"3","highlight":"","outputs":0,"ok":"OK","cancel":"","topic":"ALARM","name":"","x":1325,"y":2606,"wires":[]},{"id":"abfb1bd3.6cab98","type":"function","z":"dea130da.51821","name":"alarm_msg","func":"msg.payload = {};\nmsg.payload = \"HIGH TEMPERATURE for vehicle 003\";\nreturn msg;","outputs":1,"noerr":0,"x":1125,"y":2606,"wires":[["f535b736.aaad08"]]},{"id":"4ac8bf79.89393","type":"switch","z":"dea130da.51821","name":"","property":"payload.vibration","propertyType":"msg","rules":[{"t":"gte","v":"4800","vt":"num"}],"checkall":"true","repair":false,"outputs":1,"x":965,"y":2526,"wires":[["4793ffc5.36647","578122b8.80d33c"]]},{"id":"4793ffc5.36647","type":"function","z":"dea130da.51821","name":"alarm_msg","func":"msg.payload = {};\nmsg.payload = \"HIGH VIBRATION for vehicle 003\";\nreturn msg;","outputs":1,"noerr":0,"x":1125,"y":2526,"wires":[["b5b62cb3.3b01b"]]},{"id":"b5b62cb3.3b01b","type":"ui_toast","z":"dea130da.51821","position":"top right","displayTime":"3","highlight":"","outputs":0,"ok":"OK","cancel":"","topic":"ALARM","name":"","x":1324,"y":2524,"wires":[]},{"id":"8b5b4a3e.f5f7a8","type":"ui_text","z":"dea130da.51821","group":"9cc32162.f807e","order":1,"width":"0","height":"0","name":"lat_long","label":"LATITUDE LONGITUDE","format":"{{msg.payload.latlong}}","layout":"col-center","x":984,"y":2771,"wires":[]},{"id":"9dabf1b6.041da","type":"ui_gauge","z":"dea130da.51821","name":"Temperature","group":"9cc32162.f807e","order":2,"width":0,"height":0,"gtype":"gage","title":"Temperature","label":"°C","format":"{{msg.payload.temperature}}","min":0,"max":"15","colors":["#007be0","#03bd00","#ca3838"],"seg1":"6","seg2":"9","x":994,"y":2891,"wires":[]},{"id":"30bf5a79.3d10b6","type":"mqtt in","z":"dea130da.51821","name":"eshipping/warehouse/dashboard/004","topic":"eshipping/warehouse/dashboard/004","qos":"2","broker":"80474ea8.9a951","x":154,"y":2811,"wires":[["f1b41453.426098"]]},{"id":"f1b41453.426098","type":"function","z":"dea130da.51821","name":"check_msg","func":"var info = msg.payload.split(\" \");\n\nmsg.payload = {};\nmsg.payload.type = info[0];\nmsg.payload.data = info[1];\nreturn msg;","outputs":1,"noerr":0,"x":424,"y":2811,"wires":[["fee0fa50.bb3cf8"]]},{"id":"fee0fa50.bb3cf8","type":"switch","z":"dea130da.51821","name":"","property":"payload.type","propertyType":"msg","rules":[{"t":"eq","v":"STANDARD","vt":"str"},{"t":"eq","v":"FRAGILE","vt":"str"},{"t":"eq","v":"FRIGO","vt":"str"}],"checkall":"true","repair":false,"outputs":3,"x":574,"y":2811,"wires":[["e36e9688.faa518"],["aea63c66.3f544"],["206c8cf6.8f4f24"]]},{"id":"e36e9688.faa518","type":"function","z":"dea130da.51821","name":"set_dash_std","func":"var data = msg.payload.data.split(\"_\");\n\nvar lat = data[0];\nvar long = data[1];\n\nmsg.payload.latlong = lat + \", \" + long;\nmsg.payload.vibration = 0;\nmsg.payload.temperature = 0;\nmsg.payload.humidity = 0;\n\nreturn msg;","outputs":1,"noerr":0,"x":754,"y":2771,"wires":[["8b5b4a3e.f5f7a8","9dabf1b6.041da","bc5de8d8.a5be08","3495fc04.c2f2f4"]]},{"id":"aea63c66.3f544","type":"function","z":"dea130da.51821","name":"set_dash_frg","func":"var data = msg.payload.data.split(\"_\");\n\nvar lat = data[0];\nvar long = data[1];\nvar vib = data[2];\n\nmsg.payload = {};\nmsg.payload.latlong = lat + \", \" + long;\nmsg.payload.vibration = vib;\nmsg.payload.temperature = 0;\nmsg.payload.humidity = 0;\nreturn msg;","outputs":1,"noerr":0,"x":754,"y":2811,"wires":[["9dabf1b6.041da","8b5b4a3e.f5f7a8","2119b2af.e57e9e","bc5de8d8.a5be08","3495fc04.c2f2f4"]]},{"id":"206c8cf6.8f4f24","type":"function","z":"dea130da.51821","name":"set_dash_fri","func":"var data = msg.payload.data.split(\"_\");\n\nvar lat = data[0];\nvar long = data[1];\nvar tmp = data[2];\nvar alarm = data[3];\nvar hum = data[4];\n\nmsg.payload.latlong = lat + \", \" + long;\nmsg.payload.vibration = 0;\nmsg.payload.temperature = tmp;\nmsg.payload.alarm = alarm;\nmsg.payload.humidity = hum;\nreturn msg;","outputs":1,"noerr":0,"x":754,"y":2891,"wires":[["9dabf1b6.041da","8b5b4a3e.f5f7a8","c202f2b5.04cf5","bc5de8d8.a5be08","3495fc04.c2f2f4"]]},{"id":"c202f2b5.04cf5","type":"switch","z":"dea130da.51821","name":"","property":"payload.alarm","propertyType":"msg","rules":[{"t":"eq","v":"true","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":974,"y":2931,"wires":[["c023b72c.539df8","25c5e269.7aa22e"]]},{"id":"2dd39ef4.ddd462","type":"ui_toast","z":"dea130da.51821","position":"top right","displayTime":"3","highlight":"","outputs":0,"ok":"OK","cancel":"","topic":"ALARM","name":"","x":1336,"y":2931,"wires":[]},{"id":"c023b72c.539df8","type":"function","z":"dea130da.51821","name":"alarm_msg","func":"msg.payload = {};\nmsg.payload = \"HIGH TEMPERATURE for vehicle 004\";\nreturn msg;","outputs":1,"noerr":0,"x":1134,"y":2931,"wires":[["2dd39ef4.ddd462"]]},{"id":"2119b2af.e57e9e","type":"switch","z":"dea130da.51821","name":"","property":"payload.vibration","propertyType":"msg","rules":[{"t":"gte","v":"4800","vt":"num"}],"checkall":"true","repair":false,"outputs":1,"x":974,"y":2851,"wires":[["7d054d3.43a80b4","25c5e269.7aa22e"]]},{"id":"7d054d3.43a80b4","type":"function","z":"dea130da.51821","name":"alarm_msg","func":"msg.payload = {};\nmsg.payload = \"HIGH VIBRATION for vehicle 004\";\nreturn msg;","outputs":1,"noerr":0,"x":1134,"y":2851,"wires":[["79bb050a.99bcbc"]]},{"id":"79bb050a.99bcbc","type":"ui_toast","z":"dea130da.51821","position":"top right","displayTime":"3","highlight":"","outputs":0,"ok":"OK","cancel":"","topic":"ALARM","name":"","x":1334,"y":2851,"wires":[]},{"id":"afefb1c.d73f65","type":"ui_gauge","z":"dea130da.51821","name":"","group":"63ce6e83.8ba4e","order":3,"width":"0","height":"0","gtype":"compass","title":"Humidity ","label":"% H2O","format":"{{msg.payload.humidity}}","min":0,"max":"100","colors":["#00b500","#c4e600","#ffb100"],"seg1":"","seg2":"","x":981,"y":1630,"wires":[]},{"id":"1dfb190.122b2e7","type":"ui_gauge","z":"dea130da.51821","name":"","group":"9706cd08.73513","order":3,"width":0,"height":0,"gtype":"compass","title":"Humidity ","label":"% H2O","format":"{{msg.payload.humidity}}","min":0,"max":"100","colors":["#00b500","#c4e600","#ffb100"],"seg1":"","seg2":"","x":977,"y":1973,"wires":[]},{"id":"88029ffa.6fdb7","type":"ui_gauge","z":"dea130da.51821","name":"","group":"76b5e9ae.5e5068","order":3,"width":0,"height":0,"gtype":"compass","title":"Humidity ","label":"% H2O","format":"{{msg.payload.humidity}}","min":0,"max":"100","colors":["#00b500","#c4e600","#ffb100"],"seg1":"","seg2":"","x":977,"y":2321,"wires":[]},{"id":"4a1bb5f8.bf43ac","type":"ui_gauge","z":"dea130da.51821","name":"","group":"5b5979ba.325888","order":3,"width":0,"height":0,"gtype":"compass","title":"Humidity ","label":"% H2O","format":"{{msg.payload.humidity}}","min":0,"max":"100","colors":["#00b500","#c4e600","#ffb100"],"seg1":"","seg2":"","x":975,"y":2656,"wires":[]},{"id":"bc5de8d8.a5be08","type":"ui_gauge","z":"dea130da.51821","name":"","group":"9cc32162.f807e","order":3,"width":0,"height":0,"gtype":"compass","title":"Humidity ","label":"% H2O","format":"{{msg.payload.humidity}}","min":0,"max":"100","colors":["#00b500","#c4e600","#ffb100"],"seg1":"","seg2":"","x":984,"y":2971,"wires":[]},{"id":"784e25ac.69d73c","type":"ui_template","z":"dea130da.51821","group":"6dbdbf4b.b9cc4","name":"","order":0,"width":"20","height":"14","format":"<html>\n  <head>\n    <title>Simple Map</title>\n    <meta name=\"viewport\" content=\"initial-scale=1.0\">\n    <meta charset=\"utf-8\">\n    <style>\n      /* Always set the map height explicitly to define the size of the div\n       * element that contains the map. */\n      #map {\n        height: 100%;\n      }\n      /* Optional: Makes the sample page fill the window. */\n      html, body {\n        height: 100%;\n        margin: 0;\n        padding: 0;\n      }\n    </style>\n  </head>\n  <body>\n    <div id=\"map\"></div>\n    <script>\n      var eshipping_map;\n      var warehouse_position;\n      var marker000;\n      var marker001;\n      var marker002;\n      var marker003;\n      var marker004;\n\n      function initMap() {\n\n        warehouse_position = {lat: 45.817539, lng: 8.826307};\n\n        eshipping_map = new google.maps.Map(document.getElementById('map'), {\n          center: warehouse_position, \n          zoom: 9.5\n        });\n\n        marker000 = new google.maps.Marker({\n          position: warehouse_position,\n          map: eshipping_map,\n          animation: google.maps.Animation.DROP,\n          zIndex: 5,\n          label: '000',\n          title: 'Vehicle: 000'\n        });\n\n        marker001 = new google.maps.Marker({\n          position: warehouse_position,\n          map: eshipping_map,\n          animation: google.maps.Animation.DROP,\n          zIndex: 4,\n          label: '001',\n          title: 'Vehicle: 001'\n        });\n\n        marker002 = new google.maps.Marker({\n          position: warehouse_position,\n          map: eshipping_map,\n          animation: google.maps.Animation.DROP,\n          zIndex: 3,\n          label: '002',\n          title: 'Vehicle: 002'\n        });\n\n        marker003 = new google.maps.Marker({\n          position: warehouse_position,\n          map: eshipping_map,\n          animation: google.maps.Animation.DROP,\n          zIndex: 2,\n          label: '003',\n          title: 'Vehicle: 003'\n        });\n\n        marker004 = new google.maps.Marker({\n          position: warehouse_position,\n          map: eshipping_map,\n          animation: google.maps.Animation.DROP,\n          zIndex: 1,\n          label: '004',\n          title: 'Vehicle: 004'\n        });\n\n      }\n\n      (function(scope) {\n        scope.$watch('msg.payload', function(data) {\n          var splitted = data.split(\"_\");\n          var command = splitted[0];\n\n          switch(command){\n            case \"END\":\n              var vehicleID = splitted[1];\n              endVehicleRunning(vehicleID);\n              break;\n              \n            case \"MOVE\":\n              var vehicleID = splitted[1];\n              var latitude = parseFloat(splitted[2]);\n              var longitude = parseFloat(splitted[3]);\n              changeVehiclePosition(vehicleID,latitude,longitude);\n              break;\n          }\n        \n        });\n      })(scope);\n\n      function endVehicleRunning(vehicleID){\n        switch(vehicleID){\n          case \"000\":\n            marker000.setPosition(warehouse_position);\n            break;\n          case \"001\":\n            marker001.setPosition(warehouse_position);\n            break;\n          case \"002\":\n            marker002.setPosition(warehouse_position);\n            break;\n          case \"003\":\n            marker003.setPosition(warehouse_position);\n            break;\n          case \"004\":\n            marker004.setPosition(warehouse_position);\n            break;\n        }\n      }\n\n      function changeVehiclePosition(vehicleID, latitude, longitude){\n        var newPosition = {lat: latitude, lng: longitude};\n        switch(vehicleID){\n          case \"000\":\n            marker000.setPosition(newPosition);\n            break;\n          case \"001\":\n            marker001.setPosition(newPosition);\n            break;\n          case \"002\":\n            marker002.setPosition(newPosition);\n            break;\n          case \"003\":\n            marker003.setPosition(newPosition);\n            break;\n          case \"004\":\n            marker004.setPosition(newPosition);\n            break;\n        }\n      }\n\n    </script>\n    <script src=\"https://maps.googleapis.com/maps/api/js?key=AIzaSyDS41PRnAvPIsaf4OaKcDttKL8lbBCaIWc&callback=initMap\"\nasync defer></script>\n  </body>\n</html>","storeOutMessages":true,"fwdInMessages":true,"templateScope":"local","x":899,"y":999,"wires":[[]]},{"id":"26c7c248.e43dee","type":"mqtt in","z":"dea130da.51821","name":"eshipping/warehouse/dashboard/map","topic":"eshipping/warehouse/dashboard/map","qos":"2","broker":"80474ea8.9a951","x":639,"y":998,"wires":[["784e25ac.69d73c"]]},{"id":"28152284.fc6cae","type":"function","z":"dea130da.51821","name":"set_notification","func":"var vehicleID = msg.payload.vehicleID;\nvar productInfo = msg.payload.productInfo;\nvar productArray = productInfo.split(\"_\");\nvar productID = productArray[0];\nvar destination = productArray[2];\nvar productType = productArray[3];\n\nmsg.payload = {};\nmsg.payload= \"Vehicle \" + vehicleID + \" is delivering product  \" + productID + \" in \" + productType + \" mode to \" + destination;\n\nreturn msg;","outputs":1,"noerr":0,"x":1509,"y":950,"wires":[["2cf1cc62.039d84"]]},{"id":"2cf1cc62.039d84","type":"ui_toast","z":"dea130da.51821","position":"dialog","displayTime":"3","highlight":"","outputs":1,"ok":"OK","cancel":"","topic":"INFORMATION","name":"","x":1729,"y":949,"wires":[[]]},{"id":"c7617768.9b44b8","type":"function","z":"dea130da.51821","name":"set_notification","func":"var id = msg.payload;\nmsg.payload = {};\n\nmsg.payload= id + \" product info are written in RFID tag.\";\n\nreturn msg;","outputs":1,"noerr":0,"x":342,"y":200,"wires":[["f70d9e0e.6e233"]]},{"id":"f70d9e0e.6e233","type":"ui_toast","z":"dea130da.51821","position":"dialog","displayTime":"3","highlight":"","outputs":1,"ok":"OK","cancel":"","topic":"INFORMATION","name":"","x":583,"y":199,"wires":[[]]},{"id":"6a927ccd.aea694","type":"ui_button","z":"dea130da.51821","name":"","group":"3da3ef80.285e1","order":1,"width":0,"height":0,"passthru":false,"label":"Reset DB","color":"","bgcolor":"","icon":"","payload":"","payloadType":"str","topic":"","x":88,"y":3206,"wires":[["b754da3c.56f2b8","993e10d3.01b65"]]},{"id":"7b8c3b2b.b7dc24","type":"mongodb3 in","z":"dea130da.51821","service":"_ext_","configNode":"4ef22acf.5c8814","name":"E-Shipping DB","collection":"products","operation":"updateMany","x":504,"y":3166,"wires":[["782b1597.7d18cc"]]},{"id":"b754da3c.56f2b8","type":"function","z":"dea130da.51821","name":"reset_products_query","func":"var id = msg.payload;\nmsg.payload = {};\nmsg.payload=[{\"status\": {$ne:\"TOSELL\"}},\n                {$set:{\"status\" : \"TOSELL\"}},\n                {},\n                undefined];\n\nreturn msg;","outputs":1,"noerr":0,"x":288,"y":3166,"wires":[["7b8c3b2b.b7dc24"]]},{"id":"993e10d3.01b65","type":"function","z":"dea130da.51821","name":"reset_vehicles_query","func":"var id = msg.payload;\nmsg.payload = {};\nmsg.payload=[{},\n                {$set:{\n                        \"status\" : \"AVAILABLE\",\n                        \"productID\" : null,\n                        \"sensorType\" : null,\n                        \"alarms\" : 0\n                }},\n                {},\n                undefined];\n\nreturn msg;","outputs":1,"noerr":0,"x":288,"y":3246,"wires":[["461b78e.b1c3088"]]},{"id":"461b78e.b1c3088","type":"mongodb3 in","z":"dea130da.51821","service":"_ext_","configNode":"4ef22acf.5c8814","name":"E-Shipping DB","collection":"vehicles","operation":"updateMany","x":491,"y":3245,"wires":[["782b1597.7d18cc"]]},{"id":"ffa5a04c.88ba2","type":"comment","z":"dea130da.51821","name":"Database management & dashboard","info":"","x":168,"y":3106,"wires":[]},{"id":"37fc1165.f66aae","type":"ui_toast","z":"dea130da.51821","position":"dialog","displayTime":"5","highlight":"","outputs":1,"ok":"OK","cancel":"","topic":"WARNING","name":"","x":1178,"y":3206,"wires":[[]]},{"id":"9e2f739b.7fff8","type":"function","z":"dea130da.51821","name":"message_restart_java","func":"msg.payload = \"It is Recommended to restart Java Application\";\nreturn msg;","outputs":1,"noerr":0,"x":968,"y":3206,"wires":[["37fc1165.f66aae"]]},{"id":"782b1597.7d18cc","type":"join","z":"dea130da.51821","name":"","mode":"custom","build":"array","property":"payload","propertyType":"msg","key":"topic","joiner":"\\n","joinerType":"str","accumulate":false,"timeout":"","count":"2","reduceRight":false,"reduceExp":"","reduceInit":"","reduceInitType":"","reduceFixup":"","x":788,"y":3206,"wires":[["9e2f739b.7fff8","ca242ba.abecfd8"]]},{"id":"25c5e269.7aa22e","type":"function","z":"dea130da.51821","name":"inc_alarms","func":"var id = msg.payload;\nmsg.payload = {};\nmsg.payload=[{\"id\": \"004\"},\n                {$inc:{\n                        \"alarms\" : 1\n                }},\n                {},\n                undefined];\n\nreturn msg;","outputs":1,"noerr":0,"x":1518.5,"y":2888.5999755859375,"wires":[["65ce95d4.1ca29c"]]},{"id":"65ce95d4.1ca29c","type":"mongodb3 in","z":"dea130da.51821","service":"_ext_","configNode":"4ef22acf.5c8814","name":"E-Shipping DB","collection":"vehicles","operation":"update","x":1712,"y":2888,"wires":[[]]},{"id":"cd372e57.2c9d7","type":"mongodb3 in","z":"dea130da.51821","service":"_ext_","configNode":"4ef22acf.5c8814","name":"E-Shipping DB","collection":"vehicles","operation":"update","x":1696,"y":2566,"wires":[[]]},{"id":"578122b8.80d33c","type":"function","z":"dea130da.51821","name":"inc_alarms","func":"var id = msg.payload;\nmsg.payload = {};\nmsg.payload=[{\"id\": \"003\"},\n                {$inc:{\n                        \"alarms\" : 1\n                }},\n                {},\n                undefined];\n\nreturn msg;","outputs":1,"noerr":0,"x":1504.5,"y":2566.5999755859375,"wires":[["cd372e57.2c9d7"]]},{"id":"203838f6.c9b598","type":"mongodb3 in","z":"dea130da.51821","service":"_ext_","configNode":"4ef22acf.5c8814","name":"E-Shipping DB","collection":"vehicles","operation":"update","x":1696,"y":2230,"wires":[[]]},{"id":"2a52876c.30bdf8","type":"function","z":"dea130da.51821","name":"inc_alarms","func":"var id = msg.payload;\nmsg.payload = {};\nmsg.payload=[{\"id\": \"002\"},\n                {$inc:{\n                        \"alarms\" : 1\n                }},\n                {},\n                undefined];\n\nreturn msg;","outputs":1,"noerr":0,"x":1504.5,"y":2230.5999755859375,"wires":[["203838f6.c9b598"]]},{"id":"871e2565.a86228","type":"mongodb3 in","z":"dea130da.51821","service":"_ext_","configNode":"4ef22acf.5c8814","name":"E-Shipping DB","collection":"vehicles","operation":"update","x":1701,"y":1896,"wires":[[]]},{"id":"b9fb5de8.a0d13","type":"function","z":"dea130da.51821","name":"inc_alarms","func":"var id = msg.payload;\nmsg.payload = {};\nmsg.payload=[{\"id\": \"001\"},\n                {$inc:{\n                        \"alarms\" : 1\n                }},\n                {},\n                undefined];\n\nreturn msg;","outputs":1,"noerr":0,"x":1509.5,"y":1896.5999755859375,"wires":[["871e2565.a86228"]]},{"id":"9f93717c.04e22","type":"mongodb3 in","z":"dea130da.51821","service":"_ext_","configNode":"4ef22acf.5c8814","name":"E-Shipping DB","collection":"vehicles","operation":"update","x":1705,"y":1551,"wires":[[]]},{"id":"b8105b00.09b668","type":"function","z":"dea130da.51821","name":"inc_alarms","func":"var id = msg.payload;\nmsg.payload = {};\nmsg.payload=[{\"id\": \"000\"},\n                {$inc:{\n                        \"alarms\" : 1\n                }},\n                {},\n                undefined];\n\nreturn msg;","outputs":1,"noerr":0,"x":1513.5,"y":1551.5999755859375,"wires":[["9f93717c.04e22"]]},{"id":"72eb306b.b3112","type":"ui_chart","z":"dea130da.51821","name":"","group":"63ce6e83.8ba4e","order":4,"width":"5","height":"5","label":"Vibration level","chartType":"line","legend":"false","xformat":"HH:mm:ss","interpolate":"bezier","nodata":"","dot":false,"ymin":"0","ymax":"5000","removeOlder":1,"removeOlderPoints":"","removeOlderUnit":"3600","cutout":0,"useOneColor":false,"colors":["#1f77b4","#aec7e8","#ff7f0e","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5"],"useOldStyle":false,"x":1329,"y":1429.550048828125,"wires":[[],[]]},{"id":"62d13446.02784c","type":"function","z":"dea130da.51821","name":"get_vibration","func":"var vibration = msg.payload.vibration;\nmsg.payload = {};\nmsg.payload = vibration;\n\nreturn msg;\n","outputs":1,"noerr":0,"x":1132,"y":1472.5999755859375,"wires":[["72eb306b.b3112"]]},{"id":"11e0db0.9dd7e25","type":"ui_chart","z":"dea130da.51821","name":"","group":"9706cd08.73513","order":4,"width":"5","height":"5","label":"Vibration level","chartType":"line","legend":"false","xformat":"HH:mm:ss","interpolate":"bezier","nodata":"","dot":false,"ymin":"0","ymax":"5000","removeOlder":1,"removeOlderPoints":"","removeOlderUnit":"3600","cutout":0,"useOneColor":false,"colors":["#1f77b4","#aec7e8","#ff7f0e","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5"],"useOldStyle":false,"x":1322,"y":1776.9500732421875,"wires":[[],[]]},{"id":"817bafb8.7be3a","type":"ui_chart","z":"dea130da.51821","name":"","group":"76b5e9ae.5e5068","order":4,"width":"5","height":"5","label":"Vibration level","chartType":"line","legend":"false","xformat":"HH:mm:ss","interpolate":"bezier","nodata":"","dot":false,"ymin":"0","ymax":"5000","removeOlder":1,"removeOlderPoints":"","removeOlderUnit":"3600","cutout":0,"useOneColor":false,"colors":["#1f77b4","#aec7e8","#ff7f0e","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5"],"useOldStyle":false,"x":1328,"y":2113.9501953125,"wires":[[],[]]},{"id":"aa6bd576.5b8308","type":"ui_chart","z":"dea130da.51821","name":"","group":"5b5979ba.325888","order":4,"width":"5","height":"5","label":"Vibration level","chartType":"line","legend":"false","xformat":"HH:mm:ss","interpolate":"bezier","nodata":"","dot":false,"ymin":"0","ymax":"5000","removeOlder":1,"removeOlderPoints":"","removeOlderUnit":"3600","cutout":0,"useOneColor":false,"colors":["#1f77b4","#aec7e8","#ff7f0e","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5"],"useOldStyle":false,"x":1334,"y":2448.9501953125,"wires":[[],[]]},{"id":"6d6ef32.588960c","type":"ui_chart","z":"dea130da.51821","name":"","group":"9cc32162.f807e","order":4,"width":"5","height":"5","label":"Vibration level","chartType":"line","legend":"false","xformat":"HH:mm:ss","interpolate":"bezier","nodata":"","dot":false,"ymin":"0","ymax":"5000","removeOlder":1,"removeOlderPoints":"","removeOlderUnit":"3600","cutout":0,"useOneColor":false,"colors":["#1f77b4","#aec7e8","#ff7f0e","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5"],"useOldStyle":false,"x":1337,"y":2769.9501953125,"wires":[[],[]]},{"id":"9f6ced43.ea47b","type":"switch","z":"dea130da.51821","name":"","property":"payload.vibration","propertyType":"msg","rules":[{"t":"eq","v":"0","vt":"str"},{"t":"else"}],"checkall":"true","repair":false,"outputs":2,"x":971,"y":1468.5999755859375,"wires":[["c36e7d39.e3d23"],["62d13446.02784c"]]},{"id":"c36e7d39.e3d23","type":"function","z":"dea130da.51821","name":"clear","func":"msg.payload = [];\nreturn msg;","outputs":1,"noerr":0,"x":1137,"y":1430.5999755859375,"wires":[["72eb306b.b3112"]]},{"id":"780d3cb.a5569c4","type":"function","z":"dea130da.51821","name":"clear","func":"msg.payload = [];\nreturn msg;","outputs":1,"noerr":0,"x":1127,"y":1777,"wires":[["11e0db0.9dd7e25"]]},{"id":"a3db4625.4e7d68","type":"function","z":"dea130da.51821","name":"get_vibration","func":"var vibration = msg.payload.vibration;\nmsg.payload = {};\nmsg.payload = vibration;\n\nreturn msg;\n","outputs":1,"noerr":0,"x":1126,"y":1818,"wires":[["11e0db0.9dd7e25"]]},{"id":"77bc807a.08a8a","type":"switch","z":"dea130da.51821","name":"","property":"payload.vibration","propertyType":"msg","rules":[{"t":"eq","v":"0","vt":"str"},{"t":"else"}],"checkall":"true","repair":false,"outputs":2,"x":967,"y":1818,"wires":[["780d3cb.a5569c4"],["a3db4625.4e7d68"]]},{"id":"c5a4f195.6067","type":"function","z":"dea130da.51821","name":"clear","func":"msg.payload = [];\nreturn msg;","outputs":1,"noerr":0,"x":1131,"y":2113,"wires":[["817bafb8.7be3a"]]},{"id":"6f8628b.95d97d8","type":"function","z":"dea130da.51821","name":"get_vibration","func":"var vibration = msg.payload.vibration;\nmsg.payload = {};\nmsg.payload = vibration;\n\nreturn msg;\n","outputs":1,"noerr":0,"x":1129,"y":2161,"wires":[["817bafb8.7be3a"]]},{"id":"77f9ec1.2ff3b14","type":"switch","z":"dea130da.51821","name":"","property":"payload.vibration","propertyType":"msg","rules":[{"t":"eq","v":"0","vt":"str"},{"t":"else"}],"checkall":"true","repair":false,"outputs":2,"x":965,"y":2156,"wires":[["c5a4f195.6067"],["6f8628b.95d97d8"]]},{"id":"453c8e95.3d38a","type":"function","z":"dea130da.51821","name":"clear","func":"msg.payload = [];\nreturn msg;","outputs":1,"noerr":0,"x":1108,"y":2450,"wires":[["aa6bd576.5b8308"]]},{"id":"a236af64.301c1","type":"function","z":"dea130da.51821","name":"get_vibration","func":"var vibration = msg.payload.vibration;\nmsg.payload = {};\nmsg.payload = vibration;\n\nreturn msg;\n","outputs":1,"noerr":0,"x":1126,"y":2490,"wires":[["aa6bd576.5b8308"]]},{"id":"91d4a62e.0f3588","type":"switch","z":"dea130da.51821","name":"","property":"payload.vibration","propertyType":"msg","rules":[{"t":"eq","v":"0","vt":"str"},{"t":"else"}],"checkall":"true","repair":false,"outputs":2,"x":967,"y":2484,"wires":[["453c8e95.3d38a"],["a236af64.301c1"]]},{"id":"1fb6add1.716452","type":"function","z":"dea130da.51821","name":"clear","func":"msg.payload = [];\nreturn msg;","outputs":1,"noerr":0,"x":1137,"y":2770,"wires":[["6d6ef32.588960c"]]},{"id":"3e0ce4d6.52258c","type":"function","z":"dea130da.51821","name":"get_vibration","func":"var vibration = msg.payload.vibration;\nmsg.payload = {};\nmsg.payload = vibration;\n\nreturn msg;\n","outputs":1,"noerr":0,"x":1136,"y":2815,"wires":[["6d6ef32.588960c"]]},{"id":"3495fc04.c2f2f4","type":"switch","z":"dea130da.51821","name":"","property":"payload.vibration","propertyType":"msg","rules":[{"t":"eq","v":"0","vt":"str"},{"t":"else"}],"checkall":"true","repair":false,"outputs":2,"x":975,"y":2810,"wires":[["1fb6add1.716452"],["3e0ce4d6.52258c"]]},{"id":"8a210fc4.4abf4","type":"comment","z":"dea130da.51821","name":"Dashboard Vehicle 000","info":"","x":109,"y":1408.199951171875,"wires":[]},{"id":"5a095f24.0a65b","type":"comment","z":"dea130da.51821","name":"Dashboard Vehicle 001","info":"","x":105,"y":1758.199951171875,"wires":[]},{"id":"95578d57.45498","type":"comment","z":"dea130da.51821","name":"Dashboard Vehicle 002","info":"","x":109,"y":2106.199951171875,"wires":[]},{"id":"acc18674.9bca28","type":"comment","z":"dea130da.51821","name":"Dashboard Vehicle 003","info":"","x":105,"y":2436.199951171875,"wires":[]},{"id":"eea2e6d6.1fda48","type":"comment","z":"dea130da.51821","name":"Dashboard Vehicle 004","info":"","x":109,"y":2748.199951171875,"wires":[]},{"id":"e7b7685d.8dda68","type":"comment","z":"dea130da.51821","name":"Dashboard Vehicle map","info":"","x":591,"y":942.199951171875,"wires":[]},{"id":"a19c26f1.a7a448","type":"ui_button","z":"dea130da.51821","name":"","group":"3da3ef80.285e1","order":1,"width":0,"height":0,"passthru":false,"label":"Update Statistics","color":"","bgcolor":"","icon":"","payload":"","payloadType":"str","topic":"","x":121,"y":3605,"wires":[["71b0cda1.7b5654","fdefd53b.012fd8","16c7051.04f45fb","5cc27a5.6d70384","ccca1d43.09ca6"]]},{"id":"cc5dc753.9ed448","type":"ui_chart","z":"dea130da.51821","name":"alarms_history","group":"a0b5d56f.745558","order":2,"width":0,"height":0,"label":"Alarms history","chartType":"bar","legend":"false","xformat":"HH:mm:ss","interpolate":"linear","nodata":"","dot":false,"ymin":"","ymax":"","removeOlder":1,"removeOlderPoints":"","removeOlderUnit":"3600","cutout":0,"useOneColor":false,"colors":["#F9C784","#FCAF58","#FF8C42","#2CA02C","#98DF8A","#D62728","#FF9896","#9467BD","#C5B0D5"],"useOldStyle":false,"x":1411,"y":3405,"wires":[[],[]]},{"id":"9f0071fb.0d677","type":"function","z":"dea130da.51821","name":"set_charts","func":"var array = msg.payload;\nvar msg = {};\nvar msg1 = {};\nvar msg2 = {};\nvar msg3 = {};\nvar msg4 = {};\nvar i;\n\nfor(i=0; i<array.length; i++){\n    \n    var id = array[i].id;\n    \n    switch (id) {\n    case \"000\":\n        msg.payload = array[i].alarms;\n        msg.topic = \"V 000\";\n        break;\n    case \"001\":\n        msg1.payload = array[i].alarms;\n        msg1.topic = \"V 001\";\n        break;\n    case \"002\":\n        msg2.payload = array[i].alarms;\n        msg2.topic = \"V 002\";\n        break;\n    case \"003\":\n        msg3.payload = array[i].alarms;\n        msg3.topic = \"V 003\";\n        break;\n    case \"004\":\n        msg4.payload = array[i].alarms;\n        msg4.topic = \"V 004\";\n        break;\n   \n    }\n}\n\n\nreturn [msg,msg1,msg2,msg3,msg4];","outputs":5,"noerr":0,"x":741,"y":3405,"wires":[["cc5dc753.9ed448"],["cc5dc753.9ed448"],["cc5dc753.9ed448"],["cc5dc753.9ed448"],["cc5dc753.9ed448"]]},{"id":"2bc5dc22.224284","type":"ui_chart","z":"dea130da.51821","name":"","group":"a5086385.6031e","order":3,"width":0,"height":0,"label":"Status Products","chartType":"pie","legend":"true","xformat":"HH:mm:ss","interpolate":"linear","nodata":"","dot":false,"ymin":"","ymax":"","removeOlder":1,"removeOlderPoints":"","removeOlderUnit":"3600","cutout":"60","useOneColor":false,"colors":["#F9C784","#FCAF58","#FF8C42","#2CA02C","#98DF8A","#D62728","#FF9896","#9467BD","#C5B0D5"],"useOldStyle":false,"x":1411,"y":3705,"wires":[[],[]]},{"id":"917a10c7.5b9e2","type":"function","z":"dea130da.51821","name":"set_charts","func":"\nvar m={\n    \"series\":[\"X\"],\n    \"data\":[[msg.payload.tosell,msg.payload.delivered,msg.payload.indelivery]],\n    \"labels\":[\"TOSELL\",\"DELIVERED\",\"IN DELIVERY\"]\n};\nreturn {payload:[m]};","outputs":1,"noerr":0,"x":1221,"y":3705,"wires":[["2bc5dc22.224284"]]},{"id":"71b0cda1.7b5654","type":"function","z":"dea130da.51821","name":"get_vehicles","func":"msg.payload = {};\nreturn msg;\n","outputs":1,"noerr":0,"x":361,"y":3405,"wires":[["bfc785bf.eabde8"]]},{"id":"bfc785bf.eabde8","type":"mongodb3 in","z":"dea130da.51821","service":"_ext_","configNode":"5a236ca9.ae3bd4","name":"E-Shipping DB","collection":"vehicles","operation":"find.toArray","x":551,"y":3405,"wires":[["9f0071fb.0d677"]]},{"id":"fdefd53b.012fd8","type":"function","z":"dea130da.51821","name":"get_tosell_product","func":"msg.payload = {\"status\":\"TOSELL\"};\nreturn msg;\n","outputs":1,"noerr":0,"x":381,"y":3645,"wires":[["5e9b7953.93d468"]]},{"id":"5e9b7953.93d468","type":"mongodb3 in","z":"dea130da.51821","service":"_ext_","configNode":"5a236ca9.ae3bd4","name":"E-Shipping DB","collection":"products","operation":"count","x":591,"y":3645,"wires":[["d3a0702.187f59"]]},{"id":"16c7051.04f45fb","type":"function","z":"dea130da.51821","name":"get_delivered_product","func":"msg.payload = {\"status\":\"DELIVERED\"};\nreturn msg;\n","outputs":1,"noerr":0,"x":391,"y":3705,"wires":[["f01aa925.b00b38"]]},{"id":"f01aa925.b00b38","type":"mongodb3 in","z":"dea130da.51821","service":"_ext_","configNode":"5a236ca9.ae3bd4","name":"E-Shipping DB","collection":"products","operation":"count","x":591,"y":3705,"wires":[["4594fb0b.d396c4"]]},{"id":"5cc27a5.6d70384","type":"function","z":"dea130da.51821","name":"get_indelivery_product","func":"msg.payload = {\"status\":\"INDELIVERY\"};\nreturn msg;\n","outputs":1,"noerr":0,"x":391,"y":3765,"wires":[["a78bc58b.558068"]]},{"id":"a78bc58b.558068","type":"mongodb3 in","z":"dea130da.51821","service":"_ext_","configNode":"5a236ca9.ae3bd4","name":"E-Shipping DB","collection":"products","operation":"count","x":591,"y":3765,"wires":[["bc65d4e5.e7f2c8"]]},{"id":"738a3090.b4e43","type":"join","z":"dea130da.51821","name":"","mode":"custom","build":"array","property":"payload","propertyType":"msg","key":"topic","joiner":"\\n","joinerType":"str","accumulate":false,"timeout":"","count":"3","reduceRight":false,"reduceExp":"","reduceInit":"","reduceInitType":"","reduceFixup":"","x":941,"y":3705,"wires":[["f696977c.46c2f8"]]},{"id":"d3a0702.187f59","type":"function","z":"dea130da.51821","name":"create_obj","func":"var tosell = msg.payload;\nmsg.payload = {};\nmsg.payload.tosell = tosell;\nreturn msg;","outputs":1,"noerr":0,"x":761,"y":3645,"wires":[["738a3090.b4e43"]]},{"id":"4594fb0b.d396c4","type":"function","z":"dea130da.51821","name":"create_obj","func":"var delivered = msg.payload;\nmsg.payload = {};\nmsg.payload.delivered = delivered;\nreturn msg;","outputs":1,"noerr":0,"x":761,"y":3705,"wires":[["738a3090.b4e43"]]},{"id":"bc65d4e5.e7f2c8","type":"function","z":"dea130da.51821","name":"create_obj","func":"var indelivery = msg.payload;\nmsg.payload = {};\nmsg.payload.indelivery = indelivery;\nreturn msg;","outputs":1,"noerr":0,"x":761,"y":3765,"wires":[["738a3090.b4e43"]]},{"id":"f696977c.46c2f8","type":"function","z":"dea130da.51821","name":"join_obj","func":"var obj1=msg.payload[0];\nvar obj2=msg.payload[1];\nvar obj3=msg.payload[2];\n\nmsg.payload = Object.assign(obj1,obj2,obj3);\n\n\n\nreturn msg;","outputs":1,"noerr":0,"x":1071,"y":3705,"wires":[["917a10c7.5b9e2"]]},{"id":"ccca1d43.09ca6","type":"function","z":"dea130da.51821","name":"get_product","func":"msg.payload = {$or:[\n    {\"status\":\"DELIVERED\"},\n    {\"status\":\"INDELIVERY\"}\n    ]};\nreturn msg;\n","outputs":1,"noerr":0,"x":361,"y":3545,"wires":[["9a5bd3c0.33bc5"]]},{"id":"9a5bd3c0.33bc5","type":"mongodb3 in","z":"dea130da.51821","service":"_ext_","configNode":"5a236ca9.ae3bd4","name":"E-Shipping DB","collection":"products","operation":"find.toArray","x":551,"y":3545,"wires":[["2a9fca66.f0b216"]]},{"id":"2a9fca66.f0b216","type":"function","z":"dea130da.51821","name":"set_charts","func":"var res = msg.payload;\n\nvar msg = {};\nvar msg1 = {};\nvar msg2 = {};\nmsg.payload = 0;\nmsg.topic = \"STANDARD\";\nmsg1.payload = 0;\nmsg1.topic = \"FRAGILE\";\nmsg2.payload = 0;\nmsg2.topic = \"FRIGO\";\n\nvar i;\n\nfor(i=0;i<res.length;i++){\n    type = res[i].type;\n    \n    switch(type){\n        case \"STANDARD\":\n            msg.payload++;\n            break;\n        case \"FRAGILE\":\n            msg1.payload++;\n            break;\n        case \"FRIGO\":\n            msg2.payload++;\n            break;\n    }\n}\n\n\nreturn [msg,msg1,msg2];","outputs":3,"noerr":0,"x":741,"y":3545,"wires":[["6e8299ee.e86e38"],["6e8299ee.e86e38"],["6e8299ee.e86e38"]]},{"id":"6e8299ee.e86e38","type":"ui_chart","z":"dea130da.51821","name":"","group":"77beb897.a26738","order":1,"width":0,"height":0,"label":"Type Delivered or IN Delivery","chartType":"bar","legend":"false","xformat":"HH:mm:ss","interpolate":"linear","nodata":"","dot":false,"ymin":"","ymax":"","removeOlder":1,"removeOlderPoints":"","removeOlderUnit":"3600","cutout":0,"useOneColor":false,"colors":["#F9C784","#FCAF58","#FF8C42","#2CA02C","#98DF8A","#D62728","#FF9896","#9467BD","#C5B0D5"],"useOldStyle":false,"x":1451,"y":3545,"wires":[[],[]]},{"id":"ca242ba.abecfd8","type":"function","z":"dea130da.51821","name":"reset_statistics_charts","func":"msg.payload = {};\nmsg.payload = [];\nreturn msg;","outputs":1,"noerr":0,"x":1041,"y":3345,"wires":[["cc5dc753.9ed448","2bc5dc22.224284","6e8299ee.e86e38"]]},{"id":"f600a2f8.72ef3","type":"switch","z":"f16fa519.d79ca8","name":"","property":"payload","propertyType":"msg","rules":[{"t":"istype","v":"string","vt":"string"},{"t":"istype","v":"array","vt":"array"}],"checkall":"true","repair":false,"outputs":2,"x":370,"y":180,"wires":[["4a94c37.d70c43c"],["7d3390c0.4c924"]]},{"id":"7d3390c0.4c924","type":"function","z":"f16fa519.d79ca8","name":"get_first","func":"var array = msg.payload;\nvar jsonObject = array[0];\n\nmsg.payload = {};\nmsg.payload = jsonObject;\n\nreturn msg;","outputs":1,"noerr":0,"x":440,"y":240,"wires":[[]]},{"id":"4a94c37.d70c43c","type":"mqtt out","z":"f16fa519.d79ca8","name":"eshipping/warehouse/error","topic":"eshipping/warehouse/error","qos":"2","retain":"","broker":"7e40374f.4607e8","x":631,"y":81,"wires":[]},{"id":"29967fc1.18538","type":"function","z":"8c5719d3.6d6278","name":"read_message","func":"var string = msg.payload;\nvar array = string.split(\"###\");\nvar productInfo = array[1];\nvar arrayProduct = productInfo.split(\"_\");\n\nmsg.payload = {};\nmsg.payload.idVehicle = array[0];\nmsg.payload.productID = arrayProduct[0];\nmsg.payload.productDescription = arrayProduct[1];\nmsg.payload.productDestination = arrayProduct[2];\nmsg.payload.productType = arrayProduct[3];\n\nreturn msg;","outputs":1,"noerr":0,"x":222,"y":94,"wires":[["bec026cc.b66068","87c3e0cd.abc19"]]},{"id":"87c3e0cd.abc19","type":"join","z":"8c5719d3.6d6278","name":"","mode":"custom","build":"array","property":"payload","propertyType":"msg","key":"topic","joiner":"\\n","joinerType":"str","accumulate":false,"timeout":"","count":"2","reduceRight":false,"reduceExp":"","reduceInit":"","reduceInitType":"","reduceFixup":"","x":822,"y":94,"wires":[[]]},{"id":"4287d1a5.14b59","type":"function","z":"8c5719d3.6d6278","name":"get_waypoints","func":"var object = msg.payload;\nvar waypoints = object.waypoints;\n\nmsg.payload = {};\nmsg.payload.waypoints = waypoints;\n\nreturn msg;","outputs":1,"noerr":0,"x":592,"y":134,"wires":[["87c3e0cd.abc19"]]},{"id":"4ed0a1ab.e444","type":"function","z":"8c5719d3.6d6278","name":"read_answer","func":"var array = msg.payload;\n\nif(array.length === 0){\n        msg.payload = {};\n        msg.payload = \"ERROR destination_not_found\";\n} \n\nreturn msg;","outputs":1,"noerr":0,"x":432,"y":274,"wires":[["c912c6c3.bff138"]]},{"id":"146949ba.2465b6","type":"mongodb3 in","z":"8c5719d3.6d6278","service":"_ext_","configNode":"c237b681.3e8028","name":"E-Shipping DB","collection":"travels_test","operation":"find.toArray","x":362,"y":214,"wires":[["4ed0a1ab.e444"]]},{"id":"bec026cc.b66068","type":"function","z":"8c5719d3.6d6278","name":"find_destination_query","func":"var destination = msg.payload.productDestination;\n\nmsg.operation=\"find.toArray\";\nmsg.payload={\"destination\" : destination};\n\nreturn msg;","outputs":1,"noerr":0,"x":294,"y":154,"wires":[["146949ba.2465b6"]]},{"id":"c912c6c3.bff138","type":"subflow:f16fa519.d79ca8","z":"8c5719d3.6d6278","name":"","x":562,"y":334,"wires":[["4287d1a5.14b59"],["87c3e0cd.abc19"]]},{"id":"92fd839e.a0e48","type":"mqtt out","z":"fb60b192.47c6a","name":"eshipping/vehicles/error","topic":"eshipping/vehicles/error","qos":"2","retain":"","broker":"1b2b9aa3.dd8225","x":790,"y":300,"wires":[]},{"id":"26964533.0e6fda","type":"function","z":"fb60b192.47c6a","name":"Manage Error","func":"msg.payload = msg.payload.message; \nreturn msg;","outputs":1,"noerr":0,"x":520,"y":300,"wires":[["92fd839e.a0e48"]]},{"id":"a58be731.803e48","type":"switch","z":"fb60b192.47c6a","name":"","property":"payload.answer","propertyType":"msg","rules":[{"t":"eq","v":"OK","vt":"str"},{"t":"eq","v":"DELIVERED","vt":"str"},{"t":"eq","v":"ERROR","vt":"str"}],"checkall":"true","repair":false,"outputs":3,"x":350,"y":180,"wires":[[],[],["26964533.0e6fda"]]},{"id":"5ac01d3c.d6be84","type":"function","z":"fb60b192.47c6a","name":"Check","func":"var string = msg.payload.toString(\"utf8\");\nvar splitted = string.split(\" \");\nmsg.payload = {};\nmsg.payload.answer = splitted[0];\nmsg.payload.message = splitted[1];//stringa lat_long\n\nreturn msg;","outputs":1,"noerr":0,"x":200,"y":180,"wires":[["a58be731.803e48"]]},{"id":"4b7863e6.1a7bcc","type":"mqtt in","z":"b1c7abcb.eb6ad8","name":"eshipping/vehicle/000/start","topic":"eshipping/vehicle/000/start","qos":"2","broker":"1cf99f41.c3c031","x":146,"y":94.4285659790039,"wires":[["ce1ad739.a707e8"]]},{"id":"d2820f60.10c38","type":"function","z":"b1c7abcb.eb6ad8","name":"check_msg","func":"var obj1 = msg.payload[0];\nvar obj2 = msg.payload[1];\n\nmsg.payload = Object.assign(obj1,obj2);\n\nvar array = msg.payload.waypoints;\n\nif(Array.isArray(array)){\n    msg.payload.loopNumber = array.length;\n    msg.payload.counter = 0;\n}else{\n    msg.payload = {};\n    msg.payload.ProductType = \"ERROR\";\n}\n\n\nreturn msg;","outputs":1,"noerr":0,"x":566,"y":94.4285659790039,"wires":[["bb1f7bc1.ae4568"]]},{"id":"bb1f7bc1.ae4568","type":"switch","z":"b1c7abcb.eb6ad8","name":"check_error","property":"payload.productType","propertyType":"msg","rules":[{"t":"eq","v":"ERROR","vt":"str"},{"t":"eq","v":"STANDARD","vt":"str"},{"t":"eq","v":"FRAGILE","vt":"str"},{"t":"eq","v":"FRIGO","vt":"str"}],"checkall":"true","repair":false,"outputs":4,"x":666,"y":354.4285659790039,"wires":[["dc168388.e1d83"],["3b8799b2.cdce66"],["5e38a5a3.75e23c"],["4ede4580.05de8c"]]},{"id":"18db536c.0ed93d","type":"switch","z":"b1c7abcb.eb6ad8","name":"counter_check","property":"payload.counter","propertyType":"msg","rules":[{"t":"lt","v":"payload.loopNumber","vt":"msg"},{"t":"else"}],"checkall":"true","repair":false,"outputs":2,"x":1116,"y":194.4285659790039,"wires":[["835f5451.98f508","216442c7.1026ee"],["bffce6c9.20bf08"]]},{"id":"835f5451.98f508","type":"function","z":"b1c7abcb.eb6ad8","name":"increment_counter","func":"var counter = msg.payload.counter;\ncounter = counter +1;\nmsg.payload.counter = counter;\n\nreturn msg;","outputs":1,"noerr":0,"x":1046,"y":114.4285659790039,"wires":[["b9d8b4cd.76ac58"]]},{"id":"b9d8b4cd.76ac58","type":"delay","z":"b1c7abcb.eb6ad8","name":"","pauseType":"delay","timeout":"4","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":1216,"y":114.4285659790039,"wires":[["18db536c.0ed93d"]]},{"id":"216442c7.1026ee","type":"function","z":"b1c7abcb.eb6ad8","name":"set_msg","func":"var counter = msg.payload.counter;\nvar position = msg.payload.waypoints[counter];\nvar latitude = position.latitude;\nvar longitude = position.longitude;\nvar message = \"STANDARD SET \" + latitude + \" \" + longitude + \" \\n\";\n\nmsg.payload = {};\nmsg.payload = message;\n\nreturn msg;","outputs":1,"noerr":0,"x":1356,"y":174.4285659790039,"wires":[["24d3936e.da4c2c"]]},{"id":"bffce6c9.20bf08","type":"function","z":"b1c7abcb.eb6ad8","name":"set_msg","func":"var message = \"END \" + msg.payload.productID + \" \\n\";\nmsg.payload = {};\nmsg.payload = message;\n\nreturn msg;","outputs":1,"noerr":0,"x":1356,"y":214.4285659790039,"wires":[["bfced1d5.33544"]]},{"id":"bfced1d5.33544","type":"tcp request","z":"b1c7abcb.eb6ad8","server":"localhost","port":"9090","out":"char","splitc":"\\n","name":"END","x":1526,"y":214.4285659790039,"wires":[["5fdda66d.a5a8b8"]]},{"id":"24d3936e.da4c2c","type":"tcp request","z":"b1c7abcb.eb6ad8","server":"localhost","port":"9090","out":"char","splitc":"\\n","name":"STANDARD SET","x":1526,"y":174.4285659790039,"wires":[["742af532.e2f5bc"]]},{"id":"3b8799b2.cdce66","type":"delay","z":"b1c7abcb.eb6ad8","name":"Wait Vehicle","pauseType":"delay","timeout":"2","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":886,"y":194.4285659790039,"wires":[["18db536c.0ed93d"]]},{"id":"73eab7fb.e515e8","type":"delay","z":"b1c7abcb.eb6ad8","name":"Wait Vehicle","pauseType":"delay","timeout":"2","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":1106,"y":354.4285659790039,"wires":[["83a2272c.ba5408"]]},{"id":"83a2272c.ba5408","type":"switch","z":"b1c7abcb.eb6ad8","name":"counter_check","property":"payload.counter","propertyType":"msg","rules":[{"t":"lt","v":"payload.loopNumber","vt":"msg"},{"t":"else"}],"checkall":"true","repair":false,"outputs":2,"x":1316,"y":354.4285659790039,"wires":[["17e3220d.da33fe","7236950.578bd6c"],["165f1956.400d67"]]},{"id":"165f1956.400d67","type":"function","z":"b1c7abcb.eb6ad8","name":"set_msg","func":"var message = \"END \" + msg.payload.productID + \" \\n\";\nmsg.payload = {};\nmsg.payload = message;\n\nreturn msg;","outputs":1,"noerr":0,"x":1536,"y":374.4285659790039,"wires":[["913d9f09.cc981"]]},{"id":"7236950.578bd6c","type":"function","z":"b1c7abcb.eb6ad8","name":"set_msg","func":"var counter = msg.payload.counter;\nvar position = msg.payload.waypoints[counter];\nvar latitude = position.latitude;\nvar longitude = position.longitude;\nvar message = \"FRAGILE SET \" + latitude + \" \" + longitude + \" \"+msg.payload.vibrationDetected +\" \\n\";\n\nmsg.payload = {};\nmsg.payload = message;\n\nreturn msg;","outputs":1,"noerr":0,"x":1536,"y":334.4285659790039,"wires":[["41bcd806.73e578"]]},{"id":"99de74bd.7802e8","type":"delay","z":"b1c7abcb.eb6ad8","name":"","pauseType":"delay","timeout":"4","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":1416,"y":274.4285659790039,"wires":[["83a2272c.ba5408"]]},{"id":"17e3220d.da33fe","type":"function","z":"b1c7abcb.eb6ad8","name":"increment_counter","func":"var counter = msg.payload.counter;\ncounter = counter +1;\nmsg.payload.counter = counter;\nmsg.payload.vibrationDetected = Math.floor((Math.random() * 5000) + 1);\n\nreturn msg;","outputs":1,"noerr":0,"x":1226,"y":274.4285659790039,"wires":[["99de74bd.7802e8"]]},{"id":"5e38a5a3.75e23c","type":"function","z":"b1c7abcb.eb6ad8","name":"init_vibration","func":"msg.payload.vibrationDetected = 0;\nreturn msg;","outputs":1,"noerr":0,"x":866,"y":354.4285659790039,"wires":[["73eab7fb.e515e8"]]},{"id":"41bcd806.73e578","type":"tcp request","z":"b1c7abcb.eb6ad8","server":"localhost","port":"9090","out":"char","splitc":"\\n","name":"FRAGILE SET","x":1696,"y":334.4285659790039,"wires":[["47a6ebe7.4eff24"]]},{"id":"913d9f09.cc981","type":"tcp request","z":"b1c7abcb.eb6ad8","server":"localhost","port":"9090","out":"char","splitc":"\\n","name":"END","x":1686,"y":374.4285659790039,"wires":[["30fe1b9e.5189e4"]]},{"id":"4ede4580.05de8c","type":"delay","z":"b1c7abcb.eb6ad8","name":"Wait Vehicle","pauseType":"delay","timeout":"2","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":866,"y":594.4285659790039,"wires":[["3d87c631.6718ca"]]},{"id":"3d87c631.6718ca","type":"switch","z":"b1c7abcb.eb6ad8","name":"counter_check","property":"payload.counter","propertyType":"msg","rules":[{"t":"lt","v":"payload.loopNumber","vt":"msg"},{"t":"else"}],"checkall":"true","repair":false,"outputs":2,"x":1076,"y":594.4285659790039,"wires":[["aca406b0.13d678","f86f8fc5.1e59c"],["32b97446.47a12c"]]},{"id":"aca406b0.13d678","type":"function","z":"b1c7abcb.eb6ad8","name":"store_info","func":"\nreturn msg;","outputs":1,"noerr":0,"x":1416,"y":514.4285659790039,"wires":[["2ce4fb4e.c8e054"]]},{"id":"f86f8fc5.1e59c","type":"function","z":"b1c7abcb.eb6ad8","name":"get_sim","func":"msg.payload = {};\nmsg.payload = \"FRIGO GETSIM \\n\";\nreturn msg;","outputs":1,"noerr":0,"x":1276,"y":594.4285659790039,"wires":[["ff334229.564fc"]]},{"id":"ff334229.564fc","type":"tcp request","z":"b1c7abcb.eb6ad8","server":"localhost","port":"9090","out":"char","splitc":"\\n","name":"FRIGO GET","x":1426,"y":594.4285659790039,"wires":[["831602d0.370d4"]]},{"id":"1cdd5d77.1e66e3","type":"function","z":"b1c7abcb.eb6ad8","name":"Check","func":"var info = msg.payload.message.split(\"_\"); //frigo_dehum_temp_hum\n\nmsg.payload = {};\n\nvar switchWho;\n\nif(info[0] == \"true\" && info[1] == \"true\"){\n    \n    switchWho = 1;\n    \n}else if(info[0] == \"true\" && info[1] == \"false\"){\n    \n    switchWho = 2;\n    \n}else if(info[0] == \"false\" && info[1] == \"true\"){\n    \n    switchWho = 3;\n    \n}else if(info[0] == \"false\" && info[1] == \"false\"){\n    \n    switchWho = 4;\n    \n}\n\nmsg.payload.tmp = info[2];\nmsg.payload.hum = info[3];\nmsg.payload.switchWho = switchWho;\n\nreturn msg;","outputs":1,"noerr":0,"x":1806,"y":654.4285659790039,"wires":[["7ec3df1.623ed2"]]},{"id":"7ec3df1.623ed2","type":"switch","z":"b1c7abcb.eb6ad8","name":"","property":"payload.switchWho","propertyType":"msg","rules":[{"t":"eq","v":"1","vt":"num"},{"t":"eq","v":"2","vt":"num"},{"t":"eq","v":"3","vt":"num"},{"t":"eq","v":"4","vt":"num"}],"checkall":"true","repair":false,"outputs":4,"x":1746,"y":754.4285659790039,"wires":[["2ce2e21b.4cd98e"],["2212fba7.2fe8b4"],["e783202e.84ced"],["fbed745b.056ce8"]]},{"id":"2ce2e21b.4cd98e","type":"function","z":"b1c7abcb.eb6ad8","name":"dec_all","func":"var tmp = Number(msg.payload.tmp);\nvar hum = Number(msg.payload.hum);\n\nmsg.payload.tmp = tmp - 1;\nmsg.payload.hum = hum - 5;\nreturn msg;","outputs":1,"noerr":0,"x":1936,"y":694.4285659790039,"wires":[["2ce4fb4e.c8e054"]]},{"id":"2212fba7.2fe8b4","type":"function","z":"b1c7abcb.eb6ad8","name":"dec_tmp","func":"var tmp = Number(msg.payload.tmp);\nvar hum = Number(msg.payload.hum);\n\nmsg.payload.tmp = tmp -1;\nmsg.payload.hum = hum + 5;\nreturn msg;","outputs":1,"noerr":0,"x":1936,"y":734.4285659790039,"wires":[["2ce4fb4e.c8e054"]]},{"id":"e783202e.84ced","type":"function","z":"b1c7abcb.eb6ad8","name":"dec_hum","func":"var tmp = Number(msg.payload.tmp);\nvar hum = Number(msg.payload.hum);\n\nvar randomUp = Math.floor(Math.random() * 3);\n\nmsg.payload.tmp = tmp + randomUp;\nmsg.payload.hum = hum - 5;\nreturn msg;","outputs":1,"noerr":0,"x":1936,"y":774.4285659790039,"wires":[["2ce4fb4e.c8e054"]]},{"id":"fbed745b.056ce8","type":"function","z":"b1c7abcb.eb6ad8","name":"inc_all","func":"var tmp = Number(msg.payload.tmp);\nvar hum = Number(msg.payload.hum);\n\nvar randomUp = Math.floor(Math.random() * 4);\n\nmsg.payload.tmp = tmp + randomUp;\nmsg.payload.hum = hum + 5;\nreturn msg;","outputs":1,"noerr":0,"x":1926,"y":814.4285659790039,"wires":[["2ce4fb4e.c8e054"]]},{"id":"2ce4fb4e.c8e054","type":"join","z":"b1c7abcb.eb6ad8","name":"","mode":"custom","build":"array","property":"payload","propertyType":"msg","key":"topic","joiner":"\\n","joinerType":"str","accumulate":false,"timeout":"","count":"2","reduceRight":false,"reduceExp":"","reduceInit":"","reduceInitType":"","reduceFixup":"","x":2126,"y":694.4285659790039,"wires":[["c20ce82e.7a5238"]]},{"id":"c20ce82e.7a5238","type":"function","z":"b1c7abcb.eb6ad8","name":"merge_join","func":"var obj1 = msg.payload[0];\nvar obj2 = msg.payload[1];\n\nmsg.payload = Object.assign(obj1,obj2);\nreturn msg;","outputs":1,"noerr":0,"x":2126,"y":614.4285659790039,"wires":[["6d4d3243.2af90c","c91ea201.3ebda"]]},{"id":"6d4d3243.2af90c","type":"function","z":"b1c7abcb.eb6ad8","name":"tcp_command","func":"var counter = msg.payload.counter;\nmsg.payload = \"FRIGO SETSIM \" + msg.payload.waypoints[counter].latitude + \" \" + msg.payload.waypoints[counter].longitude + \" \" + msg.payload.tmp + \" \" + msg.payload.hum +\" \\n\";\nreturn msg;","outputs":1,"noerr":0,"x":2316,"y":594.4285659790039,"wires":[["95b018aa.0b18d8"]]},{"id":"95b018aa.0b18d8","type":"tcp request","z":"b1c7abcb.eb6ad8","server":"localhost","port":"9090","out":"char","splitc":"\\n","name":"FRIGO SET","x":2506,"y":614.4285659790039,"wires":[["9cb7068b.bf1988"]]},{"id":"c91ea201.3ebda","type":"delay","z":"b1c7abcb.eb6ad8","name":"","pauseType":"delay","timeout":"4","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":1256,"y":434.4285659790039,"wires":[["60f249ae.7ff378"]]},{"id":"60f249ae.7ff378","type":"function","z":"b1c7abcb.eb6ad8","name":"clear_payload","func":"var waypoints = msg.payload.waypoints;\nvar loopNumber = msg.payload.loopNumber;\nvar counter = msg.payload.counter;\nvar productID = msg.payload.productID\n\nmsg.payload = {};\nmsg.payload.waypoints = waypoints;\nmsg.payload.loopNumber = loopNumber;\nmsg.payload.counter = counter+1;\nmsg.payload.productID = productID;\n\nreturn msg;","outputs":1,"noerr":0,"x":1416,"y":434.4285659790039,"wires":[["3d87c631.6718ca"]]},{"id":"9cb7068b.bf1988","type":"subflow:fb60b192.47c6a","z":"b1c7abcb.eb6ad8","name":"","x":2716,"y":614.4285659790039,"wires":[[],[]]},{"id":"32b97446.47a12c","type":"function","z":"b1c7abcb.eb6ad8","name":"set_msg","func":"var message = \"END \" + msg.payload.productID + \" \\n\";\nmsg.payload = {};\nmsg.payload = message;\n\nreturn msg;","outputs":1,"noerr":0,"x":1176,"y":694.4285659790039,"wires":[["d3f838a4.3133b8"]]},{"id":"d3f838a4.3133b8","type":"tcp request","z":"b1c7abcb.eb6ad8","server":"localhost","port":"9090","out":"char","splitc":"\\n","name":"END","x":1306,"y":694.4285659790039,"wires":[["5e718772.4375a8"]]},{"id":"831602d0.370d4","type":"subflow:fb60b192.47c6a","z":"b1c7abcb.eb6ad8","name":"","x":1596,"y":634.4285659790039,"wires":[["1cdd5d77.1e66e3"],[]]},{"id":"5e718772.4375a8","type":"subflow:fb60b192.47c6a","z":"b1c7abcb.eb6ad8","name":"","x":1516,"y":714.4285659790039,"wires":[[],[]]},{"id":"742af532.e2f5bc","type":"subflow:fb60b192.47c6a","z":"b1c7abcb.eb6ad8","name":"","x":1736,"y":174.4285659790039,"wires":[[],[]]},{"id":"5fdda66d.a5a8b8","type":"subflow:fb60b192.47c6a","z":"b1c7abcb.eb6ad8","name":"","x":1736,"y":214.4285659790039,"wires":[[],[]]},{"id":"47a6ebe7.4eff24","type":"subflow:fb60b192.47c6a","z":"b1c7abcb.eb6ad8","name":"","x":1896,"y":334.4285659790039,"wires":[[],[]]},{"id":"30fe1b9e.5189e4","type":"subflow:fb60b192.47c6a","z":"b1c7abcb.eb6ad8","name":"","x":1896,"y":374.4285659790039,"wires":[[],[]]},{"id":"20377bc1.9ce8c4","type":"mqtt in","z":"b1c7abcb.eb6ad8","name":"eshipping/vehicle/001/start","topic":"eshipping/vehicle/001/start","qos":"2","broker":"1cf99f41.c3c031","x":138.857177734375,"y":911.5714492797851,"wires":[["5abfb4ce.82039c"]]},{"id":"21f2afba.b6b48","type":"function","z":"b1c7abcb.eb6ad8","name":"check_msg","func":"var obj1 = msg.payload[0];\nvar obj2 = msg.payload[1];\n\nmsg.payload = Object.assign(obj1,obj2);\n\nvar array = msg.payload.waypoints;\n\nif(Array.isArray(array)){\n    msg.payload.loopNumber = array.length;\n    msg.payload.counter = 0;\n}else{\n    msg.payload = {};\n    msg.payload.ProductType = \"ERROR\";\n}\n\n\nreturn msg;","outputs":1,"noerr":0,"x":557.333251953125,"y":913.0953140258789,"wires":[["55ad7dcd.4ef5c4"]]},{"id":"55ad7dcd.4ef5c4","type":"switch","z":"b1c7abcb.eb6ad8","name":"check_error","property":"payload.productType","propertyType":"msg","rules":[{"t":"eq","v":"ERROR","vt":"str"},{"t":"eq","v":"STANDARD","vt":"str"},{"t":"eq","v":"FRAGILE","vt":"str"},{"t":"eq","v":"FRIGO","vt":"str"}],"checkall":"true","repair":false,"outputs":4,"x":679.333251953125,"y":1171.0952529907226,"wires":[["a931a362.1cd46"],["9190f164.21f79"],["79c2f8a1.fc01d8"],["3c1001b7.a8c92e"]]},{"id":"1528ec88.71c263","type":"switch","z":"b1c7abcb.eb6ad8","name":"counter_check","property":"payload.counter","propertyType":"msg","rules":[{"t":"lt","v":"payload.loopNumber","vt":"msg"},{"t":"else"}],"checkall":"true","repair":false,"outputs":2,"x":1129.333251953125,"y":1011.0952529907226,"wires":[["2507538f.28c70c","7710d2a9.2bd21c"],["7af105c3.95fadc"]]},{"id":"2507538f.28c70c","type":"function","z":"b1c7abcb.eb6ad8","name":"increment_counter","func":"var counter = msg.payload.counter;\ncounter = counter +1;\nmsg.payload.counter = counter;\n\nreturn msg;","outputs":1,"noerr":0,"x":1059.333251953125,"y":931.0952529907226,"wires":[["d5a376b5.700178"]]},{"id":"d5a376b5.700178","type":"delay","z":"b1c7abcb.eb6ad8","name":"","pauseType":"delay","timeout":"4","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":1229.333251953125,"y":931.0952529907226,"wires":[["1528ec88.71c263"]]},{"id":"7710d2a9.2bd21c","type":"function","z":"b1c7abcb.eb6ad8","name":"set_msg","func":"var counter = msg.payload.counter;\nvar position = msg.payload.waypoints[counter];\nvar latitude = position.latitude;\nvar longitude = position.longitude;\nvar message = \"STANDARD SET \" + latitude + \" \" + longitude + \" \\n\";\n\nmsg.payload = {};\nmsg.payload = message;\n\nreturn msg;","outputs":1,"noerr":0,"x":1369.333251953125,"y":991.0952529907226,"wires":[["fb9c07d0.cda8f8"]]},{"id":"7af105c3.95fadc","type":"function","z":"b1c7abcb.eb6ad8","name":"set_msg","func":"var message = \"END \" + msg.payload.productID + \" \\n\";\nmsg.payload = {};\nmsg.payload = message;\n\nreturn msg;","outputs":1,"noerr":0,"x":1369.333251953125,"y":1031.0952529907226,"wires":[["d51ad74a.861cf8"]]},{"id":"d51ad74a.861cf8","type":"tcp request","z":"b1c7abcb.eb6ad8","server":"localhost","port":"9091","out":"char","splitc":"\\n","name":"END","x":1539.333251953125,"y":1031.0952529907226,"wires":[["9abaeb33.113018"]]},{"id":"fb9c07d0.cda8f8","type":"tcp request","z":"b1c7abcb.eb6ad8","server":"localhost","port":"9091","out":"char","splitc":"\\n","name":"STANDARD SET","x":1539.333251953125,"y":991.0952529907226,"wires":[["ce89ce52.fdf61"]]},{"id":"9190f164.21f79","type":"delay","z":"b1c7abcb.eb6ad8","name":"Wait Vehicle","pauseType":"delay","timeout":"2","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":899.333251953125,"y":1011.0952529907226,"wires":[["1528ec88.71c263"]]},{"id":"6e3c2efe.6625d","type":"delay","z":"b1c7abcb.eb6ad8","name":"Wait Vehicle","pauseType":"delay","timeout":"2","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":1119.333251953125,"y":1171.0952529907226,"wires":[["1066adb0.8b3a32"]]},{"id":"1066adb0.8b3a32","type":"switch","z":"b1c7abcb.eb6ad8","name":"counter_check","property":"payload.counter","propertyType":"msg","rules":[{"t":"lt","v":"payload.loopNumber","vt":"msg"},{"t":"else"}],"checkall":"true","repair":false,"outputs":2,"x":1329.333251953125,"y":1171.0952529907226,"wires":[["4ebeffbb.93e3b","3c596380.61ad1c"],["235266a7.3da9ca"]]},{"id":"235266a7.3da9ca","type":"function","z":"b1c7abcb.eb6ad8","name":"set_msg","func":"var message = \"END \" + msg.payload.productID + \" \\n\";\nmsg.payload = {};\nmsg.payload = message;\n\nreturn msg;","outputs":1,"noerr":0,"x":1549.333251953125,"y":1191.0952529907226,"wires":[["77ace6a.67b8418"]]},{"id":"3c596380.61ad1c","type":"function","z":"b1c7abcb.eb6ad8","name":"set_msg","func":"var counter = msg.payload.counter;\nvar position = msg.payload.waypoints[counter];\nvar latitude = position.latitude;\nvar longitude = position.longitude;\nvar message = \"FRAGILE SET \" + latitude + \" \" + longitude + \" \"+msg.payload.vibrationDetected +\" \\n\";\n\nmsg.payload = {};\nmsg.payload = message;\n\nreturn msg;","outputs":1,"noerr":0,"x":1549.333251953125,"y":1151.0952529907226,"wires":[["4d2d9704.2e04d8"]]},{"id":"49833cd5.ccb2a4","type":"delay","z":"b1c7abcb.eb6ad8","name":"","pauseType":"delay","timeout":"4","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":1429.333251953125,"y":1091.0952529907226,"wires":[["1066adb0.8b3a32"]]},{"id":"4ebeffbb.93e3b","type":"function","z":"b1c7abcb.eb6ad8","name":"increment_counter","func":"var counter = msg.payload.counter;\ncounter = counter +1;\nmsg.payload.counter = counter;\nmsg.payload.vibrationDetected = Math.floor((Math.random() * 5000) + 1);\n\nreturn msg;","outputs":1,"noerr":0,"x":1239.333251953125,"y":1091.0952529907226,"wires":[["49833cd5.ccb2a4"]]},{"id":"79c2f8a1.fc01d8","type":"function","z":"b1c7abcb.eb6ad8","name":"init_vibration","func":"msg.payload.vibrationDetected = 0;\nreturn msg;","outputs":1,"noerr":0,"x":879.333251953125,"y":1171.0952529907226,"wires":[["6e3c2efe.6625d"]]},{"id":"4d2d9704.2e04d8","type":"tcp request","z":"b1c7abcb.eb6ad8","server":"localhost","port":"9091","out":"char","splitc":"\\n","name":"FRAGILE SET","x":1709.333251953125,"y":1151.0952529907226,"wires":[["b94e4e2d.1b994"]]},{"id":"77ace6a.67b8418","type":"tcp request","z":"b1c7abcb.eb6ad8","server":"localhost","port":"9091","out":"char","splitc":"\\n","name":"END","x":1699.333251953125,"y":1191.0952529907226,"wires":[["c0381424.3eb818"]]},{"id":"3c1001b7.a8c92e","type":"delay","z":"b1c7abcb.eb6ad8","name":"Wait Vehicle","pauseType":"delay","timeout":"2","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":879.333251953125,"y":1411.0952529907226,"wires":[["88d38654.73e8b8"]]},{"id":"88d38654.73e8b8","type":"switch","z":"b1c7abcb.eb6ad8","name":"counter_check","property":"payload.counter","propertyType":"msg","rules":[{"t":"lt","v":"payload.loopNumber","vt":"msg"},{"t":"else"}],"checkall":"true","repair":false,"outputs":2,"x":1089.333251953125,"y":1411.0952529907226,"wires":[["64b8a336.db64cc","3883986.fdfae68"],["16bbcd9.a6ea232"]]},{"id":"64b8a336.db64cc","type":"function","z":"b1c7abcb.eb6ad8","name":"store_info","func":"\nreturn msg;","outputs":1,"noerr":0,"x":1429.333251953125,"y":1331.0952529907226,"wires":[["dd43b259.fb861"]]},{"id":"3883986.fdfae68","type":"function","z":"b1c7abcb.eb6ad8","name":"get_sim","func":"msg.payload = {};\nmsg.payload = \"FRIGO GETSIM \\n\";\nreturn msg;","outputs":1,"noerr":0,"x":1289.333251953125,"y":1411.0952529907226,"wires":[["f73bb02c.5e2a4"]]},{"id":"f73bb02c.5e2a4","type":"tcp request","z":"b1c7abcb.eb6ad8","server":"localhost","port":"9091","out":"char","splitc":"\\n","name":"FRIGO GET","x":1439.333251953125,"y":1411.0952529907226,"wires":[["e6b04b11.dc2428"]]},{"id":"323864e0.e2590c","type":"function","z":"b1c7abcb.eb6ad8","name":"Check","func":"var info = msg.payload.message.split(\"_\"); //frigo_dehum_temp_hum\n\nmsg.payload = {};\n\nvar switchWho;\n\nif(info[0] == \"true\" && info[1] == \"true\"){\n    \n    switchWho = 1;\n    \n}else if(info[0] == \"true\" && info[1] == \"false\"){\n    \n    switchWho = 2;\n    \n}else if(info[0] == \"false\" && info[1] == \"true\"){\n    \n    switchWho = 3;\n    \n}else if(info[0] == \"false\" && info[1] == \"false\"){\n    \n    switchWho = 4;\n    \n}\n\nmsg.payload.tmp = info[2];\nmsg.payload.hum = info[3];\nmsg.payload.switchWho = switchWho;\n\nreturn msg;","outputs":1,"noerr":0,"x":1819.333251953125,"y":1471.0952529907226,"wires":[["447977d0.bf4da8"]]},{"id":"447977d0.bf4da8","type":"switch","z":"b1c7abcb.eb6ad8","name":"","property":"payload.switchWho","propertyType":"msg","rules":[{"t":"eq","v":"1","vt":"num"},{"t":"eq","v":"2","vt":"num"},{"t":"eq","v":"3","vt":"num"},{"t":"eq","v":"4","vt":"num"}],"checkall":"true","repair":false,"outputs":4,"x":1759.333251953125,"y":1571.0952529907226,"wires":[["9900e0e6.24eeb"],["3f83c0c1.87cc1"],["3b766b84.3f52a4"],["596348e6.679fe8"]]},{"id":"9900e0e6.24eeb","type":"function","z":"b1c7abcb.eb6ad8","name":"dec_all","func":"var tmp = Number(msg.payload.tmp);\nvar hum = Number(msg.payload.hum);\n\nmsg.payload.tmp = tmp - 1;\nmsg.payload.hum = hum - 5;\nreturn msg;","outputs":1,"noerr":0,"x":1949.333251953125,"y":1511.0952529907226,"wires":[["dd43b259.fb861"]]},{"id":"3f83c0c1.87cc1","type":"function","z":"b1c7abcb.eb6ad8","name":"dec_tmp","func":"var tmp = Number(msg.payload.tmp);\nvar hum = Number(msg.payload.hum);\n\nmsg.payload.tmp = tmp -1;\nmsg.payload.hum = hum + 5;\nreturn msg;","outputs":1,"noerr":0,"x":1949.333251953125,"y":1551.0952529907226,"wires":[["dd43b259.fb861"]]},{"id":"3b766b84.3f52a4","type":"function","z":"b1c7abcb.eb6ad8","name":"dec_hum","func":"var tmp = Number(msg.payload.tmp);\nvar hum = Number(msg.payload.hum);\n\nvar randomUp = Math.floor(Math.random() * 3);\n\nmsg.payload.tmp = tmp + randomUp;\nmsg.payload.hum = hum - 5;\nreturn msg;","outputs":1,"noerr":0,"x":1949.333251953125,"y":1591.0952529907226,"wires":[["dd43b259.fb861"]]},{"id":"596348e6.679fe8","type":"function","z":"b1c7abcb.eb6ad8","name":"inc_all","func":"var tmp = Number(msg.payload.tmp);\nvar hum = Number(msg.payload.hum);\n\nvar randomUp = Math.floor(Math.random() * 4);\n\nmsg.payload.tmp = tmp + randomUp;\nmsg.payload.hum = hum + 5;\nreturn msg;","outputs":1,"noerr":0,"x":1939.333251953125,"y":1631.0952529907226,"wires":[["dd43b259.fb861"]]},{"id":"dd43b259.fb861","type":"join","z":"b1c7abcb.eb6ad8","name":"","mode":"custom","build":"array","property":"payload","propertyType":"msg","key":"topic","joiner":"\\n","joinerType":"str","accumulate":false,"timeout":"","count":"2","reduceRight":false,"reduceExp":"","reduceInit":"","reduceInitType":"","reduceFixup":"","x":2139.333251953125,"y":1511.0952529907226,"wires":[["1a598bb2.3621f4"]]},{"id":"1a598bb2.3621f4","type":"function","z":"b1c7abcb.eb6ad8","name":"merge_join","func":"var obj1 = msg.payload[0];\nvar obj2 = msg.payload[1];\n\nmsg.payload = Object.assign(obj1,obj2);\nreturn msg;","outputs":1,"noerr":0,"x":2139.333251953125,"y":1431.0952529907226,"wires":[["66b7dbca.56b6d4","a9430e95.816d3"]]},{"id":"66b7dbca.56b6d4","type":"function","z":"b1c7abcb.eb6ad8","name":"tcp_command","func":"var counter = msg.payload.counter;\nmsg.payload = \"FRIGO SETSIM \" + msg.payload.waypoints[counter].latitude + \" \" + msg.payload.waypoints[counter].longitude + \" \" + msg.payload.tmp + \" \" + msg.payload.hum +\" \\n\";\nreturn msg;","outputs":1,"noerr":0,"x":2329.333251953125,"y":1411.0952529907226,"wires":[["f10a6c67.f19ba"]]},{"id":"f10a6c67.f19ba","type":"tcp request","z":"b1c7abcb.eb6ad8","server":"localhost","port":"9091","out":"char","splitc":"\\n","name":"FRIGO SET","x":2519.333251953125,"y":1431.0952529907226,"wires":[["d968716f.f66b3"]]},{"id":"a9430e95.816d3","type":"delay","z":"b1c7abcb.eb6ad8","name":"","pauseType":"delay","timeout":"4","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":1269.333251953125,"y":1251.0952529907226,"wires":[["f32ec625.d7e668"]]},{"id":"f32ec625.d7e668","type":"function","z":"b1c7abcb.eb6ad8","name":"clear_payload","func":"var waypoints = msg.payload.waypoints;\nvar loopNumber = msg.payload.loopNumber;\nvar counter = msg.payload.counter;\nvar productID = msg.payload.productID;\n\nmsg.payload = {};\nmsg.payload.waypoints = waypoints;\nmsg.payload.loopNumber = loopNumber;\nmsg.payload.counter = counter+1;\nmsg.payload.productID = productID;\n\nreturn msg;","outputs":1,"noerr":0,"x":1429.333251953125,"y":1251.0952529907226,"wires":[["88d38654.73e8b8"]]},{"id":"d968716f.f66b3","type":"subflow:fb60b192.47c6a","z":"b1c7abcb.eb6ad8","name":"","x":2729.333251953125,"y":1431.0952529907226,"wires":[[],[]]},{"id":"16bbcd9.a6ea232","type":"function","z":"b1c7abcb.eb6ad8","name":"set_msg","func":"var message = \"END \" + msg.payload.productID + \" \\n\";\nmsg.payload = {};\nmsg.payload = message;\n\nreturn msg;","outputs":1,"noerr":0,"x":1189.333251953125,"y":1511.0952529907226,"wires":[["71bcba58.f1cdd4"]]},{"id":"71bcba58.f1cdd4","type":"tcp request","z":"b1c7abcb.eb6ad8","server":"localhost","port":"9091","out":"char","splitc":"\\n","name":"END","x":1319.333251953125,"y":1511.0952529907226,"wires":[["bb650ae6.9379c8"]]},{"id":"e6b04b11.dc2428","type":"subflow:fb60b192.47c6a","z":"b1c7abcb.eb6ad8","name":"","x":1609.333251953125,"y":1451.0952529907226,"wires":[["323864e0.e2590c"],[]]},{"id":"bb650ae6.9379c8","type":"subflow:fb60b192.47c6a","z":"b1c7abcb.eb6ad8","name":"","x":1529.333251953125,"y":1531.0952529907226,"wires":[[],[]]},{"id":"ce89ce52.fdf61","type":"subflow:fb60b192.47c6a","z":"b1c7abcb.eb6ad8","name":"","x":1749.333251953125,"y":991.0952529907226,"wires":[[],[]]},{"id":"9abaeb33.113018","type":"subflow:fb60b192.47c6a","z":"b1c7abcb.eb6ad8","name":"","x":1749.333251953125,"y":1031.0952529907226,"wires":[[],[]]},{"id":"b94e4e2d.1b994","type":"subflow:fb60b192.47c6a","z":"b1c7abcb.eb6ad8","name":"","x":1909.333251953125,"y":1151.0952529907226,"wires":[[],[]]},{"id":"c0381424.3eb818","type":"subflow:fb60b192.47c6a","z":"b1c7abcb.eb6ad8","name":"","x":1909.333251953125,"y":1191.0952529907226,"wires":[[],[]]},{"id":"f05dbc0b.646fd","type":"mqtt in","z":"b1c7abcb.eb6ad8","name":"eshipping/vehicle/002/start","topic":"eshipping/vehicle/002/start","qos":"2","broker":"1cf99f41.c3c031","x":146,"y":1774.428565979004,"wires":[["b3297e45.88a72"]]},{"id":"3e19cec0.59f592","type":"function","z":"b1c7abcb.eb6ad8","name":"check_msg","func":"var obj1 = msg.payload[0];\nvar obj2 = msg.payload[1];\n\nmsg.payload = Object.assign(obj1,obj2);\n\nvar array = msg.payload.waypoints;\n\nif(Array.isArray(array)){\n    msg.payload.loopNumber = array.length;\n    msg.payload.counter = 0;\n}else{\n    msg.payload = {};\n    msg.payload.ProductType = \"ERROR\";\n}\n\n\nreturn msg;","outputs":1,"noerr":0,"x":572.666748046875,"y":1774.4285049438476,"wires":[["4331bdfd.6739e4"]]},{"id":"4331bdfd.6739e4","type":"switch","z":"b1c7abcb.eb6ad8","name":"check_error","property":"payload.productType","propertyType":"msg","rules":[{"t":"eq","v":"ERROR","vt":"str"},{"t":"eq","v":"STANDARD","vt":"str"},{"t":"eq","v":"FRAGILE","vt":"str"},{"t":"eq","v":"FRIGO","vt":"str"}],"checkall":"true","repair":false,"outputs":4,"x":672.666748046875,"y":2034.4285049438476,"wires":[["41bfe039.7e3eb"],["b3b70a07.538818"],["5734d484.b0889c"],["d65993.9638367"]]},{"id":"24d7972b.3d7028","type":"switch","z":"b1c7abcb.eb6ad8","name":"counter_check","property":"payload.counter","propertyType":"msg","rules":[{"t":"lt","v":"payload.loopNumber","vt":"msg"},{"t":"else"}],"checkall":"true","repair":false,"outputs":2,"x":1122.666748046875,"y":1874.4285049438476,"wires":[["e28a1d82.56df8","4687370a.03b228"],["4641fd01.960fd4"]]},{"id":"e28a1d82.56df8","type":"function","z":"b1c7abcb.eb6ad8","name":"increment_counter","func":"var counter = msg.payload.counter;\ncounter = counter +1;\nmsg.payload.counter = counter;\n\nreturn msg;","outputs":1,"noerr":0,"x":1052.666748046875,"y":1794.4285049438476,"wires":[["e4f4123b.926a"]]},{"id":"e4f4123b.926a","type":"delay","z":"b1c7abcb.eb6ad8","name":"","pauseType":"delay","timeout":"4","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":1222.666748046875,"y":1794.4285049438476,"wires":[["24d7972b.3d7028"]]},{"id":"4687370a.03b228","type":"function","z":"b1c7abcb.eb6ad8","name":"set_msg","func":"var counter = msg.payload.counter;\nvar position = msg.payload.waypoints[counter];\nvar latitude = position.latitude;\nvar longitude = position.longitude;\nvar message = \"STANDARD SET \" + latitude + \" \" + longitude + \" \\n\";\n\nmsg.payload = {};\nmsg.payload = message;\n\nreturn msg;","outputs":1,"noerr":0,"x":1362.666748046875,"y":1854.4285049438476,"wires":[["b60190fe.6c84c"]]},{"id":"4641fd01.960fd4","type":"function","z":"b1c7abcb.eb6ad8","name":"set_msg","func":"var message = \"END \" + msg.payload.productID + \" \\n\";\nmsg.payload = {};\nmsg.payload = message;\n\nreturn msg;","outputs":1,"noerr":0,"x":1362.666748046875,"y":1894.4285049438476,"wires":[["7c2a5af0.6c4e94"]]},{"id":"7c2a5af0.6c4e94","type":"tcp request","z":"b1c7abcb.eb6ad8","server":"localhost","port":"9092","out":"char","splitc":"\\n","name":"END","x":1532.666748046875,"y":1894.4285049438476,"wires":[["8db3b637.a15eb8"]]},{"id":"b60190fe.6c84c","type":"tcp request","z":"b1c7abcb.eb6ad8","server":"localhost","port":"9092","out":"char","splitc":"\\n","name":"STANDARD SET","x":1532.666748046875,"y":1854.4285049438476,"wires":[["66345577.be67bc"]]},{"id":"b3b70a07.538818","type":"delay","z":"b1c7abcb.eb6ad8","name":"Wait Vehicle","pauseType":"delay","timeout":"2","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":892.666748046875,"y":1874.4285049438476,"wires":[["24d7972b.3d7028"]]},{"id":"7e86828a.97db3c","type":"delay","z":"b1c7abcb.eb6ad8","name":"Wait Vehicle","pauseType":"delay","timeout":"2","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":1112.666748046875,"y":2034.4285049438476,"wires":[["c760060c.569538"]]},{"id":"c760060c.569538","type":"switch","z":"b1c7abcb.eb6ad8","name":"counter_check","property":"payload.counter","propertyType":"msg","rules":[{"t":"lt","v":"payload.loopNumber","vt":"msg"},{"t":"else"}],"checkall":"true","repair":false,"outputs":2,"x":1322.666748046875,"y":2034.4285049438476,"wires":[["717ff062.62391","c862045f.7b8d28"],["882d5e51.2cba3"]]},{"id":"882d5e51.2cba3","type":"function","z":"b1c7abcb.eb6ad8","name":"set_msg","func":"var message = \"END \" + msg.payload.productID + \" \\n\";\nmsg.payload = {};\nmsg.payload = message;\n\nreturn msg;","outputs":1,"noerr":0,"x":1542.666748046875,"y":2054.4285049438476,"wires":[["50fb8b50.8548c4"]]},{"id":"c862045f.7b8d28","type":"function","z":"b1c7abcb.eb6ad8","name":"set_msg","func":"var counter = msg.payload.counter;\nvar position = msg.payload.waypoints[counter];\nvar latitude = position.latitude;\nvar longitude = position.longitude;\nvar message = \"FRAGILE SET \" + latitude + \" \" + longitude + \" \"+msg.payload.vibrationDetected +\" \\n\";\n\nmsg.payload = {};\nmsg.payload = message;\n\nreturn msg;","outputs":1,"noerr":0,"x":1542.666748046875,"y":2014.4285049438476,"wires":[["ef387741.618608"]]},{"id":"8cafc32b.e3e4f","type":"delay","z":"b1c7abcb.eb6ad8","name":"","pauseType":"delay","timeout":"4","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":1422.666748046875,"y":1954.4285049438476,"wires":[["c760060c.569538"]]},{"id":"717ff062.62391","type":"function","z":"b1c7abcb.eb6ad8","name":"increment_counter","func":"var counter = msg.payload.counter;\ncounter = counter +1;\nmsg.payload.counter = counter;\nmsg.payload.vibrationDetected = Math.floor((Math.random() * 5000) + 1);\n\nreturn msg;","outputs":1,"noerr":0,"x":1232.666748046875,"y":1954.4285049438476,"wires":[["8cafc32b.e3e4f"]]},{"id":"5734d484.b0889c","type":"function","z":"b1c7abcb.eb6ad8","name":"init_vibration","func":"msg.payload.vibrationDetected = 0;\nreturn msg;","outputs":1,"noerr":0,"x":872.666748046875,"y":2034.4285049438476,"wires":[["7e86828a.97db3c"]]},{"id":"ef387741.618608","type":"tcp request","z":"b1c7abcb.eb6ad8","server":"localhost","port":"9092","out":"char","splitc":"\\n","name":"FRAGILE SET","x":1702.666748046875,"y":2014.4285049438476,"wires":[["cf60c255.5828"]]},{"id":"50fb8b50.8548c4","type":"tcp request","z":"b1c7abcb.eb6ad8","server":"localhost","port":"9092","out":"char","splitc":"\\n","name":"END","x":1692.666748046875,"y":2054.4285049438476,"wires":[["c8763078.4139a"]]},{"id":"d65993.9638367","type":"delay","z":"b1c7abcb.eb6ad8","name":"Wait Vehicle","pauseType":"delay","timeout":"2","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":872.666748046875,"y":2274.4285049438476,"wires":[["12baea35.b0b766"]]},{"id":"12baea35.b0b766","type":"switch","z":"b1c7abcb.eb6ad8","name":"counter_check","property":"payload.counter","propertyType":"msg","rules":[{"t":"lt","v":"payload.loopNumber","vt":"msg"},{"t":"else"}],"checkall":"true","repair":false,"outputs":2,"x":1082.666748046875,"y":2274.4285049438476,"wires":[["59252138.0975f","57b671e1.77b97"],["9a861e74.52fb4"]]},{"id":"59252138.0975f","type":"function","z":"b1c7abcb.eb6ad8","name":"store_info","func":"\nreturn msg;","outputs":1,"noerr":0,"x":1422.666748046875,"y":2194.4285049438476,"wires":[["e341d11f.f9a58"]]},{"id":"57b671e1.77b97","type":"function","z":"b1c7abcb.eb6ad8","name":"get_sim","func":"msg.payload = {};\nmsg.payload = \"FRIGO GETSIM \\n\";\nreturn msg;","outputs":1,"noerr":0,"x":1282.666748046875,"y":2274.4285049438476,"wires":[["92b6eb69.bbb7e8"]]},{"id":"92b6eb69.bbb7e8","type":"tcp request","z":"b1c7abcb.eb6ad8","server":"localhost","port":"9092","out":"char","splitc":"\\n","name":"FRIGO GET","x":1432.666748046875,"y":2274.4285049438476,"wires":[["f415dd07.cb8e6"]]},{"id":"6e728721.d23b98","type":"function","z":"b1c7abcb.eb6ad8","name":"Check","func":"var info = msg.payload.message.split(\"_\"); //frigo_dehum_temp_hum\n\nmsg.payload = {};\n\nvar switchWho;\n\nif(info[0] == \"true\" && info[1] == \"true\"){\n    \n    switchWho = 1;\n    \n}else if(info[0] == \"true\" && info[1] == \"false\"){\n    \n    switchWho = 2;\n    \n}else if(info[0] == \"false\" && info[1] == \"true\"){\n    \n    switchWho = 3;\n    \n}else if(info[0] == \"false\" && info[1] == \"false\"){\n    \n    switchWho = 4;\n    \n}\n\nmsg.payload.tmp = info[2];\nmsg.payload.hum = info[3];\nmsg.payload.switchWho = switchWho;\n\nreturn msg;","outputs":1,"noerr":0,"x":1812.666748046875,"y":2334.4285049438476,"wires":[["205b87c4.df2da8"]]},{"id":"205b87c4.df2da8","type":"switch","z":"b1c7abcb.eb6ad8","name":"","property":"payload.switchWho","propertyType":"msg","rules":[{"t":"eq","v":"1","vt":"num"},{"t":"eq","v":"2","vt":"num"},{"t":"eq","v":"3","vt":"num"},{"t":"eq","v":"4","vt":"num"}],"checkall":"true","repair":false,"outputs":4,"x":1752.666748046875,"y":2434.4285049438476,"wires":[["54836205.6e7c0c"],["a6c152b0.ffa6c"],["527841fd.6d29b"],["ef58f3f1.cca85"]]},{"id":"54e429cd.f07cd8","type":"delay","z":"b1c7abcb.eb6ad8","name":"","pauseType":"delay","timeout":"4","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":1262.666748046875,"y":2114.4285049438476,"wires":[["1a1c2aa6.849ef5"]]},{"id":"1a1c2aa6.849ef5","type":"function","z":"b1c7abcb.eb6ad8","name":"clear_payload","func":"var waypoints = msg.payload.waypoints;\nvar loopNumber = msg.payload.loopNumber;\nvar counter = msg.payload.counter;\nvar productID = msg.payload.productID;\n\nmsg.payload = {};\nmsg.payload.waypoints = waypoints;\nmsg.payload.loopNumber = loopNumber;\nmsg.payload.counter = counter+1;\nmsg.payload.productID = productID;\nreturn msg;","outputs":1,"noerr":0,"x":1422.666748046875,"y":2114.4285049438476,"wires":[["12baea35.b0b766"]]},{"id":"9a861e74.52fb4","type":"function","z":"b1c7abcb.eb6ad8","name":"set_msg","func":"var message = \"END \" + msg.payload.productID + \" \\n\";\nmsg.payload = {};\nmsg.payload = message;\n\nreturn msg;","outputs":1,"noerr":0,"x":1182.666748046875,"y":2374.4285049438476,"wires":[["ac8cee9c.c6b29"]]},{"id":"ac8cee9c.c6b29","type":"tcp request","z":"b1c7abcb.eb6ad8","server":"localhost","port":"9092","out":"char","splitc":"\\n","name":"END","x":1312.666748046875,"y":2374.4285049438476,"wires":[["f3f71bbd.133228"]]},{"id":"f415dd07.cb8e6","type":"subflow:fb60b192.47c6a","z":"b1c7abcb.eb6ad8","name":"","x":1602.666748046875,"y":2314.4285049438476,"wires":[["6e728721.d23b98"],[]]},{"id":"f3f71bbd.133228","type":"subflow:fb60b192.47c6a","z":"b1c7abcb.eb6ad8","name":"","x":1522.666748046875,"y":2394.4285049438476,"wires":[[],[]]},{"id":"66345577.be67bc","type":"subflow:fb60b192.47c6a","z":"b1c7abcb.eb6ad8","name":"","x":1742.666748046875,"y":1854.4285049438476,"wires":[[],[]]},{"id":"8db3b637.a15eb8","type":"subflow:fb60b192.47c6a","z":"b1c7abcb.eb6ad8","name":"","x":1742.666748046875,"y":1894.4285049438476,"wires":[[],[]]},{"id":"cf60c255.5828","type":"subflow:fb60b192.47c6a","z":"b1c7abcb.eb6ad8","name":"","x":1902.666748046875,"y":2014.4285049438476,"wires":[[],[]]},{"id":"c8763078.4139a","type":"subflow:fb60b192.47c6a","z":"b1c7abcb.eb6ad8","name":"","x":1902.666748046875,"y":2054.4285049438476,"wires":[[],[]]},{"id":"a2e90d50.352ae","type":"function","z":"b1c7abcb.eb6ad8","name":"merge_join","func":"var obj1 = msg.payload[0];\nvar obj2 = msg.payload[1];\n\nmsg.payload = Object.assign(obj1,obj2);\nreturn msg;","outputs":1,"noerr":0,"x":2132.666748046875,"y":2294.4285049438476,"wires":[["a2c7426d.32db1","54e429cd.f07cd8"]]},{"id":"e341d11f.f9a58","type":"join","z":"b1c7abcb.eb6ad8","name":"","mode":"custom","build":"array","property":"payload","propertyType":"msg","key":"topic","joiner":"\\n","joinerType":"str","accumulate":false,"timeout":"","count":"2","reduceRight":false,"reduceExp":"","reduceInit":"","reduceInitType":"","reduceFixup":"","x":2132.666748046875,"y":2374.4285049438476,"wires":[["a2e90d50.352ae"]]},{"id":"54836205.6e7c0c","type":"function","z":"b1c7abcb.eb6ad8","name":"dec_all","func":"var tmp = Number(msg.payload.tmp);\nvar hum = Number(msg.payload.hum);\n\nmsg.payload.tmp = tmp - 1;\nmsg.payload.hum = hum - 5;\nreturn msg;","outputs":1,"noerr":0,"x":1942.666748046875,"y":2374.4285049438476,"wires":[["e341d11f.f9a58"]]},{"id":"a6c152b0.ffa6c","type":"function","z":"b1c7abcb.eb6ad8","name":"dec_tmp","func":"var tmp = Number(msg.payload.tmp);\nvar hum = Number(msg.payload.hum);\n\nmsg.payload.tmp = tmp -1;\nmsg.payload.hum = hum + 5;\nreturn msg;","outputs":1,"noerr":0,"x":1942.666748046875,"y":2414.4285049438476,"wires":[["e341d11f.f9a58"]]},{"id":"527841fd.6d29b","type":"function","z":"b1c7abcb.eb6ad8","name":"dec_hum","func":"var tmp = Number(msg.payload.tmp);\nvar hum = Number(msg.payload.hum);\n\nvar randomUp = Math.floor(Math.random() * 3);\n\nmsg.payload.tmp = tmp + randomUp;\nmsg.payload.hum = hum - 5;\nreturn msg;","outputs":1,"noerr":0,"x":1942.666748046875,"y":2454.4285049438476,"wires":[["e341d11f.f9a58"]]},{"id":"ef58f3f1.cca85","type":"function","z":"b1c7abcb.eb6ad8","name":"inc_all","func":"var tmp = Number(msg.payload.tmp);\nvar hum = Number(msg.payload.hum);\n\nvar randomUp = Math.floor(Math.random() * 4);\n\nmsg.payload.tmp = tmp + randomUp;\nmsg.payload.hum = hum + 5;\nreturn msg;","outputs":1,"noerr":0,"x":1932.666748046875,"y":2494.4285049438476,"wires":[["e341d11f.f9a58"]]},{"id":"a2c7426d.32db1","type":"function","z":"b1c7abcb.eb6ad8","name":"tcp_command","func":"var counter = msg.payload.counter;\nmsg.payload = \"FRIGO SETSIM \" + msg.payload.waypoints[counter].latitude + \" \" + msg.payload.waypoints[counter].longitude + \" \" + msg.payload.tmp + \" \" + msg.payload.hum +\" \\n\";\nreturn msg;","outputs":1,"noerr":0,"x":2322.666748046875,"y":2274.4285049438476,"wires":[["bbb671be.01f67"]]},{"id":"bbb671be.01f67","type":"tcp request","z":"b1c7abcb.eb6ad8","server":"localhost","port":"9092","out":"char","splitc":"\\n","name":"FRIGO SET","x":2512.666748046875,"y":2294.4285049438476,"wires":[["89670502.3a1cf8"]]},{"id":"89670502.3a1cf8","type":"subflow:fb60b192.47c6a","z":"b1c7abcb.eb6ad8","name":"","x":2722.666748046875,"y":2294.4285049438476,"wires":[[],[]]},{"id":"61fab74.3168748","type":"mqtt in","z":"b1c7abcb.eb6ad8","name":"eshipping/vehicle/003/start","topic":"eshipping/vehicle/003/start","qos":"2","broker":"1cf99f41.c3c031","x":141,"y":2649.428565979004,"wires":[["bb038984.e38aa8"]]},{"id":"ff543023.c9089","type":"function","z":"b1c7abcb.eb6ad8","name":"check_msg","func":"var obj1 = msg.payload[0];\nvar obj2 = msg.payload[1];\n\nmsg.payload = Object.assign(obj1,obj2);\n\nvar array = msg.payload.waypoints;\n\nif(Array.isArray(array)){\n    msg.payload.loopNumber = array.length;\n    msg.payload.counter = 0;\n}else{\n    msg.payload = {};\n    msg.payload.ProductType = \"ERROR\";\n}\n\n\nreturn msg;","outputs":1,"noerr":0,"x":591,"y":2649.4284439086914,"wires":[["40db3507.154f5c"]]},{"id":"40db3507.154f5c","type":"switch","z":"b1c7abcb.eb6ad8","name":"check_error","property":"payload.productType","propertyType":"msg","rules":[{"t":"eq","v":"ERROR","vt":"str"},{"t":"eq","v":"STANDARD","vt":"str"},{"t":"eq","v":"FRAGILE","vt":"str"},{"t":"eq","v":"FRIGO","vt":"str"}],"checkall":"true","repair":false,"outputs":4,"x":691,"y":2909.4284439086914,"wires":[["87bbb03b.68ad5"],["a7956539.0ab5b8"],["2893fed7.4c21b2"],["eed44765.73a658"]]},{"id":"30219bfb.8dc434","type":"switch","z":"b1c7abcb.eb6ad8","name":"counter_check","property":"payload.counter","propertyType":"msg","rules":[{"t":"lt","v":"payload.loopNumber","vt":"msg"},{"t":"else"}],"checkall":"true","repair":false,"outputs":2,"x":1141,"y":2749.4284439086914,"wires":[["6c287071.241ec","6b0befa.157641"],["992ab94f.4eb728"]]},{"id":"6c287071.241ec","type":"function","z":"b1c7abcb.eb6ad8","name":"increment_counter","func":"var counter = msg.payload.counter;\ncounter = counter +1;\nmsg.payload.counter = counter;\n\nreturn msg;","outputs":1,"noerr":0,"x":1071,"y":2669.4284439086914,"wires":[["39d4ae0c.5237b2"]]},{"id":"39d4ae0c.5237b2","type":"delay","z":"b1c7abcb.eb6ad8","name":"","pauseType":"delay","timeout":"4","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":1241,"y":2669.4284439086914,"wires":[["30219bfb.8dc434"]]},{"id":"6b0befa.157641","type":"function","z":"b1c7abcb.eb6ad8","name":"set_msg","func":"var counter = msg.payload.counter;\nvar position = msg.payload.waypoints[counter];\nvar latitude = position.latitude;\nvar longitude = position.longitude;\nvar message = \"STANDARD SET \" + latitude + \" \" + longitude + \" \\n\";\n\nmsg.payload = {};\nmsg.payload = message;\n\nreturn msg;","outputs":1,"noerr":0,"x":1381,"y":2729.4284439086914,"wires":[["d5caae6.ad6b45"]]},{"id":"992ab94f.4eb728","type":"function","z":"b1c7abcb.eb6ad8","name":"set_msg","func":"var message = \"END \" + msg.payload.productID + \" \\n\";\nmsg.payload = {};\nmsg.payload = message;\n\nreturn msg;","outputs":1,"noerr":0,"x":1381,"y":2769.4284439086914,"wires":[["fe12978.d7acb68"]]},{"id":"fe12978.d7acb68","type":"tcp request","z":"b1c7abcb.eb6ad8","server":"localhost","port":"9093","out":"char","splitc":"\\n","name":"END","x":1551,"y":2769.4284439086914,"wires":[["f859fe63.7d39a"]]},{"id":"d5caae6.ad6b45","type":"tcp request","z":"b1c7abcb.eb6ad8","server":"localhost","port":"9093","out":"char","splitc":"\\n","name":"STANDARD SET","x":1551,"y":2729.4284439086914,"wires":[["e95ecb9c.7f81c8"]]},{"id":"a7956539.0ab5b8","type":"delay","z":"b1c7abcb.eb6ad8","name":"Wait Vehicle","pauseType":"delay","timeout":"2","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":911,"y":2749.4284439086914,"wires":[["30219bfb.8dc434"]]},{"id":"697cd80.d322728","type":"delay","z":"b1c7abcb.eb6ad8","name":"Wait Vehicle","pauseType":"delay","timeout":"2","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":1131,"y":2909.4284439086914,"wires":[["7dd4e668.c94698"]]},{"id":"7dd4e668.c94698","type":"switch","z":"b1c7abcb.eb6ad8","name":"counter_check","property":"payload.counter","propertyType":"msg","rules":[{"t":"lt","v":"payload.loopNumber","vt":"msg"},{"t":"else"}],"checkall":"true","repair":false,"outputs":2,"x":1341,"y":2909.4284439086914,"wires":[["2abbb001.f8d46","6e11df83.9666a"],["baea7249.e1d4c"]]},{"id":"baea7249.e1d4c","type":"function","z":"b1c7abcb.eb6ad8","name":"set_msg","func":"var message = \"END \" + msg.payload.productID + \" \\n\";\nmsg.payload = {};\nmsg.payload = message;\n\nreturn msg;","outputs":1,"noerr":0,"x":1561,"y":2929.4284439086914,"wires":[["6988af60.065ae"]]},{"id":"6e11df83.9666a","type":"function","z":"b1c7abcb.eb6ad8","name":"set_msg","func":"var counter = msg.payload.counter;\nvar position = msg.payload.waypoints[counter];\nvar latitude = position.latitude;\nvar longitude = position.longitude;\nvar message = \"FRAGILE SET \" + latitude + \" \" + longitude + \" \"+msg.payload.vibrationDetected +\" \\n\";\n\nmsg.payload = {};\nmsg.payload = message;\n\nreturn msg;","outputs":1,"noerr":0,"x":1561,"y":2889.4284439086914,"wires":[["10bbb45.992554c"]]},{"id":"54127d1f.6787c4","type":"delay","z":"b1c7abcb.eb6ad8","name":"","pauseType":"delay","timeout":"4","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":1441,"y":2829.4284439086914,"wires":[["7dd4e668.c94698"]]},{"id":"2abbb001.f8d46","type":"function","z":"b1c7abcb.eb6ad8","name":"increment_counter","func":"var counter = msg.payload.counter;\ncounter = counter +1;\nmsg.payload.counter = counter;\nmsg.payload.vibrationDetected = Math.floor((Math.random() * 5000) + 1);\n\nreturn msg;","outputs":1,"noerr":0,"x":1251,"y":2829.4284439086914,"wires":[["54127d1f.6787c4"]]},{"id":"2893fed7.4c21b2","type":"function","z":"b1c7abcb.eb6ad8","name":"init_vibration","func":"msg.payload.vibrationDetected = 0;\nreturn msg;","outputs":1,"noerr":0,"x":891,"y":2909.4284439086914,"wires":[["697cd80.d322728"]]},{"id":"10bbb45.992554c","type":"tcp request","z":"b1c7abcb.eb6ad8","server":"localhost","port":"9093","out":"char","splitc":"\\n","name":"FRAGILE SET","x":1721,"y":2889.4284439086914,"wires":[["43ec9852.8bf058"]]},{"id":"6988af60.065ae","type":"tcp request","z":"b1c7abcb.eb6ad8","server":"localhost","port":"9093","out":"char","splitc":"\\n","name":"END","x":1711,"y":2929.4284439086914,"wires":[["170cd061.52c45"]]},{"id":"eed44765.73a658","type":"delay","z":"b1c7abcb.eb6ad8","name":"Wait Vehicle","pauseType":"delay","timeout":"2","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":891,"y":3149.4284439086914,"wires":[["f86c5043.1960f"]]},{"id":"f86c5043.1960f","type":"switch","z":"b1c7abcb.eb6ad8","name":"counter_check","property":"payload.counter","propertyType":"msg","rules":[{"t":"lt","v":"payload.loopNumber","vt":"msg"},{"t":"else"}],"checkall":"true","repair":false,"outputs":2,"x":1101,"y":3149.4284439086914,"wires":[["57f07cc5.3bed04","7c6641ee.64115"],["e60ac8b1.b51e88"]]},{"id":"57f07cc5.3bed04","type":"function","z":"b1c7abcb.eb6ad8","name":"store_info","func":"\nreturn msg;","outputs":1,"noerr":0,"x":1441,"y":3069.4284439086914,"wires":[["b8b18bf5.eaa898"]]},{"id":"7c6641ee.64115","type":"function","z":"b1c7abcb.eb6ad8","name":"get_sim","func":"msg.payload = {};\nmsg.payload = \"FRIGO GETSIM \\n\";\nreturn msg;","outputs":1,"noerr":0,"x":1301,"y":3149.4284439086914,"wires":[["c9a47f2c.e132d"]]},{"id":"c9a47f2c.e132d","type":"tcp request","z":"b1c7abcb.eb6ad8","server":"localhost","port":"9093","out":"char","splitc":"\\n","name":"FRIGO GET","x":1451,"y":3149.4284439086914,"wires":[["9fb1d7d1.efa358"]]},{"id":"45c09d95.a6cee4","type":"function","z":"b1c7abcb.eb6ad8","name":"Check","func":"var info = msg.payload.message.split(\"_\"); //frigo_dehum_temp_hum\n\nmsg.payload = {};\n\nvar switchWho;\n\nif(info[0] == \"true\" && info[1] == \"true\"){\n    \n    switchWho = 1;\n    \n}else if(info[0] == \"true\" && info[1] == \"false\"){\n    \n    switchWho = 2;\n    \n}else if(info[0] == \"false\" && info[1] == \"true\"){\n    \n    switchWho = 3;\n    \n}else if(info[0] == \"false\" && info[1] == \"false\"){\n    \n    switchWho = 4;\n    \n}\n\nmsg.payload.tmp = info[2];\nmsg.payload.hum = info[3];\nmsg.payload.switchWho = switchWho;\n\nreturn msg;","outputs":1,"noerr":0,"x":1831,"y":3209.4284439086914,"wires":[["e2234d68.7fcc"]]},{"id":"e2234d68.7fcc","type":"switch","z":"b1c7abcb.eb6ad8","name":"","property":"payload.switchWho","propertyType":"msg","rules":[{"t":"eq","v":"1","vt":"num"},{"t":"eq","v":"2","vt":"num"},{"t":"eq","v":"3","vt":"num"},{"t":"eq","v":"4","vt":"num"}],"checkall":"true","repair":false,"outputs":4,"x":1771,"y":3309.4284439086914,"wires":[["5a8827e4.077648"],["9a8f8616.b6b188"],["ccdb442.b2e45b8"],["6cc0638e.c0711c"]]},{"id":"d6ceef79.4a549","type":"delay","z":"b1c7abcb.eb6ad8","name":"","pauseType":"delay","timeout":"4","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":1281,"y":2989.4284439086914,"wires":[["2632e8c5.1207a8"]]},{"id":"2632e8c5.1207a8","type":"function","z":"b1c7abcb.eb6ad8","name":"clear_payload","func":"var waypoints = msg.payload.waypoints;\nvar loopNumber = msg.payload.loopNumber;\nvar counter = msg.payload.counter;\nvar productID = msg.payload.productID;\n\nmsg.payload = {};\nmsg.payload.waypoints = waypoints;\nmsg.payload.loopNumber = loopNumber;\nmsg.payload.counter = counter+1;\nmsg.payload.productID = productID;\nreturn msg;","outputs":1,"noerr":0,"x":1441,"y":2989.4284439086914,"wires":[["f86c5043.1960f"]]},{"id":"e60ac8b1.b51e88","type":"function","z":"b1c7abcb.eb6ad8","name":"set_msg","func":"var message = \"END \" + msg.payload.productID + \" \\n\";\nmsg.payload = {};\nmsg.payload = message;\n\nreturn msg;","outputs":1,"noerr":0,"x":1201,"y":3249.4284439086914,"wires":[["1ac1ee25.092c02"]]},{"id":"1ac1ee25.092c02","type":"tcp request","z":"b1c7abcb.eb6ad8","server":"localhost","port":"9093","out":"char","splitc":"\\n","name":"END","x":1331,"y":3249.4284439086914,"wires":[["757788f7.b9f5b8"]]},{"id":"9fb1d7d1.efa358","type":"subflow:fb60b192.47c6a","z":"b1c7abcb.eb6ad8","name":"","x":1621,"y":3189.4284439086914,"wires":[["45c09d95.a6cee4"],[]]},{"id":"757788f7.b9f5b8","type":"subflow:fb60b192.47c6a","z":"b1c7abcb.eb6ad8","name":"","x":1541,"y":3269.4284439086914,"wires":[[],[]]},{"id":"e95ecb9c.7f81c8","type":"subflow:fb60b192.47c6a","z":"b1c7abcb.eb6ad8","name":"","x":1761,"y":2729.4284439086914,"wires":[[],[]]},{"id":"f859fe63.7d39a","type":"subflow:fb60b192.47c6a","z":"b1c7abcb.eb6ad8","name":"","x":1761,"y":2769.4284439086914,"wires":[[],[]]},{"id":"43ec9852.8bf058","type":"subflow:fb60b192.47c6a","z":"b1c7abcb.eb6ad8","name":"","x":1921,"y":2889.4284439086914,"wires":[[],[]]},{"id":"170cd061.52c45","type":"subflow:fb60b192.47c6a","z":"b1c7abcb.eb6ad8","name":"","x":1921,"y":2929.4284439086914,"wires":[[],[]]},{"id":"fd7f89c0.733d88","type":"function","z":"b1c7abcb.eb6ad8","name":"merge_join","func":"var obj1 = msg.payload[0];\nvar obj2 = msg.payload[1];\n\nmsg.payload = Object.assign(obj1,obj2);\nreturn msg;","outputs":1,"noerr":0,"x":2151,"y":3169.4284439086914,"wires":[["3c723562.eddafa","d6ceef79.4a549"]]},{"id":"b8b18bf5.eaa898","type":"join","z":"b1c7abcb.eb6ad8","name":"","mode":"custom","build":"array","property":"payload","propertyType":"msg","key":"topic","joiner":"\\n","joinerType":"str","accumulate":false,"timeout":"","count":"2","reduceRight":false,"reduceExp":"","reduceInit":"","reduceInitType":"","reduceFixup":"","x":2151,"y":3249.4284439086914,"wires":[["fd7f89c0.733d88"]]},{"id":"5a8827e4.077648","type":"function","z":"b1c7abcb.eb6ad8","name":"dec_all","func":"var tmp = Number(msg.payload.tmp);\nvar hum = Number(msg.payload.hum);\n\nmsg.payload.tmp = tmp - 1;\nmsg.payload.hum = hum - 5;\nreturn msg;","outputs":1,"noerr":0,"x":1961,"y":3249.4284439086914,"wires":[["b8b18bf5.eaa898"]]},{"id":"9a8f8616.b6b188","type":"function","z":"b1c7abcb.eb6ad8","name":"dec_tmp","func":"var tmp = Number(msg.payload.tmp);\nvar hum = Number(msg.payload.hum);\n\nmsg.payload.tmp = tmp -1;\nmsg.payload.hum = hum + 5;\nreturn msg;","outputs":1,"noerr":0,"x":1961,"y":3289.4284439086914,"wires":[["b8b18bf5.eaa898"]]},{"id":"ccdb442.b2e45b8","type":"function","z":"b1c7abcb.eb6ad8","name":"dec_hum","func":"var tmp = Number(msg.payload.tmp);\nvar hum = Number(msg.payload.hum);\n\nvar randomUp = Math.floor(Math.random() * 3);\n\nmsg.payload.tmp = tmp + randomUp;\nmsg.payload.hum = hum - 5;\nreturn msg;","outputs":1,"noerr":0,"x":1961,"y":3329.4284439086914,"wires":[["b8b18bf5.eaa898"]]},{"id":"6cc0638e.c0711c","type":"function","z":"b1c7abcb.eb6ad8","name":"inc_all","func":"var tmp = Number(msg.payload.tmp);\nvar hum = Number(msg.payload.hum);\n\nvar randomUp = Math.floor(Math.random() * 4);\n\nmsg.payload.tmp = tmp + randomUp;\nmsg.payload.hum = hum + 5;\nreturn msg;","outputs":1,"noerr":0,"x":1951,"y":3369.4284439086914,"wires":[["b8b18bf5.eaa898"]]},{"id":"3c723562.eddafa","type":"function","z":"b1c7abcb.eb6ad8","name":"tcp_command","func":"var counter = msg.payload.counter;\nmsg.payload = \"FRIGO SETSIM \" + msg.payload.waypoints[counter].latitude + \" \" + msg.payload.waypoints[counter].longitude + \" \" + msg.payload.tmp + \" \" + msg.payload.hum +\" \\n\";\nreturn msg;","outputs":1,"noerr":0,"x":2341,"y":3149.4284439086914,"wires":[["857a3ef9.7ec29"]]},{"id":"857a3ef9.7ec29","type":"tcp request","z":"b1c7abcb.eb6ad8","server":"localhost","port":"9093","out":"char","splitc":"\\n","name":"FRIGO SET","x":2531,"y":3169.4284439086914,"wires":[["9910641c.542c68"]]},{"id":"9910641c.542c68","type":"subflow:fb60b192.47c6a","z":"b1c7abcb.eb6ad8","name":"","x":2741,"y":3169.4284439086914,"wires":[[],[]]},{"id":"913e6923.63e928","type":"mqtt in","z":"b1c7abcb.eb6ad8","name":"eshipping/vehicle/004/start","topic":"eshipping/vehicle/004/start","qos":"2","broker":"1cf99f41.c3c031","x":141,"y":3534.428565979004,"wires":[["e31a5f51.8d93b"]]},{"id":"57ddbc0.8b53b44","type":"function","z":"b1c7abcb.eb6ad8","name":"check_msg","func":"var obj1 = msg.payload[0];\nvar obj2 = msg.payload[1];\n\nmsg.payload = Object.assign(obj1,obj2);\n\nvar array = msg.payload.waypoints;\n\nif(Array.isArray(array)){\n    msg.payload.loopNumber = array.length;\n    msg.payload.counter = 0;\n}else{\n    msg.payload = {};\n    msg.payload.ProductType = \"ERROR\";\n}\n\n\nreturn msg;","outputs":1,"noerr":0,"x":594.3331298828125,"y":3531.095069885254,"wires":[["7c080f8.2ef32f"]]},{"id":"7c080f8.2ef32f","type":"switch","z":"b1c7abcb.eb6ad8","name":"check_error","property":"payload.productType","propertyType":"msg","rules":[{"t":"eq","v":"ERROR","vt":"str"},{"t":"eq","v":"STANDARD","vt":"str"},{"t":"eq","v":"FRAGILE","vt":"str"},{"t":"eq","v":"FRIGO","vt":"str"}],"checkall":"true","repair":false,"outputs":4,"x":694.3331298828125,"y":3791.095069885254,"wires":[["872b1e92.ed45f"],["dbcd8f6e.28a45"],["b0085b88.11f7e8"],["d9fc4876.e25f48"]]},{"id":"5ff737d5.706388","type":"switch","z":"b1c7abcb.eb6ad8","name":"counter_check","property":"payload.counter","propertyType":"msg","rules":[{"t":"lt","v":"payload.loopNumber","vt":"msg"},{"t":"else"}],"checkall":"true","repair":false,"outputs":2,"x":1144.3331298828125,"y":3631.095069885254,"wires":[["d3d4bf6b.75734","e5aa507a.dfa68"],["ef788a48.cca4c8"]]},{"id":"d3d4bf6b.75734","type":"function","z":"b1c7abcb.eb6ad8","name":"increment_counter","func":"var counter = msg.payload.counter;\ncounter = counter +1;\nmsg.payload.counter = counter;\n\nreturn msg;","outputs":1,"noerr":0,"x":1074.3331298828125,"y":3551.095069885254,"wires":[["67be269f.e4bcf8"]]},{"id":"67be269f.e4bcf8","type":"delay","z":"b1c7abcb.eb6ad8","name":"","pauseType":"delay","timeout":"4","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":1244.3331298828125,"y":3551.095069885254,"wires":[["5ff737d5.706388"]]},{"id":"e5aa507a.dfa68","type":"function","z":"b1c7abcb.eb6ad8","name":"set_msg","func":"var counter = msg.payload.counter;\nvar position = msg.payload.waypoints[counter];\nvar latitude = position.latitude;\nvar longitude = position.longitude;\nvar message = \"STANDARD SET \" + latitude + \" \" + longitude + \" \\n\";\n\nmsg.payload = {};\nmsg.payload = message;\n\nreturn msg;","outputs":1,"noerr":0,"x":1384.3331298828125,"y":3611.095069885254,"wires":[["bf0df923.e07e98"]]},{"id":"ef788a48.cca4c8","type":"function","z":"b1c7abcb.eb6ad8","name":"set_msg","func":"var message = \"END \" + msg.payload.productID + \" \\n\";\nmsg.payload = {};\nmsg.payload = message;\n\nreturn msg;","outputs":1,"noerr":0,"x":1384.3331298828125,"y":3651.095069885254,"wires":[["cd945632.1b6d58"]]},{"id":"cd945632.1b6d58","type":"tcp request","z":"b1c7abcb.eb6ad8","server":"localhost","port":"9094","out":"char","splitc":"\\n","name":"END","x":1554.3331298828125,"y":3651.095069885254,"wires":[["11c7e3c7.19bb4c"]]},{"id":"bf0df923.e07e98","type":"tcp request","z":"b1c7abcb.eb6ad8","server":"localhost","port":"9094","out":"char","splitc":"\\n","name":"STANDARD SET","x":1554.3331298828125,"y":3611.095069885254,"wires":[["d0cb740d.1b7a38"]]},{"id":"dbcd8f6e.28a45","type":"delay","z":"b1c7abcb.eb6ad8","name":"Wait Vehicle","pauseType":"delay","timeout":"2","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":914.3331298828125,"y":3631.095069885254,"wires":[["5ff737d5.706388"]]},{"id":"cc3b173a.ad6c28","type":"delay","z":"b1c7abcb.eb6ad8","name":"Wait Vehicle","pauseType":"delay","timeout":"2","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":1134.3331298828125,"y":3791.095069885254,"wires":[["b4897169.d22e2"]]},{"id":"b4897169.d22e2","type":"switch","z":"b1c7abcb.eb6ad8","name":"counter_check","property":"payload.counter","propertyType":"msg","rules":[{"t":"lt","v":"payload.loopNumber","vt":"msg"},{"t":"else"}],"checkall":"true","repair":false,"outputs":2,"x":1344.3331298828125,"y":3791.095069885254,"wires":[["55bda83e.d895b8","a9071b50.1817d8"],["67f407e.1aba7f8"]]},{"id":"67f407e.1aba7f8","type":"function","z":"b1c7abcb.eb6ad8","name":"set_msg","func":"var message = \"END \" + msg.payload.productID + \" \\n\";\nmsg.payload = {};\nmsg.payload = message;\n\nreturn msg;","outputs":1,"noerr":0,"x":1564.3331298828125,"y":3811.095069885254,"wires":[["439ef519.b6122c"]]},{"id":"a9071b50.1817d8","type":"function","z":"b1c7abcb.eb6ad8","name":"set_msg","func":"var counter = msg.payload.counter;\nvar position = msg.payload.waypoints[counter];\nvar latitude = position.latitude;\nvar longitude = position.longitude;\nvar message = \"FRAGILE SET \" + latitude + \" \" + longitude + \" \"+msg.payload.vibrationDetected +\" \\n\";\n\nmsg.payload = {};\nmsg.payload = message;\n\nreturn msg;","outputs":1,"noerr":0,"x":1564.3331298828125,"y":3771.095069885254,"wires":[["3b25312a.ef1e1e"]]},{"id":"e528ed80.61b9e","type":"delay","z":"b1c7abcb.eb6ad8","name":"","pauseType":"delay","timeout":"4","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":1444.3331298828125,"y":3711.095069885254,"wires":[["b4897169.d22e2"]]},{"id":"55bda83e.d895b8","type":"function","z":"b1c7abcb.eb6ad8","name":"increment_counter","func":"var counter = msg.payload.counter;\ncounter = counter +1;\nmsg.payload.counter = counter;\nmsg.payload.vibrationDetected = Math.floor((Math.random() * 5000) + 1);\n\nreturn msg;","outputs":1,"noerr":0,"x":1254.3331298828125,"y":3711.095069885254,"wires":[["e528ed80.61b9e"]]},{"id":"b0085b88.11f7e8","type":"function","z":"b1c7abcb.eb6ad8","name":"init_vibration","func":"msg.payload.vibrationDetected = 0;\nreturn msg;","outputs":1,"noerr":0,"x":894.3331298828125,"y":3791.095069885254,"wires":[["cc3b173a.ad6c28"]]},{"id":"3b25312a.ef1e1e","type":"tcp request","z":"b1c7abcb.eb6ad8","server":"localhost","port":"9094","out":"char","splitc":"\\n","name":"FRAGILE SET","x":1724.3331298828125,"y":3771.095069885254,"wires":[["5a6f44b9.2e440c"]]},{"id":"439ef519.b6122c","type":"tcp request","z":"b1c7abcb.eb6ad8","server":"localhost","port":"9094","out":"char","splitc":"\\n","name":"END","x":1714.3331298828125,"y":3811.095069885254,"wires":[["698d052d.8dc40c"]]},{"id":"d9fc4876.e25f48","type":"delay","z":"b1c7abcb.eb6ad8","name":"Wait Vehicle","pauseType":"delay","timeout":"2","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":894.3331298828125,"y":4031.095069885254,"wires":[["4421269a.0e4378"]]},{"id":"4421269a.0e4378","type":"switch","z":"b1c7abcb.eb6ad8","name":"counter_check","property":"payload.counter","propertyType":"msg","rules":[{"t":"lt","v":"payload.loopNumber","vt":"msg"},{"t":"else"}],"checkall":"true","repair":false,"outputs":2,"x":1104.3331298828125,"y":4031.095069885254,"wires":[["a576cee1.bd6f5","b092b8be.a72fb8"],["f64c1f53.0f72c"]]},{"id":"a576cee1.bd6f5","type":"function","z":"b1c7abcb.eb6ad8","name":"store_info","func":"\nreturn msg;","outputs":1,"noerr":0,"x":1444.3331298828125,"y":3951.095069885254,"wires":[["9840cb46.e573e8"]]},{"id":"b092b8be.a72fb8","type":"function","z":"b1c7abcb.eb6ad8","name":"get_sim","func":"msg.payload = {};\nmsg.payload = \"FRIGO GETSIM \\n\";\nreturn msg;","outputs":1,"noerr":0,"x":1304.3331298828125,"y":4031.095069885254,"wires":[["7d036e02.ef674"]]},{"id":"7d036e02.ef674","type":"tcp request","z":"b1c7abcb.eb6ad8","server":"localhost","port":"9094","out":"char","splitc":"\\n","name":"FRIGO GET","x":1454.3331298828125,"y":4031.095069885254,"wires":[["584c39c3.d7b9d8"]]},{"id":"272b6475.81930c","type":"function","z":"b1c7abcb.eb6ad8","name":"Check","func":"var info = msg.payload.message.split(\"_\"); //frigo_dehum_temp_hum\n\nmsg.payload = {};\n\nvar switchWho;\n\nif(info[0] == \"true\" && info[1] == \"true\"){\n    \n    switchWho = 1;\n    \n}else if(info[0] == \"true\" && info[1] == \"false\"){\n    \n    switchWho = 2;\n    \n}else if(info[0] == \"false\" && info[1] == \"true\"){\n    \n    switchWho = 3;\n    \n}else if(info[0] == \"false\" && info[1] == \"false\"){\n    \n    switchWho = 4;\n    \n}\n\nmsg.payload.tmp = info[2];\nmsg.payload.hum = info[3];\nmsg.payload.switchWho = switchWho;\n\nreturn msg;","outputs":1,"noerr":0,"x":1834.3331298828125,"y":4091.095069885254,"wires":[["b874186c.4e4b68"]]},{"id":"b874186c.4e4b68","type":"switch","z":"b1c7abcb.eb6ad8","name":"","property":"payload.switchWho","propertyType":"msg","rules":[{"t":"eq","v":"1","vt":"num"},{"t":"eq","v":"2","vt":"num"},{"t":"eq","v":"3","vt":"num"},{"t":"eq","v":"4","vt":"num"}],"checkall":"true","repair":false,"outputs":4,"x":1774.3331298828125,"y":4191.095069885254,"wires":[["87dc0ab3.c8c618"],["5c016993.287f38"],["b134420c.5e5e1"],["e53fe945.5bdc68"]]},{"id":"d5eaf6b2.085018","type":"delay","z":"b1c7abcb.eb6ad8","name":"","pauseType":"delay","timeout":"4","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":1284.3331298828125,"y":3871.095069885254,"wires":[["5ff2fc20.6fe384"]]},{"id":"5ff2fc20.6fe384","type":"function","z":"b1c7abcb.eb6ad8","name":"clear_payload","func":"var waypoints = msg.payload.waypoints;\nvar loopNumber = msg.payload.loopNumber;\nvar counter = msg.payload.counter;\nvar productID = msg.payload.productID;\n\nmsg.payload = {};\nmsg.payload.waypoints = waypoints;\nmsg.payload.loopNumber = loopNumber;\nmsg.payload.counter = counter+1;\nmsg.payload.productID = productID;\n\nreturn msg;","outputs":1,"noerr":0,"x":1444.3331298828125,"y":3871.095069885254,"wires":[["4421269a.0e4378"]]},{"id":"f64c1f53.0f72c","type":"function","z":"b1c7abcb.eb6ad8","name":"set_msg","func":"var message = \"END \" + msg.payload.productID + \" \\n\";\nmsg.payload = {};\nmsg.payload = message;\n\nreturn msg;","outputs":1,"noerr":0,"x":1204.3331298828125,"y":4131.095069885254,"wires":[["aa6d9eaf.b1417"]]},{"id":"aa6d9eaf.b1417","type":"tcp request","z":"b1c7abcb.eb6ad8","server":"localhost","port":"9094","out":"char","splitc":"\\n","name":"END","x":1334.3331298828125,"y":4131.095069885254,"wires":[["489ae74.25c3b18"]]},{"id":"584c39c3.d7b9d8","type":"subflow:fb60b192.47c6a","z":"b1c7abcb.eb6ad8","name":"","x":1624.3331298828125,"y":4071.095069885254,"wires":[["272b6475.81930c"],[]]},{"id":"489ae74.25c3b18","type":"subflow:fb60b192.47c6a","z":"b1c7abcb.eb6ad8","name":"","x":1544.3331298828125,"y":4151.095069885254,"wires":[[],[]]},{"id":"d0cb740d.1b7a38","type":"subflow:fb60b192.47c6a","z":"b1c7abcb.eb6ad8","name":"","x":1764.3331298828125,"y":3611.095069885254,"wires":[[],[]]},{"id":"11c7e3c7.19bb4c","type":"subflow:fb60b192.47c6a","z":"b1c7abcb.eb6ad8","name":"","x":1764.3331298828125,"y":3651.095069885254,"wires":[[],[]]},{"id":"5a6f44b9.2e440c","type":"subflow:fb60b192.47c6a","z":"b1c7abcb.eb6ad8","name":"","x":1924.3331298828125,"y":3771.095069885254,"wires":[[],[]]},{"id":"698d052d.8dc40c","type":"subflow:fb60b192.47c6a","z":"b1c7abcb.eb6ad8","name":"","x":1924.3331298828125,"y":3811.095069885254,"wires":[[],[]]},{"id":"87829ce6.70db","type":"function","z":"b1c7abcb.eb6ad8","name":"merge_join","func":"var obj1 = msg.payload[0];\nvar obj2 = msg.payload[1];\n\nmsg.payload = Object.assign(obj1,obj2);\nreturn msg;","outputs":1,"noerr":0,"x":2154.3331298828125,"y":4051.095069885254,"wires":[["3b49cc42.9bd794","d5eaf6b2.085018"]]},{"id":"9840cb46.e573e8","type":"join","z":"b1c7abcb.eb6ad8","name":"","mode":"custom","build":"array","property":"payload","propertyType":"msg","key":"topic","joiner":"\\n","joinerType":"str","accumulate":false,"timeout":"","count":"2","reduceRight":false,"reduceExp":"","reduceInit":"","reduceInitType":"","reduceFixup":"","x":2154.3331298828125,"y":4131.095069885254,"wires":[["87829ce6.70db"]]},{"id":"87dc0ab3.c8c618","type":"function","z":"b1c7abcb.eb6ad8","name":"dec_all","func":"var tmp = Number(msg.payload.tmp);\nvar hum = Number(msg.payload.hum);\n\nmsg.payload.tmp = tmp - 1;\nmsg.payload.hum = hum - 5;\nreturn msg;","outputs":1,"noerr":0,"x":1964.3331298828125,"y":4131.095069885254,"wires":[["9840cb46.e573e8"]]},{"id":"5c016993.287f38","type":"function","z":"b1c7abcb.eb6ad8","name":"dec_tmp","func":"var tmp = Number(msg.payload.tmp);\nvar hum = Number(msg.payload.hum);\n\nmsg.payload.tmp = tmp -1;\nmsg.payload.hum = hum + 5;\nreturn msg;","outputs":1,"noerr":0,"x":1964.3331298828125,"y":4171.095069885254,"wires":[["9840cb46.e573e8"]]},{"id":"b134420c.5e5e1","type":"function","z":"b1c7abcb.eb6ad8","name":"dec_hum","func":"var tmp = Number(msg.payload.tmp);\nvar hum = Number(msg.payload.hum);\n\nvar randomUp = Math.floor(Math.random() * 3);\n\nmsg.payload.tmp = tmp + randomUp;\nmsg.payload.hum = hum - 5;\nreturn msg;","outputs":1,"noerr":0,"x":1964.3331298828125,"y":4211.095069885254,"wires":[["9840cb46.e573e8"]]},{"id":"e53fe945.5bdc68","type":"function","z":"b1c7abcb.eb6ad8","name":"inc_all","func":"var tmp = Number(msg.payload.tmp);\nvar hum = Number(msg.payload.hum);\n\nvar randomUp = Math.floor(Math.random() * 4);\n\nmsg.payload.tmp = tmp + randomUp;\nmsg.payload.hum = hum + 5;\nreturn msg;","outputs":1,"noerr":0,"x":1954.3331298828125,"y":4251.095069885254,"wires":[["9840cb46.e573e8"]]},{"id":"3b49cc42.9bd794","type":"function","z":"b1c7abcb.eb6ad8","name":"tcp_command","func":"var counter = msg.payload.counter;\nmsg.payload = \"FRIGO SETSIM \" + msg.payload.waypoints[counter].latitude + \" \" + msg.payload.waypoints[counter].longitude + \" \" + msg.payload.tmp + \" \" + msg.payload.hum +\" \\n\";\nreturn msg;","outputs":1,"noerr":0,"x":2344.3331298828125,"y":4031.095069885254,"wires":[["3470f765.e1b5a8"]]},{"id":"3470f765.e1b5a8","type":"tcp request","z":"b1c7abcb.eb6ad8","server":"localhost","port":"9094","out":"char","splitc":"\\n","name":"FRIGO SET","x":2534.3331298828125,"y":4051.095069885254,"wires":[["971c6cb5.a1fc6"]]},{"id":"971c6cb5.a1fc6","type":"subflow:fb60b192.47c6a","z":"b1c7abcb.eb6ad8","name":"","x":2744.3331298828125,"y":4051.095069885254,"wires":[[],[]]},{"id":"ce1ad739.a707e8","type":"subflow:8c5719d3.6d6278","z":"b1c7abcb.eb6ad8","name":"","x":359,"y":93.57855987548828,"wires":[["d2820f60.10c38"]]},{"id":"dc168388.e1d83","type":"mqtt out","z":"b1c7abcb.eb6ad8","name":"eshipping/warehouse/error","topic":"eshipping/warehouse/error","qos":"2","retain":"","broker":"7e40374f.4607e8","x":868.857177734375,"y":63,"wires":[]},{"id":"a931a362.1cd46","type":"mqtt out","z":"b1c7abcb.eb6ad8","name":"eshipping/warehouse/error","topic":"eshipping/warehouse/error","qos":"2","retain":"","broker":"7e40374f.4607e8","x":878.16650390625,"y":871.7620620727539,"wires":[]},{"id":"872b1e92.ed45f","type":"mqtt out","z":"b1c7abcb.eb6ad8","name":"eshipping/warehouse/error","topic":"eshipping/warehouse/error","qos":"2","retain":"","broker":"7e40374f.4607e8","x":885.9998779296875,"y":3497.761573791504,"wires":[]},{"id":"87bbb03b.68ad5","type":"mqtt out","z":"b1c7abcb.eb6ad8","name":"eshipping/warehouse/error","topic":"eshipping/warehouse/error","qos":"2","retain":"","broker":"7e40374f.4607e8","x":902.666748046875,"y":2617.7619400024414,"wires":[]},{"id":"41bfe039.7e3eb","type":"mqtt out","z":"b1c7abcb.eb6ad8","name":"eshipping/warehouse/error","topic":"eshipping/warehouse/error","qos":"2","retain":"","broker":"7e40374f.4607e8","x":860.666748046875,"y":1730.428565979004,"wires":[]},{"id":"5abfb4ce.82039c","type":"subflow:8c5719d3.6d6278","z":"b1c7abcb.eb6ad8","name":"","x":359.33331298828125,"y":911.5952529907226,"wires":[["21f2afba.b6b48"]]},{"id":"b3297e45.88a72","type":"subflow:8c5719d3.6d6278","z":"b1c7abcb.eb6ad8","name":"","x":369.33331298828125,"y":1774.928565979004,"wires":[["3e19cec0.59f592"]]},{"id":"bb038984.e38aa8","type":"subflow:8c5719d3.6d6278","z":"b1c7abcb.eb6ad8","name":"","x":376,"y":2648.262062072754,"wires":[["ff543023.c9089"]]},{"id":"e31a5f51.8d93b","type":"subflow:8c5719d3.6d6278","z":"b1c7abcb.eb6ad8","name":"","x":379.333251953125,"y":3531.5951919555664,"wires":[["57ddbc0.8b53b44"]]},{"id":"c352e587.026df8","type":"mqtt out","z":"785d99ff.c78688","name":"eshipping/vehicles/error","topic":"eshipping/vehicles/error","qos":"2","retain":"","broker":"552f4d84.0e9b84","x":790,"y":300,"wires":[]},{"id":"79e90e8c.37a31","type":"function","z":"785d99ff.c78688","name":"Manage Error","func":"msg.payload = msg.payload.message; \nreturn msg;","outputs":1,"noerr":0,"x":520,"y":300,"wires":[["c352e587.026df8"]]},{"id":"fc364e0e.a5fed","type":"switch","z":"785d99ff.c78688","name":"","property":"payload.answer","propertyType":"msg","rules":[{"t":"eq","v":"OK","vt":"str"},{"t":"eq","v":"DELIVERED","vt":"str"},{"t":"eq","v":"ERROR","vt":"str"}],"checkall":"true","repair":false,"outputs":3,"x":350,"y":180,"wires":[[],[],["79e90e8c.37a31"]]},{"id":"3c602bc2.951e14","type":"function","z":"785d99ff.c78688","name":"Check","func":"var string = msg.payload.toString(\"utf8\");\nvar splitted = string.split(\" \");\nmsg.payload = {};\nmsg.payload.answer = splitted[0];\nmsg.payload.message = splitted[1];//stringa lat_long\n\nreturn msg;","outputs":1,"noerr":0,"x":200,"y":180,"wires":[["fc364e0e.a5fed"]]},{"id":"386483c9.7d2fbc","type":"function","z":"dcdaf8f4.e91878","name":"read_message","func":"var string = msg.payload;\nvar array = string.split(\"###\");\nvar productInfo = array[1];\nvar arrayProduct = productInfo.split(\"_\");\n\nmsg.payload = {};\nmsg.payload.idVehicle = array[0];\nmsg.payload.productID = arrayProduct[0];\nmsg.payload.productDescription = arrayProduct[1];\nmsg.payload.productDestination = arrayProduct[2];\nmsg.payload.productType = arrayProduct[3];\n\nreturn msg;","outputs":1,"noerr":0,"x":292,"y":180,"wires":[["abe99400.dd8cf8","a3e5026a.5b7a"]]},{"id":"173fd38d.af4d9c","type":"tcp request","z":"dcdaf8f4.e91878","server":"localhost","port":"9090","out":"char","splitc":"\\n","name":"SENSORS","x":646,"y":69,"wires":[["be20104e.d611f"]]},{"id":"be20104e.d611f","type":"subflow:785d99ff.c78688","z":"dcdaf8f4.e91878","x":856,"y":69,"wires":[[],[]]},{"id":"67466919.f8fe18","type":"mqtt in","z":"dcdaf8f4.e91878","name":"eshipping/vehicle/000/start","topic":"eshipping/vehicle/000/start","qos":"2","broker":"737ce9f5.5b77d8","x":142,"y":100,"wires":[["386483c9.7d2fbc"]]},{"id":"abe99400.dd8cf8","type":"function","z":"dcdaf8f4.e91878","name":"set_message","func":"msg.payload = msg.payload.productType + \" SENSORS \" + msg.payload.productID +  \" \\n\"; \nreturn msg;","outputs":1,"noerr":0,"x":466,"y":69,"wires":[["173fd38d.af4d9c"]]},{"id":"d4e047d8.9c6338","type":"comment","z":"dcdaf8f4.e91878","name":"Start vehicle 000 delivery","info":"","x":142,"y":60,"wires":[]},{"id":"29e66d01.121b42","type":"delay","z":"dcdaf8f4.e91878","name":"","pauseType":"delay","timeout":"4","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":392,"y":300,"wires":[["44cc832a.8b7cbc"]]},{"id":"44cc832a.8b7cbc","type":"function","z":"dcdaf8f4.e91878","name":"set_msg","func":"var message = \"STANDARD GET \\n\";\nmsg.payload = {};\nmsg.payload = message;\n\nreturn msg;","outputs":1,"noerr":0,"x":552,"y":300,"wires":[["9bdbec7d.8d59e"]]},{"id":"9bdbec7d.8d59e","type":"tcp request","z":"dcdaf8f4.e91878","server":"localhost","port":"9090","out":"char","splitc":"\\n","name":"STANDARD GET","x":722,"y":300,"wires":[["ccafa669.92b248"]]},{"id":"e65570bc.c40bf","type":"switch","z":"dcdaf8f4.e91878","name":"","property":"payload.answer","propertyType":"msg","rules":[{"t":"eq","v":"DELIVERED","vt":"str"},{"t":"eq","v":"OK","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":702,"y":180,"wires":[["10640256.60a3ee","9f0be9.c75fa418"],["29e66d01.121b42"]]},{"id":"10640256.60a3ee","type":"function","z":"dcdaf8f4.e91878","name":"prepare_message","func":"var message = msg.payload.message.split(\"_\");\nmsg.payload = {};\nmsg.payload = message[0] + \"_\" + message[1];\nreturn msg;","outputs":1,"noerr":0,"x":942,"y":180,"wires":[["e2b7d04e.10b52"]]},{"id":"ccafa669.92b248","type":"subflow:785d99ff.c78688","z":"dcdaf8f4.e91878","name":"","x":932,"y":300,"wires":[["e65570bc.c40bf","7c282967.5d9908","52d4fb01.e17a44"],["c9524702.472378","e65570bc.c40bf"]]},{"id":"a3e5026a.5b7a","type":"switch","z":"dcdaf8f4.e91878","name":"","property":"payload.productType","propertyType":"msg","rules":[{"t":"eq","v":"STANDARD","vt":"str"},{"t":"eq","v":"FRAGILE","vt":"str"},{"t":"eq","v":"FRIGO","vt":"str"}],"checkall":"true","repair":false,"outputs":3,"x":142,"y":440,"wires":[["29e66d01.121b42"],["25a39272.b9c76e"],["47a5cc45.f94504"]]},{"id":"25a39272.b9c76e","type":"delay","z":"dcdaf8f4.e91878","name":"","pauseType":"delay","timeout":"4","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":352,"y":580,"wires":[["d0f62a84.10b398"]]},{"id":"d0f62a84.10b398","type":"function","z":"dcdaf8f4.e91878","name":"set_msg","func":"var message = \"FRAGILE GET \\n\";\nmsg.payload = {};\nmsg.payload = message;\n\nreturn msg;","outputs":1,"noerr":0,"x":492,"y":580,"wires":[["e20b3bf8.1e3918"]]},{"id":"e20b3bf8.1e3918","type":"tcp request","z":"dcdaf8f4.e91878","server":"localhost","port":"9090","out":"char","splitc":"\\n","name":"FRAGILE GET","x":652,"y":580,"wires":[["4f99aecc.ee7dd"]]},{"id":"4f99aecc.ee7dd","type":"subflow:785d99ff.c78688","z":"dcdaf8f4.e91878","name":"","x":852,"y":580,"wires":[["98ed1c80.ee4c3","53819fc3.89773","50442ba9.c238c4"],["7cc1da2c.ac8ec4","98ed1c80.ee4c3"]]},{"id":"7322e043.5ef1f","type":"function","z":"dcdaf8f4.e91878","name":"prepare_message","func":"var message = msg.payload.message.split(\"_\");\nmsg.payload = {};\nmsg.payload = message[0] + \"_\" + message[1];\nreturn msg;","outputs":1,"noerr":0,"x":922,"y":460,"wires":[["5250b771.e10198"]]},{"id":"98ed1c80.ee4c3","type":"switch","z":"dcdaf8f4.e91878","name":"","property":"payload.answer","propertyType":"msg","rules":[{"t":"eq","v":"DELIVERED","vt":"str"},{"t":"eq","v":"OK","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":702,"y":460,"wires":[["7322e043.5ef1f","fe12fc4a.40881"],["25a39272.b9c76e"]]},{"id":"53819fc3.89773","type":"function","z":"dcdaf8f4.e91878","name":"set_dashboard","func":"var data = msg.payload.message.split(\"_\");\nmsg.payload = {};\nvar lat = data[0];\nvar long = data[1];\nvar vibrationDetected = data[2];\nvar alarm;\nif(vibrationDetected >= 4000){\n    alarm = true;\n}else{\n    alarm = false;\n}\n\nmsg.payload = {};\nmsg.payload = \"FRAGILE \" + lat + \"_\" + long + \"_\" + vibrationDetected;\nreturn msg;","outputs":1,"noerr":0,"x":1152,"y":570,"wires":[["a854e21a.daa95"]]},{"id":"7c282967.5d9908","type":"function","z":"dcdaf8f4.e91878","name":"set_tmp_vib_null","func":"var latlong = msg.payload.message.split(\"_\");\nvar lat = latlong[0];\nvar long = latlong[1];\nmsg.payload = {};\n\nmsg.payload = \"STANDARD \" + lat + \"_\" + long;\nreturn msg;","outputs":1,"noerr":0,"x":1192,"y":285,"wires":[["e9fdaf53.bba5c"]]},{"id":"47a5cc45.f94504","type":"delay","z":"dcdaf8f4.e91878","name":"","pauseType":"delay","timeout":"4","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":272,"y":860,"wires":[["85d42d2e.45deb"]]},{"id":"85d42d2e.45deb","type":"function","z":"dcdaf8f4.e91878","name":"get_tmp_hum","func":"msg.payload = \"FRIGO GET \\n\";\nreturn msg;","outputs":1,"noerr":0,"x":452,"y":860,"wires":[["b20b3593.5c7088"]]},{"id":"232012e3.7571ce","type":"subflow:785d99ff.c78688","z":"dcdaf8f4.e91878","name":"","x":872,"y":860,"wires":[["1a7a8eb4.2b50d1","84258058.fe6a8","39d7d361.efad3c"],["1db82448.26f46c","84258058.fe6a8"]]},{"id":"b20b3593.5c7088","type":"tcp request","z":"dcdaf8f4.e91878","server":"localhost","port":"9090","out":"char","splitc":"\\n","name":"FRIGO GETSIM","x":652,"y":860,"wires":[["232012e3.7571ce"]]},{"id":"1a7a8eb4.2b50d1","type":"function","z":"dcdaf8f4.e91878","name":"set_dashboard","func":"var data = msg.payload.message.split(\"_\");\nvar lat = data[0];\nvar long = data[1];\nvar setFrigo = data[2];\nvar setDehum = data[3];\nvar tmp = data[4];\nvar hum =data[5];\n\nif(tmp > 10){\n        setFrigo = true;\n}\nelse if(tmp <= 5){\n        setFrigo = false;\n}\n\nif(hum > 75){\n        setDehum = true;\n}\nelse if(hum <= 55){\n        setDehum = false;\n}\n\nmsg.payload = {};\n\nif(tmp >= 12){\n    msg.payload.alarmTmp = true;\n}\n\nmsg.payload.setFrigo = setFrigo;\nmsg.payload.setDehum = setDehum;\nmsg.payload.temp = tmp;\nmsg.payload.hum = hum;\nmsg.payload.lat = lat;\nmsg.payload.long = long;\n\nreturn msg;","outputs":1,"noerr":0,"x":1212,"y":840,"wires":[["19488303.14501d","f67c3e67.d659c"]]},{"id":"19488303.14501d","type":"function","z":"dcdaf8f4.e91878","name":"set_sim","func":"var setFrigo = msg.payload.setFrigo;\nvar setDehum = msg.payload.setDehum;\nmsg.payload = {};\nmsg.payload = \"FRIGO SET \" + setFrigo + \" \" + setDehum + \" \\n\";\nreturn msg;","outputs":1,"noerr":0,"x":1412,"y":840,"wires":[["2468dbb5.852064"]]},{"id":"2468dbb5.852064","type":"tcp request","z":"dcdaf8f4.e91878","server":"localhost","port":"9090","out":"char","splitc":"\\n","name":"FRIGO SETSIM","x":1572,"y":840,"wires":[["ec65ca16.11c7e8"]]},{"id":"84258058.fe6a8","type":"switch","z":"dcdaf8f4.e91878","name":"","property":"payload.answer","propertyType":"msg","rules":[{"t":"eq","v":"DELIVERED","vt":"str"},{"t":"eq","v":"OK","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":702,"y":740,"wires":[["30a54b9d.954b34","6fa1a73d.59e108"],["47a5cc45.f94504"]]},{"id":"30a54b9d.954b34","type":"function","z":"dcdaf8f4.e91878","name":"prepare_message","func":"var message = msg.payload.message.split(\"_\");\nmsg.payload = {};\nmsg.payload = message[0] + \"_\" + message[1];\nreturn msg;","outputs":1,"noerr":0,"x":942,"y":740,"wires":[["bfc59139.4d8b4"]]},{"id":"f67c3e67.d659c","type":"function","z":"dcdaf8f4.e91878","name":"set_frigo_dashboard","func":"var tmp = msg.payload.temp;\nvar hum = msg.payload.hum;\nvar alarm = msg.payload.alarmTmp;\nvar lat = msg.payload.lat;\nvar long = msg.payload.long;\nmsg.payload = {};\n\nif(alarm){\n    msg.payload =\"FRIGO \" + lat + \"_\" + long + \"_\" + tmp + \"_true_\" + hum; \n}else{\n    msg.payload =\"FRIGO \" + lat + \"_\" + long + \"_\" + tmp + \"_false_\" + hum; \n}\n\nreturn msg;","outputs":1,"noerr":0,"x":1457,"y":885,"wires":[["f1f3d053.21cb6"]]},{"id":"ec65ca16.11c7e8","type":"subflow:785d99ff.c78688","z":"dcdaf8f4.e91878","name":"","x":1772,"y":840,"wires":[[],[]]},{"id":"e2b7d04e.10b52","type":"mqtt out","z":"dcdaf8f4.e91878","name":"eshipping/vehicle/000/end","topic":"eshipping/vehicle/000/end","qos":"2","retain":"","broker":"3434a624.97253a","x":1192,"y":180,"wires":[]},{"id":"f1f3d053.21cb6","type":"mqtt out","z":"dcdaf8f4.e91878","name":"eshipping/warehouse/dashboard/000","topic":"eshipping/warehouse/dashboard/000","qos":"2","retain":"","broker":"3434a624.97253a","x":1732,"y":885,"wires":[]},{"id":"a854e21a.daa95","type":"mqtt out","z":"dcdaf8f4.e91878","name":"eshipping/warehouse/dashboard/000","topic":"eshipping/warehouse/dashboard/000","qos":"2","retain":"","broker":"3434a624.97253a","x":1447,"y":585,"wires":[]},{"id":"e9fdaf53.bba5c","type":"mqtt out","z":"dcdaf8f4.e91878","name":"eshipping/warehouse/dashboard/000","topic":"eshipping/warehouse/dashboard/000","qos":"2","retain":"","broker":"3434a624.97253a","x":1477,"y":285,"wires":[]},{"id":"5250b771.e10198","type":"mqtt out","z":"dcdaf8f4.e91878","name":"eshipping/vehicle/000/end","topic":"eshipping/vehicle/000/end","qos":"2","retain":"","broker":"3434a624.97253a","x":1172,"y":460,"wires":[]},{"id":"bfc59139.4d8b4","type":"mqtt out","z":"dcdaf8f4.e91878","name":"eshipping/vehicle/000/end","topic":"eshipping/vehicle/000/end","qos":"2","retain":"","broker":"3434a624.97253a","x":1192,"y":740,"wires":[]},{"id":"36772a25.c2bca6","type":"function","z":"dcdaf8f4.e91878","name":"read_message","func":"var string = msg.payload;\nvar array = string.split(\"###\");\nvar productInfo = array[1];\nvar arrayProduct = productInfo.split(\"_\");\n\nmsg.payload = {};\nmsg.payload.idVehicle = array[0];\nmsg.payload.productID = arrayProduct[0];\nmsg.payload.productDescription = arrayProduct[1];\nmsg.payload.productDestination = arrayProduct[2];\nmsg.payload.productType = arrayProduct[3];\n\nreturn msg;","outputs":1,"noerr":0,"x":296,"y":1158,"wires":[["192cbc7d.92be34","c009807.09cd08"]]},{"id":"543424b2.22e27c","type":"tcp request","z":"dcdaf8f4.e91878","server":"localhost","port":"9091","out":"char","splitc":"\\n","name":"SENSORS","x":603,"y":1077,"wires":[["38144436.ceb25c"]]},{"id":"38144436.ceb25c","type":"subflow:785d99ff.c78688","z":"dcdaf8f4.e91878","x":813,"y":1077,"wires":[[],[]]},{"id":"7b73573f.81fac8","type":"mqtt in","z":"dcdaf8f4.e91878","name":"eshipping/vehicle/001/start","topic":"eshipping/vehicle/001/start","qos":"2","broker":"737ce9f5.5b77d8","x":146,"y":1078,"wires":[["36772a25.c2bca6"]]},{"id":"192cbc7d.92be34","type":"function","z":"dcdaf8f4.e91878","name":"set_message","func":"msg.payload = msg.payload.productType + \" SENSORS \" + msg.payload.productID +  \" \\n\"; \nreturn msg;","outputs":1,"noerr":0,"x":423,"y":1077,"wires":[["543424b2.22e27c"]]},{"id":"be55d381.ec5d4","type":"comment","z":"dcdaf8f4.e91878","name":"Start vehicle 001 delivery","info":"","x":146,"y":1038,"wires":[]},{"id":"e3fe1c21.ccc03","type":"delay","z":"dcdaf8f4.e91878","name":"","pauseType":"delay","timeout":"4","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":396,"y":1278,"wires":[["64e70b4f.63a644"]]},{"id":"64e70b4f.63a644","type":"function","z":"dcdaf8f4.e91878","name":"set_msg","func":"var message = \"STANDARD GET \\n\";\nmsg.payload = {};\nmsg.payload = message;\n\nreturn msg;","outputs":1,"noerr":0,"x":556,"y":1278,"wires":[["6ce588f2.10a7d8"]]},{"id":"6ce588f2.10a7d8","type":"tcp request","z":"dcdaf8f4.e91878","server":"localhost","port":"9091","out":"char","splitc":"\\n","name":"STANDARD GET","x":726,"y":1278,"wires":[["c766a21d.8a172"]]},{"id":"7c9e4862.97e628","type":"switch","z":"dcdaf8f4.e91878","name":"","property":"payload.answer","propertyType":"msg","rules":[{"t":"eq","v":"DELIVERED","vt":"str"},{"t":"eq","v":"OK","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":706,"y":1158,"wires":[["96df1045.2e2b4","5b8655bd.85300c"],["e3fe1c21.ccc03"]]},{"id":"96df1045.2e2b4","type":"function","z":"dcdaf8f4.e91878","name":"prepare_message","func":"var message = msg.payload.message.split(\"_\");\nmsg.payload = {};\nmsg.payload = message[0] + \"_\" + message[1];\nreturn msg;","outputs":1,"noerr":0,"x":946,"y":1158,"wires":[["fb1c9b5f.d6d5d8"]]},{"id":"c766a21d.8a172","type":"subflow:785d99ff.c78688","z":"dcdaf8f4.e91878","name":"","x":936,"y":1278,"wires":[["7c9e4862.97e628","9393e65a.828238","bd4580ce.87e5e"],["7c9e4862.97e628","d11b46a5.2b11a8"]]},{"id":"c009807.09cd08","type":"switch","z":"dcdaf8f4.e91878","name":"","property":"payload.productType","propertyType":"msg","rules":[{"t":"eq","v":"STANDARD","vt":"str"},{"t":"eq","v":"FRAGILE","vt":"str"},{"t":"eq","v":"FRIGO","vt":"str"}],"checkall":"true","repair":false,"outputs":3,"x":146,"y":1418,"wires":[["e3fe1c21.ccc03"],["51e617ad.819b38"],["f6988d7c.71e2c"]]},{"id":"51e617ad.819b38","type":"delay","z":"dcdaf8f4.e91878","name":"","pauseType":"delay","timeout":"4","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":356,"y":1558,"wires":[["4b72b1e5.1b67"]]},{"id":"4b72b1e5.1b67","type":"function","z":"dcdaf8f4.e91878","name":"set_msg","func":"var message = \"FRAGILE GET \\n\";\nmsg.payload = {};\nmsg.payload = message;\n\nreturn msg;","outputs":1,"noerr":0,"x":496,"y":1558,"wires":[["7c61a247.8204ac"]]},{"id":"7c61a247.8204ac","type":"tcp request","z":"dcdaf8f4.e91878","server":"localhost","port":"9091","out":"char","splitc":"\\n","name":"FRAGILE GET","x":656,"y":1558,"wires":[["3bce0557.0ecc1a"]]},{"id":"3bce0557.0ecc1a","type":"subflow:785d99ff.c78688","z":"dcdaf8f4.e91878","name":"","x":856,"y":1558,"wires":[["fa630706.445f98","100d7167.f4325f","3b6bd602.87e81a"],["a8f17045.efcc9","fa630706.445f98"]]},{"id":"1c7631b6.86face","type":"function","z":"dcdaf8f4.e91878","name":"prepare_message","func":"var message = msg.payload.message.split(\"_\");\nmsg.payload = {};\nmsg.payload = message[0] + \"_\" + message[1];\nreturn msg;","outputs":1,"noerr":0,"x":926,"y":1438,"wires":[["a1595cec.06b6d"]]},{"id":"fa630706.445f98","type":"switch","z":"dcdaf8f4.e91878","name":"","property":"payload.answer","propertyType":"msg","rules":[{"t":"eq","v":"DELIVERED","vt":"str"},{"t":"eq","v":"OK","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":706,"y":1438,"wires":[["1c7631b6.86face","d81ca9bd.4abaf8"],["51e617ad.819b38"]]},{"id":"100d7167.f4325f","type":"function","z":"dcdaf8f4.e91878","name":"set_dashboard","func":"var data = msg.payload.message.split(\"_\");\nmsg.payload = {};\nvar lat = data[0];\nvar long = data[1];\nvar vibrationDetected = data[2];\nvar alarm;\nif(vibrationDetected >= 4000){\n    alarm = true;\n}else{\n    alarm = false;\n}\n\nmsg.payload = {};\nmsg.payload = \"FRAGILE \" + lat + \"_\" + long + \"_\" + vibrationDetected;\nreturn msg;","outputs":1,"noerr":0,"x":1156,"y":1533,"wires":[["a0db7188.a2c46"]]},{"id":"9393e65a.828238","type":"function","z":"dcdaf8f4.e91878","name":"set_tmp_vib_null","func":"var latlong = msg.payload.message.split(\"_\");\nvar lat = latlong[0];\nvar long = latlong[1];\nmsg.payload = {};\n\nmsg.payload = \"STANDARD \" + lat + \"_\" + long;\nreturn msg;","outputs":1,"noerr":0,"x":1211,"y":1248,"wires":[["faa69f83.05cec"]]},{"id":"f6988d7c.71e2c","type":"delay","z":"dcdaf8f4.e91878","name":"","pauseType":"delay","timeout":"4","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":276,"y":1838,"wires":[["855906aa.288e58"]]},{"id":"855906aa.288e58","type":"function","z":"dcdaf8f4.e91878","name":"get_tmp_hum","func":"msg.payload = \"FRIGO GET \\n\";\nreturn msg;","outputs":1,"noerr":0,"x":456,"y":1838,"wires":[["ce618199.68ed9"]]},{"id":"e637b42d.2278d8","type":"subflow:785d99ff.c78688","z":"dcdaf8f4.e91878","name":"","x":876,"y":1838,"wires":[["4c1937ef.626428","993203bd.b0c9","8fcaf6fb.ea6408"],["993203bd.b0c9","ebc67da7.4db61"]]},{"id":"ce618199.68ed9","type":"tcp request","z":"dcdaf8f4.e91878","server":"localhost","port":"9091","out":"char","splitc":"\\n","name":"FRIGO GETSIM","x":656,"y":1838,"wires":[["e637b42d.2278d8"]]},{"id":"4c1937ef.626428","type":"function","z":"dcdaf8f4.e91878","name":"set_dashboard","func":"var data = msg.payload.message.split(\"_\");\nvar lat = data[0];\nvar long = data[1];\nvar setFrigo = data[2];\nvar setDehum = data[3];\nvar tmp = data[4];\nvar hum =data[5];\n\nif(tmp > 10){\n        setFrigo = true;\n}\nelse if(tmp <= 5){\n        setFrigo = false;\n}\n\nif(hum > 75){\n        setDehum = true;\n}\nelse if(hum <= 55){\n        setDehum = false;\n}\n\nmsg.payload = {};\n\nif(tmp >= 12){\n    msg.payload.alarmTmp = true;\n}\n\nmsg.payload.setFrigo = setFrigo;\nmsg.payload.setDehum = setDehum;\nmsg.payload.temp = tmp;\nmsg.payload.hum = hum;\nmsg.payload.lat = lat;\nmsg.payload.long = long;\n\nreturn msg;","outputs":1,"noerr":0,"x":1216,"y":1818,"wires":[["4c05327e.11dcac","4dc95745.c63c28"]]},{"id":"4c05327e.11dcac","type":"function","z":"dcdaf8f4.e91878","name":"set_sim","func":"var setFrigo = msg.payload.setFrigo;\nvar setDehum = msg.payload.setDehum;\nmsg.payload = {};\nmsg.payload = \"FRIGO SET \" + setFrigo + \" \" + setDehum + \" \\n\";\nreturn msg;","outputs":1,"noerr":0,"x":1416,"y":1818,"wires":[["a5219215.0b0ef"]]},{"id":"a5219215.0b0ef","type":"tcp request","z":"dcdaf8f4.e91878","server":"localhost","port":"9091","out":"char","splitc":"\\n","name":"FRIGO SETSIM","x":1576,"y":1818,"wires":[["56913758.45eca8"]]},{"id":"993203bd.b0c9","type":"switch","z":"dcdaf8f4.e91878","name":"","property":"payload.answer","propertyType":"msg","rules":[{"t":"eq","v":"DELIVERED","vt":"str"},{"t":"eq","v":"OK","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":706,"y":1718,"wires":[["1730ee7f.fa24b2","7ece015b.fe0d5"],["f6988d7c.71e2c"]]},{"id":"1730ee7f.fa24b2","type":"function","z":"dcdaf8f4.e91878","name":"prepare_message","func":"var message = msg.payload.message.split(\"_\");\nmsg.payload = {};\nmsg.payload = message[0] + \"_\" + message[1];\nreturn msg;","outputs":1,"noerr":0,"x":946,"y":1718,"wires":[["69b43fd5.67f89"]]},{"id":"56913758.45eca8","type":"subflow:785d99ff.c78688","z":"dcdaf8f4.e91878","name":"","x":1776,"y":1818,"wires":[[],[]]},{"id":"fb1c9b5f.d6d5d8","type":"mqtt out","z":"dcdaf8f4.e91878","name":"eshipping/vehicle/001/end","topic":"eshipping/vehicle/001/end","qos":"2","retain":"","broker":"3434a624.97253a","x":1196,"y":1158,"wires":[]},{"id":"e7bca17b.c5ece","type":"mqtt out","z":"dcdaf8f4.e91878","name":"eshipping/warehouse/dashboard/001","topic":"eshipping/warehouse/dashboard/001","qos":"2","retain":"","broker":"3434a624.97253a","x":1736,"y":1863,"wires":[]},{"id":"a0db7188.a2c46","type":"mqtt out","z":"dcdaf8f4.e91878","name":"eshipping/warehouse/dashboard/001","topic":"eshipping/warehouse/dashboard/001","qos":"2","retain":"","broker":"3434a624.97253a","x":1436,"y":1533,"wires":[]},{"id":"faa69f83.05cec","type":"mqtt out","z":"dcdaf8f4.e91878","name":"eshipping/warehouse/dashboard/001","topic":"eshipping/warehouse/dashboard/001","qos":"2","retain":"","broker":"3434a624.97253a","x":1481,"y":1248,"wires":[]},{"id":"a1595cec.06b6d","type":"mqtt out","z":"dcdaf8f4.e91878","name":"eshipping/vehicle/001/end","topic":"eshipping/vehicle/001/end","qos":"2","retain":"","broker":"3434a624.97253a","x":1176,"y":1438,"wires":[]},{"id":"69b43fd5.67f89","type":"mqtt out","z":"dcdaf8f4.e91878","name":"eshipping/vehicle/001/end","topic":"eshipping/vehicle/001/end","qos":"2","retain":"","broker":"3434a624.97253a","x":1196,"y":1718,"wires":[]},{"id":"36b4845d.db738c","type":"function","z":"dcdaf8f4.e91878","name":"read_message","func":"var string = msg.payload;\nvar array = string.split(\"###\");\nvar productInfo = array[1];\nvar arrayProduct = productInfo.split(\"_\");\n\nmsg.payload = {};\nmsg.payload.idVehicle = array[0];\nmsg.payload.productID = arrayProduct[0];\nmsg.payload.productDescription = arrayProduct[1];\nmsg.payload.productDestination = arrayProduct[2];\nmsg.payload.productType = arrayProduct[3];\n\nreturn msg;","outputs":1,"noerr":0,"x":300,"y":2166,"wires":[["4e309575.35efec","85de7819.14b118"]]},{"id":"d3afb52d.82a668","type":"tcp request","z":"dcdaf8f4.e91878","server":"localhost","port":"9092","out":"char","splitc":"\\n","name":"SENSORS","x":639,"y":2076,"wires":[["e89de33c.877ec"]]},{"id":"e89de33c.877ec","type":"subflow:785d99ff.c78688","z":"dcdaf8f4.e91878","x":849,"y":2076,"wires":[[],[]]},{"id":"9d81ee8f.30067","type":"mqtt in","z":"dcdaf8f4.e91878","name":"eshipping/vehicle/002/start","topic":"eshipping/vehicle/002/start","qos":"2","broker":"737ce9f5.5b77d8","x":150,"y":2086,"wires":[["36b4845d.db738c"]]},{"id":"4e309575.35efec","type":"function","z":"dcdaf8f4.e91878","name":"set_message","func":"msg.payload = msg.payload.productType + \" SENSORS \" + msg.payload.productID +  \" \\n\"; \nreturn msg;","outputs":1,"noerr":0,"x":459,"y":2076,"wires":[["d3afb52d.82a668"]]},{"id":"6f0a11f.ba27df","type":"comment","z":"dcdaf8f4.e91878","name":"Start vehicle 002 delivery","info":"","x":150,"y":2046,"wires":[]},{"id":"ef8757c3.4dc078","type":"delay","z":"dcdaf8f4.e91878","name":"","pauseType":"delay","timeout":"4","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":400,"y":2286,"wires":[["74d5c3a3.3b431c"]]},{"id":"74d5c3a3.3b431c","type":"function","z":"dcdaf8f4.e91878","name":"set_msg","func":"var message = \"STANDARD GET \\n\";\nmsg.payload = {};\nmsg.payload = message;\n\nreturn msg;","outputs":1,"noerr":0,"x":560,"y":2286,"wires":[["a383d580.a905d8"]]},{"id":"a383d580.a905d8","type":"tcp request","z":"dcdaf8f4.e91878","server":"localhost","port":"9092","out":"char","splitc":"\\n","name":"STANDARD GET","x":730,"y":2286,"wires":[["18f27678.be56ba"]]},{"id":"fdb21501.d2d9f8","type":"switch","z":"dcdaf8f4.e91878","name":"","property":"payload.answer","propertyType":"msg","rules":[{"t":"eq","v":"DELIVERED","vt":"str"},{"t":"eq","v":"OK","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":710,"y":2166,"wires":[["96be4fff.702b7","b185e4f6.4a4018"],["ef8757c3.4dc078"]]},{"id":"96be4fff.702b7","type":"function","z":"dcdaf8f4.e91878","name":"prepare_message","func":"var message = msg.payload.message.split(\"_\");\nmsg.payload = {};\nmsg.payload = message[0] + \"_\" + message[1];\nreturn msg;","outputs":1,"noerr":0,"x":950,"y":2166,"wires":[["eeda0946.fcfec8"]]},{"id":"18f27678.be56ba","type":"subflow:785d99ff.c78688","z":"dcdaf8f4.e91878","name":"","x":940,"y":2286,"wires":[["fdb21501.d2d9f8","badb8d7a.9af82","d88383b5.860e"],["522ad4a2.21c12c","fdb21501.d2d9f8"]]},{"id":"85de7819.14b118","type":"switch","z":"dcdaf8f4.e91878","name":"","property":"payload.productType","propertyType":"msg","rules":[{"t":"eq","v":"STANDARD","vt":"str"},{"t":"eq","v":"FRAGILE","vt":"str"},{"t":"eq","v":"FRIGO","vt":"str"}],"checkall":"true","repair":false,"outputs":3,"x":150,"y":2426,"wires":[["ef8757c3.4dc078"],["2f51093a.964586"],["b80f1c9d.1f46a"]]},{"id":"2f51093a.964586","type":"delay","z":"dcdaf8f4.e91878","name":"","pauseType":"delay","timeout":"4","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":360,"y":2566,"wires":[["c7fbd2a5.8f4e5"]]},{"id":"c7fbd2a5.8f4e5","type":"function","z":"dcdaf8f4.e91878","name":"set_msg","func":"var message = \"FRAGILE GET \\n\";\nmsg.payload = {};\nmsg.payload = message;\n\nreturn msg;","outputs":1,"noerr":0,"x":500,"y":2566,"wires":[["ef56d83d.012688"]]},{"id":"ef56d83d.012688","type":"tcp request","z":"dcdaf8f4.e91878","server":"localhost","port":"9092","out":"char","splitc":"\\n","name":"FRAGILE GET","x":660,"y":2566,"wires":[["f688c77b.d257d8"]]},{"id":"f688c77b.d257d8","type":"subflow:785d99ff.c78688","z":"dcdaf8f4.e91878","name":"","x":860,"y":2566,"wires":[["2c1122f8.7748de","9b4688cc.e96fe8","a5a57208.8cfa1"],["db4c0f3b.5cbb6","2c1122f8.7748de"]]},{"id":"e99b7e4d.42258","type":"function","z":"dcdaf8f4.e91878","name":"prepare_message","func":"var message = msg.payload.message.split(\"_\");\nmsg.payload = {};\nmsg.payload = message[0] + \"_\" + message[1];\nreturn msg;","outputs":1,"noerr":0,"x":930,"y":2446,"wires":[["8c1016f5.5428f8"]]},{"id":"2c1122f8.7748de","type":"switch","z":"dcdaf8f4.e91878","name":"","property":"payload.answer","propertyType":"msg","rules":[{"t":"eq","v":"DELIVERED","vt":"str"},{"t":"eq","v":"OK","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":710,"y":2446,"wires":[["e99b7e4d.42258","fbe2ec25.b989d"],["2f51093a.964586"]]},{"id":"9b4688cc.e96fe8","type":"function","z":"dcdaf8f4.e91878","name":"set_dashboard","func":"var data = msg.payload.message.split(\"_\");\nmsg.payload = {};\nvar lat = data[0];\nvar long = data[1];\nvar vibrationDetected = data[2];\nvar alarm;\nif(vibrationDetected >= 4000){\n    alarm = true;\n}else{\n    alarm = false;\n}\n\nmsg.payload = {};\nmsg.payload = \"FRAGILE \" + lat + \"_\" + long + \"_\" + vibrationDetected;\nreturn msg;","outputs":1,"noerr":0,"x":1160,"y":2536,"wires":[["c89daeaf.2efb3"]]},{"id":"badb8d7a.9af82","type":"function","z":"dcdaf8f4.e91878","name":"set_tmp_vib_null","func":"var latlong = msg.payload.message.split(\"_\");\nvar lat = latlong[0];\nvar long = latlong[1];\nmsg.payload = {};\n\nmsg.payload = \"STANDARD \" + lat + \"_\" + long;\nreturn msg;","outputs":1,"noerr":0,"x":1200,"y":2266,"wires":[["233f8d1e.a3bdd2"]]},{"id":"b80f1c9d.1f46a","type":"delay","z":"dcdaf8f4.e91878","name":"","pauseType":"delay","timeout":"4","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":280,"y":2846,"wires":[["b70443a4.58992"]]},{"id":"b70443a4.58992","type":"function","z":"dcdaf8f4.e91878","name":"get_tmp_hum","func":"msg.payload = \"FRIGO GET \\n\";\nreturn msg;","outputs":1,"noerr":0,"x":460,"y":2846,"wires":[["434ea26f.7d411c"]]},{"id":"2dcbce7b.3cd362","type":"subflow:785d99ff.c78688","z":"dcdaf8f4.e91878","name":"","x":880,"y":2846,"wires":[["55620522.a7d0cc","925de73e.e4d448","78008f90.d5ac4"],["925de73e.e4d448","aaec056e.7a49d8"]]},{"id":"434ea26f.7d411c","type":"tcp request","z":"dcdaf8f4.e91878","server":"localhost","port":"9092","out":"char","splitc":"\\n","name":"FRIGO GETSIM","x":660,"y":2846,"wires":[["2dcbce7b.3cd362"]]},{"id":"55620522.a7d0cc","type":"function","z":"dcdaf8f4.e91878","name":"set_dashboard","func":"var data = msg.payload.message.split(\"_\");\nvar lat = data[0];\nvar long = data[1];\nvar setFrigo = data[2];\nvar setDehum = data[3];\nvar tmp = data[4];\nvar hum =data[5];\n\nif(tmp > 10){\n        setFrigo = true;\n}\nelse if(tmp <= 5){\n        setFrigo = false;\n}\n\nif(hum > 75){\n        setDehum = true;\n}\nelse if(hum <= 55){\n        setDehum = false;\n}\n\nmsg.payload = {};\n\nif(tmp >= 12){\n    msg.payload.alarmTmp = true;\n}\n\nmsg.payload.setFrigo = setFrigo;\nmsg.payload.setDehum = setDehum;\nmsg.payload.temp = tmp;\nmsg.payload.hum = hum;\nmsg.payload.lat = lat;\nmsg.payload.long = long;\n\nreturn msg;","outputs":1,"noerr":0,"x":1220,"y":2826,"wires":[["4daf2940.3937c8","becf3493.911ba8"]]},{"id":"4daf2940.3937c8","type":"function","z":"dcdaf8f4.e91878","name":"set_sim","func":"var setFrigo = msg.payload.setFrigo;\nvar setDehum = msg.payload.setDehum;\nmsg.payload = {};\nmsg.payload = \"FRIGO SET \" + setFrigo + \" \" + setDehum + \" \\n\";\nreturn msg;","outputs":1,"noerr":0,"x":1420,"y":2826,"wires":[["86525b86.acfc38"]]},{"id":"86525b86.acfc38","type":"tcp request","z":"dcdaf8f4.e91878","server":"localhost","port":"9092","out":"char","splitc":"\\n","name":"FRIGO SETSIM","x":1580,"y":2826,"wires":[["3c1efada.bff8f6"]]},{"id":"925de73e.e4d448","type":"switch","z":"dcdaf8f4.e91878","name":"","property":"payload.answer","propertyType":"msg","rules":[{"t":"eq","v":"DELIVERED","vt":"str"},{"t":"eq","v":"OK","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":710,"y":2726,"wires":[["4c55ac02.687ad4","5d0ccb1e.38e9c4"],["b80f1c9d.1f46a"]]},{"id":"4c55ac02.687ad4","type":"function","z":"dcdaf8f4.e91878","name":"prepare_message","func":"var message = msg.payload.message.split(\"_\");\nmsg.payload = {};\nmsg.payload = message[0] + \"_\" + message[1];\nreturn msg;","outputs":1,"noerr":0,"x":950,"y":2726,"wires":[["d7170a28.c70768"]]},{"id":"3c1efada.bff8f6","type":"subflow:785d99ff.c78688","z":"dcdaf8f4.e91878","name":"","x":1780,"y":2826,"wires":[[],[]]},{"id":"eeda0946.fcfec8","type":"mqtt out","z":"dcdaf8f4.e91878","name":"eshipping/vehicle/002/end","topic":"eshipping/vehicle/002/end","qos":"2","retain":"","broker":"3434a624.97253a","x":1200,"y":2166,"wires":[]},{"id":"209348f0.193948","type":"mqtt out","z":"dcdaf8f4.e91878","name":"eshipping/warehouse/dashboard/002","topic":"eshipping/warehouse/dashboard/002","qos":"2","retain":"","broker":"3434a624.97253a","x":1740,"y":2866,"wires":[]},{"id":"c89daeaf.2efb3","type":"mqtt out","z":"dcdaf8f4.e91878","name":"eshipping/warehouse/dashboard/002","topic":"eshipping/warehouse/dashboard/002","qos":"2","retain":"","broker":"3434a624.97253a","x":1440,"y":2536,"wires":[]},{"id":"233f8d1e.a3bdd2","type":"mqtt out","z":"dcdaf8f4.e91878","name":"eshipping/warehouse/dashboard/002","topic":"eshipping/warehouse/dashboard/002","qos":"2","retain":"","broker":"3434a624.97253a","x":1485,"y":2266,"wires":[]},{"id":"8c1016f5.5428f8","type":"mqtt out","z":"dcdaf8f4.e91878","name":"eshipping/vehicle/002/end","topic":"eshipping/vehicle/002/end","qos":"2","retain":"","broker":"3434a624.97253a","x":1180,"y":2446,"wires":[]},{"id":"d7170a28.c70768","type":"mqtt out","z":"dcdaf8f4.e91878","name":"eshipping/vehicle/002/end","topic":"eshipping/vehicle/002/end","qos":"2","retain":"","broker":"3434a624.97253a","x":1200,"y":2726,"wires":[]},{"id":"d0d5b789.9c8ca8","type":"function","z":"dcdaf8f4.e91878","name":"read_message","func":"var string = msg.payload;\nvar array = string.split(\"###\");\nvar productInfo = array[1];\nvar arrayProduct = productInfo.split(\"_\");\n\nmsg.payload = {};\nmsg.payload.idVehicle = array[0];\nmsg.payload.productID = arrayProduct[0];\nmsg.payload.productDescription = arrayProduct[1];\nmsg.payload.productDestination = arrayProduct[2];\nmsg.payload.productType = arrayProduct[3];\n\nreturn msg;","outputs":1,"noerr":0,"x":304,"y":3150,"wires":[["8c402597.0a6988","8904c705.92b378"]]},{"id":"285422b3.c7d73e","type":"tcp request","z":"dcdaf8f4.e91878","server":"localhost","port":"9093","out":"char","splitc":"\\n","name":"SENSORS","x":644,"y":3068,"wires":[["864ea5f9.a72fe8"]]},{"id":"864ea5f9.a72fe8","type":"subflow:785d99ff.c78688","z":"dcdaf8f4.e91878","x":854,"y":3068,"wires":[[],[]]},{"id":"5b8ec52.7f73e3c","type":"mqtt in","z":"dcdaf8f4.e91878","name":"eshipping/vehicle/003/start","topic":"eshipping/vehicle/003/start","qos":"2","broker":"737ce9f5.5b77d8","x":154,"y":3070,"wires":[["d0d5b789.9c8ca8"]]},{"id":"8c402597.0a6988","type":"function","z":"dcdaf8f4.e91878","name":"set_message","func":"msg.payload = msg.payload.productType + \" SENSORS \" + msg.payload.productID +  \" \\n\"; \nreturn msg;","outputs":1,"noerr":0,"x":464,"y":3068,"wires":[["285422b3.c7d73e"]]},{"id":"54b9c155.477af","type":"comment","z":"dcdaf8f4.e91878","name":"Start vehicle 003 delivery","info":"","x":154,"y":3030,"wires":[]},{"id":"1a83e1f5.ce987e","type":"delay","z":"dcdaf8f4.e91878","name":"","pauseType":"delay","timeout":"4","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":404,"y":3270,"wires":[["5393c9ec.7e0e98"]]},{"id":"5393c9ec.7e0e98","type":"function","z":"dcdaf8f4.e91878","name":"set_msg","func":"var message = \"STANDARD GET \\n\";\nmsg.payload = {};\nmsg.payload = message;\n\nreturn msg;","outputs":1,"noerr":0,"x":564,"y":3270,"wires":[["38b16e6a.44b932"]]},{"id":"38b16e6a.44b932","type":"tcp request","z":"dcdaf8f4.e91878","server":"localhost","port":"9093","out":"char","splitc":"\\n","name":"STANDARD GET","x":734,"y":3270,"wires":[["4975dc9c.2d4b94"]]},{"id":"e8fde8bd.f4d928","type":"switch","z":"dcdaf8f4.e91878","name":"","property":"payload.answer","propertyType":"msg","rules":[{"t":"eq","v":"DELIVERED","vt":"str"},{"t":"eq","v":"OK","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":714,"y":3150,"wires":[["d5dbec30.9bdaf","e7bd210e.06d1c"],["1a83e1f5.ce987e"]]},{"id":"d5dbec30.9bdaf","type":"function","z":"dcdaf8f4.e91878","name":"prepare_message","func":"var message = msg.payload.message.split(\"_\");\nmsg.payload = {};\nmsg.payload = message[0] + \"_\" + message[1];\nreturn msg;","outputs":1,"noerr":0,"x":954,"y":3150,"wires":[["8ce36017.2c17e"]]},{"id":"4975dc9c.2d4b94","type":"subflow:785d99ff.c78688","z":"dcdaf8f4.e91878","name":"","x":944,"y":3270,"wires":[["e8fde8bd.f4d928","210d094e.0d7be6","ae49cc24.35dec"],["ca4c9a5c.1d0ec8","e8fde8bd.f4d928"]]},{"id":"8904c705.92b378","type":"switch","z":"dcdaf8f4.e91878","name":"","property":"payload.productType","propertyType":"msg","rules":[{"t":"eq","v":"STANDARD","vt":"str"},{"t":"eq","v":"FRAGILE","vt":"str"},{"t":"eq","v":"FRIGO","vt":"str"}],"checkall":"true","repair":false,"outputs":3,"x":154,"y":3410,"wires":[["1a83e1f5.ce987e"],["12977ffa.50a29"],["2d37f069.e1aa2"]]},{"id":"12977ffa.50a29","type":"delay","z":"dcdaf8f4.e91878","name":"","pauseType":"delay","timeout":"4","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":364,"y":3550,"wires":[["99436f9.e960c9"]]},{"id":"99436f9.e960c9","type":"function","z":"dcdaf8f4.e91878","name":"set_msg","func":"var message = \"FRAGILE GET \\n\";\nmsg.payload = {};\nmsg.payload = message;\n\nreturn msg;","outputs":1,"noerr":0,"x":504,"y":3550,"wires":[["eec34e8a.2a857"]]},{"id":"eec34e8a.2a857","type":"tcp request","z":"dcdaf8f4.e91878","server":"localhost","port":"9093","out":"char","splitc":"\\n","name":"FRAGILE GET","x":664,"y":3550,"wires":[["6c34723b.b2b27c"]]},{"id":"6c34723b.b2b27c","type":"subflow:785d99ff.c78688","z":"dcdaf8f4.e91878","name":"","x":864,"y":3550,"wires":[["bd85a55e.e85af8","27b6a21a.3fe21e","a4285cfc.0a5f1"],["521e960a.c7bb78","bd85a55e.e85af8"]]},{"id":"40607ba4.1da1d4","type":"function","z":"dcdaf8f4.e91878","name":"prepare_message","func":"var message = msg.payload.message.split(\"_\");\nmsg.payload = {};\nmsg.payload = message[0] + \"_\" + message[1];\nreturn msg;","outputs":1,"noerr":0,"x":934,"y":3430,"wires":[["1dc8b8db.79ed97"]]},{"id":"bd85a55e.e85af8","type":"switch","z":"dcdaf8f4.e91878","name":"","property":"payload.answer","propertyType":"msg","rules":[{"t":"eq","v":"DELIVERED","vt":"str"},{"t":"eq","v":"OK","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":714,"y":3430,"wires":[["40607ba4.1da1d4","c8fddf55.8e482"],["12977ffa.50a29"]]},{"id":"27b6a21a.3fe21e","type":"function","z":"dcdaf8f4.e91878","name":"set_dashboard","func":"var data = msg.payload.message.split(\"_\");\nmsg.payload = {};\nvar lat = data[0];\nvar long = data[1];\nvar vibrationDetected = data[2];\nvar alarm;\nif(vibrationDetected >= 4000){\n    alarm = true;\n}else{\n    alarm = false;\n}\n\nmsg.payload = {};\nmsg.payload = \"FRAGILE \" + lat + \"_\" + long + \"_\" + vibrationDetected;\nreturn msg;","outputs":1,"noerr":0,"x":1164,"y":3515,"wires":[["3aac8af6.a0da86"]]},{"id":"210d094e.0d7be6","type":"function","z":"dcdaf8f4.e91878","name":"set_tmp_vib_null","func":"var latlong = msg.payload.message.split(\"_\");\nvar lat = latlong[0];\nvar long = latlong[1];\nmsg.payload = {};\n\nmsg.payload = \"STANDARD \" + lat + \"_\" + long;\nreturn msg;","outputs":1,"noerr":0,"x":1219,"y":3245,"wires":[["d15bf55d.543408"]]},{"id":"2d37f069.e1aa2","type":"delay","z":"dcdaf8f4.e91878","name":"","pauseType":"delay","timeout":"4","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":284,"y":3830,"wires":[["cdcd154d.c57608"]]},{"id":"cdcd154d.c57608","type":"function","z":"dcdaf8f4.e91878","name":"get_tmp_hum","func":"msg.payload = \"FRIGO GET \\n\";\nreturn msg;","outputs":1,"noerr":0,"x":464,"y":3830,"wires":[["b14a15b2.c84e18"]]},{"id":"d591eec1.5f706","type":"subflow:785d99ff.c78688","z":"dcdaf8f4.e91878","name":"","x":884,"y":3830,"wires":[["77daf36f.4afa1c","83e0f346.2bc23","ae5a6889.916d48"],["83e0f346.2bc23","5ea3bfd5.871b6"]]},{"id":"b14a15b2.c84e18","type":"tcp request","z":"dcdaf8f4.e91878","server":"localhost","port":"9093","out":"char","splitc":"\\n","name":"FRIGO GETSIM","x":664,"y":3830,"wires":[["d591eec1.5f706"]]},{"id":"77daf36f.4afa1c","type":"function","z":"dcdaf8f4.e91878","name":"set_dashboard","func":"var data = msg.payload.message.split(\"_\");\nvar lat = data[0];\nvar long = data[1];\nvar setFrigo = data[2];\nvar setDehum = data[3];\nvar tmp = data[4];\nvar hum =data[5];\n\nif(tmp > 10){\n        setFrigo = true;\n}\nelse if(tmp <= 5){\n        setFrigo = false;\n}\n\nif(hum > 75){\n        setDehum = true;\n}\nelse if(hum <= 55){\n        setDehum = false;\n}\n\nmsg.payload = {};\n\nif(tmp >= 12){\n    msg.payload.alarmTmp = true;\n}\n\nmsg.payload.setFrigo = setFrigo;\nmsg.payload.setDehum = setDehum;\nmsg.payload.temp = tmp;\nmsg.payload.hum = hum;\nmsg.payload.lat = lat;\nmsg.payload.long = long;\n\nreturn msg;","outputs":1,"noerr":0,"x":1224,"y":3810,"wires":[["e188bf4e.41caa","5dce4055.e567c"]]},{"id":"e188bf4e.41caa","type":"function","z":"dcdaf8f4.e91878","name":"set_sim","func":"var setFrigo = msg.payload.setFrigo;\nvar setDehum = msg.payload.setDehum;\nmsg.payload = {};\nmsg.payload = \"FRIGO SET \" + setFrigo + \" \" + setDehum + \" \\n\";\nreturn msg;","outputs":1,"noerr":0,"x":1424,"y":3810,"wires":[["2fd67ccc.f64854"]]},{"id":"2fd67ccc.f64854","type":"tcp request","z":"dcdaf8f4.e91878","server":"localhost","port":"9093","out":"char","splitc":"\\n","name":"FRIGO SETSIM","x":1584,"y":3810,"wires":[["fa73aebe.9423b"]]},{"id":"83e0f346.2bc23","type":"switch","z":"dcdaf8f4.e91878","name":"","property":"payload.answer","propertyType":"msg","rules":[{"t":"eq","v":"DELIVERED","vt":"str"},{"t":"eq","v":"OK","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":714,"y":3710,"wires":[["e12e5539.de68b8","a8f50520.4df0a8"],["2d37f069.e1aa2"]]},{"id":"e12e5539.de68b8","type":"function","z":"dcdaf8f4.e91878","name":"prepare_message","func":"var message = msg.payload.message.split(\"_\");\nmsg.payload = {};\nmsg.payload = message[0] + \"_\" + message[1];\nreturn msg;","outputs":1,"noerr":0,"x":954,"y":3710,"wires":[["e6053d3e.6fb31"]]},{"id":"fa73aebe.9423b","type":"subflow:785d99ff.c78688","z":"dcdaf8f4.e91878","name":"","x":1784,"y":3810,"wires":[[],[]]},{"id":"8ce36017.2c17e","type":"mqtt out","z":"dcdaf8f4.e91878","name":"eshipping/vehicle/003/end","topic":"eshipping/vehicle/003/end","qos":"2","retain":"","broker":"3434a624.97253a","x":1204,"y":3150,"wires":[]},{"id":"f753909d.69ed9","type":"mqtt out","z":"dcdaf8f4.e91878","name":"eshipping/warehouse/dashboard/003","topic":"eshipping/warehouse/dashboard/003","qos":"2","retain":"","broker":"3434a624.97253a","x":1744,"y":3860,"wires":[]},{"id":"3aac8af6.a0da86","type":"mqtt out","z":"dcdaf8f4.e91878","name":"eshipping/warehouse/dashboard/003","topic":"eshipping/warehouse/dashboard/003","qos":"2","retain":"","broker":"3434a624.97253a","x":1429,"y":3515,"wires":[]},{"id":"d15bf55d.543408","type":"mqtt out","z":"dcdaf8f4.e91878","name":"eshipping/warehouse/dashboard/003","topic":"eshipping/warehouse/dashboard/003","qos":"2","retain":"","broker":"3434a624.97253a","x":1489,"y":3245,"wires":[]},{"id":"1dc8b8db.79ed97","type":"mqtt out","z":"dcdaf8f4.e91878","name":"eshipping/vehicle/003/end","topic":"eshipping/vehicle/003/end","qos":"2","retain":"","broker":"3434a624.97253a","x":1184,"y":3430,"wires":[]},{"id":"e6053d3e.6fb31","type":"mqtt out","z":"dcdaf8f4.e91878","name":"eshipping/vehicle/003/end","topic":"eshipping/vehicle/003/end","qos":"2","retain":"","broker":"3434a624.97253a","x":1204,"y":3710,"wires":[]},{"id":"f5663bc.c80e2c8","type":"function","z":"dcdaf8f4.e91878","name":"read_message","func":"var string = msg.payload;\nvar array = string.split(\"###\");\nvar productInfo = array[1];\nvar arrayProduct = productInfo.split(\"_\");\n\nmsg.payload = {};\nmsg.payload.idVehicle = array[0];\nmsg.payload.productID = arrayProduct[0];\nmsg.payload.productDescription = arrayProduct[1];\nmsg.payload.productDestination = arrayProduct[2];\nmsg.payload.productType = arrayProduct[3];\n\nreturn msg;","outputs":1,"noerr":0,"x":319.3333740234375,"y":4230,"wires":[["c40c9e32.1aece","cbf3ef90.109d4"]]},{"id":"c9f27e2d.a3db9","type":"tcp request","z":"dcdaf8f4.e91878","server":"localhost","port":"9094","out":"char","splitc":"\\n","name":"SENSORS","x":599.0001220703125,"y":4127,"wires":[["9a1704da.34eba8"]]},{"id":"9a1704da.34eba8","type":"subflow:785d99ff.c78688","z":"dcdaf8f4.e91878","x":800.9998779296875,"y":4128.3330078125,"wires":[[],[]]},{"id":"e91cbcd6.50c99","type":"mqtt in","z":"dcdaf8f4.e91878","name":"eshipping/vehicle/004/start","topic":"eshipping/vehicle/004/start","qos":"2","broker":"737ce9f5.5b77d8","x":169.3333740234375,"y":4150,"wires":[["f5663bc.c80e2c8"]]},{"id":"c40c9e32.1aece","type":"function","z":"dcdaf8f4.e91878","name":"set_message","func":"msg.payload = msg.payload.productType + \" SENSORS \" + msg.payload.productID +  \" \\n\"; \nreturn msg;","outputs":1,"noerr":0,"x":425.66668701171875,"y":4125.66650390625,"wires":[["c9f27e2d.a3db9"]]},{"id":"6d68630f.e0c94c","type":"comment","z":"dcdaf8f4.e91878","name":"Start vehicle 004 delivery","info":"","x":169.3333740234375,"y":4110,"wires":[]},{"id":"cb928d14.1914b","type":"delay","z":"dcdaf8f4.e91878","name":"","pauseType":"delay","timeout":"4","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":419.3333740234375,"y":4350,"wires":[["e5567793.ded1e8"]]},{"id":"e5567793.ded1e8","type":"function","z":"dcdaf8f4.e91878","name":"set_msg","func":"var message = \"STANDARD GET \\n\";\nmsg.payload = {};\nmsg.payload = message;\n\nreturn msg;","outputs":1,"noerr":0,"x":579.3333740234375,"y":4350,"wires":[["a6537a97.ff73d8"]]},{"id":"a6537a97.ff73d8","type":"tcp request","z":"dcdaf8f4.e91878","server":"localhost","port":"9094","out":"char","splitc":"\\n","name":"STANDARD GET","x":749.3333740234375,"y":4350,"wires":[["84a8c5e8.a53a98"]]},{"id":"55d52c2.ccd4fd4","type":"switch","z":"dcdaf8f4.e91878","name":"","property":"payload.answer","propertyType":"msg","rules":[{"t":"eq","v":"DELIVERED","vt":"str"},{"t":"eq","v":"OK","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":729.3333740234375,"y":4230,"wires":[["2575b71d.41cc88","2352d7dd.222bd8","c295f9e7.1e6578"],["cb928d14.1914b"]]},{"id":"2575b71d.41cc88","type":"function","z":"dcdaf8f4.e91878","name":"prepare_message","func":"var message = msg.payload.message.split(\"_\");\nmsg.payload = {};\nmsg.payload = message[0] + \"_\" + message[1];\nreturn msg;","outputs":1,"noerr":0,"x":969.3333740234375,"y":4230,"wires":[["c17ad467.8130b8"]]},{"id":"84a8c5e8.a53a98","type":"subflow:785d99ff.c78688","z":"dcdaf8f4.e91878","name":"","x":959.3333740234375,"y":4350,"wires":[["55d52c2.ccd4fd4","d0d06f0b.67f47","9cbd8512.c18118"],["c295f9e7.1e6578","55d52c2.ccd4fd4"]]},{"id":"cbf3ef90.109d4","type":"switch","z":"dcdaf8f4.e91878","name":"","property":"payload.productType","propertyType":"msg","rules":[{"t":"eq","v":"STANDARD","vt":"str"},{"t":"eq","v":"FRAGILE","vt":"str"},{"t":"eq","v":"FRIGO","vt":"str"}],"checkall":"true","repair":false,"outputs":3,"x":169.3333740234375,"y":4490,"wires":[["cb928d14.1914b"],["3f429230.12a14e"],["b88d0ca0.22d8f"]]},{"id":"3f429230.12a14e","type":"delay","z":"dcdaf8f4.e91878","name":"","pauseType":"delay","timeout":"4","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":379.3333740234375,"y":4630,"wires":[["3113d1b9.e642ee"]]},{"id":"3113d1b9.e642ee","type":"function","z":"dcdaf8f4.e91878","name":"set_msg","func":"var message = \"FRAGILE GET \\n\";\nmsg.payload = {};\nmsg.payload = message;\n\nreturn msg;","outputs":1,"noerr":0,"x":519.3333740234375,"y":4630,"wires":[["fb840b95.b6e758"]]},{"id":"fb840b95.b6e758","type":"tcp request","z":"dcdaf8f4.e91878","server":"localhost","port":"9094","out":"char","splitc":"\\n","name":"FRAGILE GET","x":679.3333740234375,"y":4630,"wires":[["e93f810d.dd2bc"]]},{"id":"e93f810d.dd2bc","type":"subflow:785d99ff.c78688","z":"dcdaf8f4.e91878","name":"","x":879.3333740234375,"y":4630,"wires":[["52f6f711.77a728","96b070f1.c13e2","b301328.eadf1d"],["40fda8c3.303bd8","52f6f711.77a728"]]},{"id":"b8c951ff.47bb3","type":"function","z":"dcdaf8f4.e91878","name":"prepare_message","func":"var message = msg.payload.message.split(\"_\");\nmsg.payload = {};\nmsg.payload = message[0] + \"_\" + message[1];\nreturn msg;","outputs":1,"noerr":0,"x":949.3333740234375,"y":4510,"wires":[["ecab47c7.905de8"]]},{"id":"52f6f711.77a728","type":"switch","z":"dcdaf8f4.e91878","name":"","property":"payload.answer","propertyType":"msg","rules":[{"t":"eq","v":"DELIVERED","vt":"str"},{"t":"eq","v":"OK","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":729.3333740234375,"y":4510,"wires":[["b8c951ff.47bb3","11701e0f.00b122","40fda8c3.303bd8"],["3f429230.12a14e"]]},{"id":"96b070f1.c13e2","type":"function","z":"dcdaf8f4.e91878","name":"set_dashboard","func":"var data = msg.payload.message.split(\"_\");\nmsg.payload = {};\nvar lat = data[0];\nvar long = data[1];\nvar vibrationDetected = data[2];\nvar alarm;\nif(vibrationDetected >= 4000){\n    alarm = true;\n}else{\n    alarm = false;\n}\n\nmsg.payload = {};\nmsg.payload = \"FRAGILE \" + lat + \"_\" + long + \"_\" + vibrationDetected;\nreturn msg;","outputs":1,"noerr":0,"x":1189.3333740234375,"y":4590,"wires":[["8092d895.a52468"]]},{"id":"d0d06f0b.67f47","type":"function","z":"dcdaf8f4.e91878","name":"set_tmp_vib_null","func":"var latlong = msg.payload.message.split(\"_\");\nvar lat = latlong[0];\nvar long = latlong[1];\nmsg.payload = {};\n\nmsg.payload = \"STANDARD \" + lat + \"_\" + long;\nreturn msg;","outputs":1,"noerr":0,"x":1244.3333740234375,"y":4320,"wires":[["34875a2e.9e6cf6"]]},{"id":"b88d0ca0.22d8f","type":"delay","z":"dcdaf8f4.e91878","name":"","pauseType":"delay","timeout":"4","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":299.3333740234375,"y":4910,"wires":[["5f857ba1.162b04"]]},{"id":"5f857ba1.162b04","type":"function","z":"dcdaf8f4.e91878","name":"get_tmp_hum","func":"msg.payload = \"FRIGO GET \\n\";\nreturn msg;","outputs":1,"noerr":0,"x":479.3333740234375,"y":4910,"wires":[["3c776140.10082e"]]},{"id":"d3907fba.8992f","type":"subflow:785d99ff.c78688","z":"dcdaf8f4.e91878","name":"","x":899.3333740234375,"y":4910,"wires":[["981bc232.8be73","7a341c93.f8b3e4","3a02c0d1.a4dc7"],["7a341c93.f8b3e4","e7473be3.6124c8"]]},{"id":"3c776140.10082e","type":"tcp request","z":"dcdaf8f4.e91878","server":"localhost","port":"9094","out":"char","splitc":"\\n","name":"FRIGO GETSIM","x":679.3333740234375,"y":4910,"wires":[["d3907fba.8992f"]]},{"id":"981bc232.8be73","type":"function","z":"dcdaf8f4.e91878","name":"set_dashboard","func":"var data = msg.payload.message.split(\"_\");\nvar lat = data[0];\nvar long = data[1];\nvar setFrigo = data[2];\nvar setDehum = data[3];\nvar tmp = data[4];\nvar hum =data[5];\n\nif(tmp > 10){\n        setFrigo = true;\n}\nelse if(tmp <= 5){\n        setFrigo = false;\n}\n\nif(hum > 75){\n        setDehum = true;\n}\nelse if(hum <= 55){\n        setDehum = false;\n}\n\nmsg.payload = {};\n\nif(tmp >= 12){\n    msg.payload.alarmTmp = true;\n}\n\nmsg.payload.setFrigo = setFrigo;\nmsg.payload.setDehum = setDehum;\nmsg.payload.temp = tmp;\nmsg.payload.hum = hum;\nmsg.payload.lat = lat;\nmsg.payload.long = long;\n\nreturn msg;","outputs":1,"noerr":0,"x":1239.3333740234375,"y":4890,"wires":[["b0279e19.cf829","22edd41d.c59c6c"]]},{"id":"b0279e19.cf829","type":"function","z":"dcdaf8f4.e91878","name":"set_sim","func":"var setFrigo = msg.payload.setFrigo;\nvar setDehum = msg.payload.setDehum;\nmsg.payload = {};\nmsg.payload = \"FRIGO SET \" + setFrigo + \" \" + setDehum + \" \\n\";\nreturn msg;","outputs":1,"noerr":0,"x":1439.3333740234375,"y":4890,"wires":[["ba86c4ca.76a258"]]},{"id":"ba86c4ca.76a258","type":"tcp request","z":"dcdaf8f4.e91878","server":"localhost","port":"9094","out":"char","splitc":"\\n","name":"FRIGO SETSIM","x":1599.3333740234375,"y":4890,"wires":[["488ab59.176534c"]]},{"id":"7a341c93.f8b3e4","type":"switch","z":"dcdaf8f4.e91878","name":"","property":"payload.answer","propertyType":"msg","rules":[{"t":"eq","v":"DELIVERED","vt":"str"},{"t":"eq","v":"OK","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":729.3333740234375,"y":4790,"wires":[["524d6a1c.393a54","5dbb88be.0eeeb8","e7473be3.6124c8"],["b88d0ca0.22d8f"]]},{"id":"524d6a1c.393a54","type":"function","z":"dcdaf8f4.e91878","name":"prepare_message","func":"var message = msg.payload.message.split(\"_\");\nmsg.payload = {};\nmsg.payload = message[0] + \"_\" + message[1];\nreturn msg;","outputs":1,"noerr":0,"x":969.3333740234375,"y":4790,"wires":[["904e0c44.dff73"]]},{"id":"488ab59.176534c","type":"subflow:785d99ff.c78688","z":"dcdaf8f4.e91878","name":"","x":1799.3333740234375,"y":4890,"wires":[[],[]]},{"id":"c17ad467.8130b8","type":"mqtt out","z":"dcdaf8f4.e91878","name":"eshipping/vehicle/004/end","topic":"eshipping/vehicle/004/end","qos":"2","retain":"","broker":"3434a624.97253a","x":1219.3333740234375,"y":4230,"wires":[]},{"id":"90aff787.b093b8","type":"mqtt out","z":"dcdaf8f4.e91878","name":"eshipping/warehouse/dashboard/004","topic":"eshipping/warehouse/dashboard/004","qos":"2","retain":"","broker":"3434a624.97253a","x":1754.3333740234375,"y":4935,"wires":[]},{"id":"8092d895.a52468","type":"mqtt out","z":"dcdaf8f4.e91878","name":"eshipping/warehouse/dashboard/004","topic":"eshipping/warehouse/dashboard/004","qos":"2","retain":"","broker":"3434a624.97253a","x":1469.3333740234375,"y":4590,"wires":[]},{"id":"34875a2e.9e6cf6","type":"mqtt out","z":"dcdaf8f4.e91878","name":"eshipping/warehouse/dashboard/004","topic":"eshipping/warehouse/dashboard/004","qos":"2","retain":"","broker":"3434a624.97253a","x":1529.3333740234375,"y":4320,"wires":[]},{"id":"ecab47c7.905de8","type":"mqtt out","z":"dcdaf8f4.e91878","name":"eshipping/vehicle/004/end","topic":"eshipping/vehicle/004/end","qos":"2","retain":"","broker":"3434a624.97253a","x":1199.3333740234375,"y":4510,"wires":[]},{"id":"904e0c44.dff73","type":"mqtt out","z":"dcdaf8f4.e91878","name":"eshipping/vehicle/004/end","topic":"eshipping/vehicle/004/end","qos":"2","retain":"","broker":"3434a624.97253a","x":1219.3333740234375,"y":4790,"wires":[]},{"id":"7cc1da2c.ac8ec4","type":"function","z":"dcdaf8f4.e91878","name":"set_dashboard","func":"msg.payload = {};\nmsg.payload = \"FRAGILE \" + 0 + \"_\" + 0 + \"_\" + 0;\nreturn msg;","outputs":1,"noerr":0,"x":1152,"y":615,"wires":[["a854e21a.daa95"]]},{"id":"c9524702.472378","type":"function","z":"dcdaf8f4.e91878","name":"set_tmp_vib_null","func":"msg.payload = {};\n\nmsg.payload = \"STANDARD \" + 0 + \"_\" + 0;\nreturn msg;","outputs":1,"noerr":0,"x":1192,"y":330,"wires":[["e9fdaf53.bba5c"]]},{"id":"1db82448.26f46c","type":"function","z":"dcdaf8f4.e91878","name":"set_frigo_dashboard","func":"msg.payload = {};\nmsg.payload =\"FRIGO \" + 0 + \"_\" + 0 + \"_\" + 0 + \"_false_\" + 0; \n\n\nreturn msg;","outputs":1,"noerr":0,"x":1457,"y":930,"wires":[["f1f3d053.21cb6"]]},{"id":"d11b46a5.2b11a8","type":"function","z":"dcdaf8f4.e91878","name":"set_tmp_vib_null","func":"msg.payload = {};\n\nmsg.payload = \"STANDARD \" + 0 + \"_\" + 0;\nreturn msg;","outputs":1,"noerr":0,"x":1211,"y":1293,"wires":[["faa69f83.05cec"]]},{"id":"522ad4a2.21c12c","type":"function","z":"dcdaf8f4.e91878","name":"set_tmp_vib_null","func":"msg.payload = {};\n\nmsg.payload = \"STANDARD \" + 0 + \"_\" + 0;\nreturn msg;","outputs":1,"noerr":0,"x":1200,"y":2311,"wires":[["233f8d1e.a3bdd2"]]},{"id":"ca4c9a5c.1d0ec8","type":"function","z":"dcdaf8f4.e91878","name":"set_tmp_vib_null","func":"msg.payload = {};\n\nmsg.payload = \"STANDARD \" + 0 + \"_\" + 0;\nreturn msg;","outputs":1,"noerr":0,"x":1219,"y":3290,"wires":[["d15bf55d.543408"]]},{"id":"c295f9e7.1e6578","type":"function","z":"dcdaf8f4.e91878","name":"set_tmp_vib_null","func":"msg.payload = {};\n\nmsg.payload = \"STANDARD \" + 0 + \"_\" + 0;\nreturn msg;","outputs":1,"noerr":0,"x":1244.3333740234375,"y":4365,"wires":[["34875a2e.9e6cf6"]]},{"id":"a8f17045.efcc9","type":"function","z":"dcdaf8f4.e91878","name":"set_dashboard","func":"msg.payload = {};\nmsg.payload = \"FRAGILE \" + 0 + \"_\" + 0 + \"_\" + 0;\nreturn msg;","outputs":1,"noerr":0,"x":1156,"y":1578,"wires":[["a0db7188.a2c46"]]},{"id":"db4c0f3b.5cbb6","type":"function","z":"dcdaf8f4.e91878","name":"set_dashboard","func":"msg.payload = {};\nmsg.payload = \"FRAGILE \" + 0 + \"_\" + 0 + \"_\" + 0;\nreturn msg;","outputs":1,"noerr":0,"x":1160,"y":2596,"wires":[["c89daeaf.2efb3"]]},{"id":"521e960a.c7bb78","type":"function","z":"dcdaf8f4.e91878","name":"set_dashboard","func":"msg.payload = {};\nmsg.payload = \"FRAGILE \" + 0 + \"_\" + 0 + \"_\" + 0;\nreturn msg;","outputs":1,"noerr":0,"x":1164,"y":3575,"wires":[["3aac8af6.a0da86"]]},{"id":"40fda8c3.303bd8","type":"function","z":"dcdaf8f4.e91878","name":"set_dashboard","func":"msg.payload = {};\nmsg.payload = \"FRAGILE \" + 0 + \"_\" + 0 + \"_\" + 0;\nreturn msg;","outputs":1,"noerr":0,"x":1189.3333740234375,"y":4650,"wires":[["8092d895.a52468"]]},{"id":"ebc67da7.4db61","type":"function","z":"dcdaf8f4.e91878","name":"set_frigo_dashboard","func":"msg.payload = {};\nmsg.payload =\"FRIGO \" + 0 + \"_\" + 0 + \"_\" + 0 + \"_false_\" + 0; \n\n\nreturn msg;","outputs":1,"noerr":0,"x":1461,"y":1908,"wires":[["e7bca17b.c5ece"]]},{"id":"4dc95745.c63c28","type":"function","z":"dcdaf8f4.e91878","name":"set_frigo_dashboard","func":"var tmp = msg.payload.temp;\nvar hum = msg.payload.hum;\nvar alarm = msg.payload.alarmTmp;\nvar lat = msg.payload.lat;\nvar long = msg.payload.long;\nmsg.payload = {};\n\nif(alarm){\n    msg.payload =\"FRIGO \" + lat + \"_\" + long + \"_\" + tmp + \"_true_\" + hum; \n}else{\n    msg.payload =\"FRIGO \" + lat + \"_\" + long + \"_\" + tmp + \"_false_\" + hum; \n}\n\nreturn msg;","outputs":1,"noerr":0,"x":1461,"y":1863,"wires":[["e7bca17b.c5ece"]]},{"id":"aaec056e.7a49d8","type":"function","z":"dcdaf8f4.e91878","name":"set_frigo_dashboard","func":"msg.payload = {};\nmsg.payload =\"FRIGO \" + 0 + \"_\" + 0 + \"_\" + 0 + \"_false_\" + 0; \n\n\nreturn msg;","outputs":1,"noerr":0,"x":1465,"y":2911,"wires":[["209348f0.193948"]]},{"id":"becf3493.911ba8","type":"function","z":"dcdaf8f4.e91878","name":"set_frigo_dashboard","func":"var tmp = msg.payload.temp;\nvar hum = msg.payload.hum;\nvar alarm = msg.payload.alarmTmp;\nvar lat = msg.payload.lat;\nvar long = msg.payload.long;\nmsg.payload = {};\n\nif(alarm){\n    msg.payload =\"FRIGO \" + lat + \"_\" + long + \"_\" + tmp + \"_true_\" + hum; \n}else{\n    msg.payload =\"FRIGO \" + lat + \"_\" + long + \"_\" + tmp + \"_false_\" + hum; \n}\n\nreturn msg;","outputs":1,"noerr":0,"x":1465,"y":2866,"wires":[["209348f0.193948"]]},{"id":"5ea3bfd5.871b6","type":"function","z":"dcdaf8f4.e91878","name":"set_frigo_dashboard","func":"msg.payload = {};\nmsg.payload =\"FRIGO \" + 0 + \"_\" + 0 + \"_\" + 0 + \"_false_\" + 0; \n\n\nreturn msg;","outputs":1,"noerr":0,"x":1469,"y":3905,"wires":[["f753909d.69ed9"]]},{"id":"5dce4055.e567c","type":"function","z":"dcdaf8f4.e91878","name":"set_frigo_dashboard","func":"var tmp = msg.payload.temp;\nvar hum = msg.payload.hum;\nvar alarm = msg.payload.alarmTmp;\nvar lat = msg.payload.lat;\nvar long = msg.payload.long;\nmsg.payload = {};\n\nif(alarm){\n    msg.payload =\"FRIGO \" + lat + \"_\" + long + \"_\" + tmp + \"_true_\" + hum; \n}else{\n    msg.payload =\"FRIGO \" + lat + \"_\" + long + \"_\" + tmp + \"_false_\" + hum; \n}\n\nreturn msg;","outputs":1,"noerr":0,"x":1469,"y":3860,"wires":[["f753909d.69ed9"]]},{"id":"e7473be3.6124c8","type":"function","z":"dcdaf8f4.e91878","name":"set_frigo_dashboard","func":"msg.payload = {};\nmsg.payload =\"FRIGO \" + 0 + \"_\" + 0 + \"_\" + 0 + \"_false_\" + 0; \n\n\nreturn msg;","outputs":1,"noerr":0,"x":1479.3333740234375,"y":4980,"wires":[["90aff787.b093b8"]]},{"id":"22edd41d.c59c6c","type":"function","z":"dcdaf8f4.e91878","name":"set_frigo_dashboard","func":"var tmp = msg.payload.temp;\nvar hum = msg.payload.hum;\nvar alarm = msg.payload.alarmTmp;\nvar lat = msg.payload.lat;\nvar long = msg.payload.long;\nmsg.payload = {};\n\nif(alarm){\n    msg.payload =\"FRIGO \" + lat + \"_\" + long + \"_\" + tmp + \"_true_\" + hum; \n}else{\n    msg.payload =\"FRIGO \" + lat + \"_\" + long + \"_\" + tmp + \"_false_\" + hum; \n}\n\nreturn msg;","outputs":1,"noerr":0,"x":1479.3333740234375,"y":4935,"wires":[["90aff787.b093b8"]]},{"id":"50442ba9.c238c4","type":"function","z":"dcdaf8f4.e91878","name":"set_map","func":"var data = msg.payload.message.split(\"_\");\nmsg.payload = {};\nvar lat = data[0];\nvar long = data[1];\nmsg.payload = {};\nmsg.payload = \"MOVE_000_\" + lat + \"_\" + long;\nreturn msg;","outputs":1,"noerr":0,"x":1150.2857666015625,"y":527.6113891601562,"wires":[["d6641fa8.2e502"]]},{"id":"fe12fc4a.40881","type":"function","z":"dcdaf8f4.e91878","name":"set_map_delivered","func":"var message = msg.payload.message.split(\"_\");\nmsg.payload = {};\nmsg.payload = \"END_\" + message[0] + \"_\" + message[1];\nreturn msg;","outputs":1,"noerr":0,"x":929.142822265625,"y":414.0113525390625,"wires":[["d6641fa8.2e502"]]},{"id":"d6641fa8.2e502","type":"mqtt out","z":"dcdaf8f4.e91878","name":"eshipping/warehouse/dashboard/map","topic":"eshipping/warehouse/dashboard/map","qos":"2","retain":"","broker":"3434a624.97253a","x":1533,"y":415,"wires":[]},{"id":"9f0be9.c75fa418","type":"function","z":"dcdaf8f4.e91878","name":"set_map_delivered","func":"var message = msg.payload.message.split(\"_\");\nmsg.payload = {};\nmsg.payload = \"END_\" + message[0] + \"_\" + message[1];\nreturn msg;","outputs":1,"noerr":0,"x":933,"y":121,"wires":[["3f25221b.852f2e"]]},{"id":"52d4fb01.e17a44","type":"function","z":"dcdaf8f4.e91878","name":"set_map","func":"var data = msg.payload.message.split(\"_\");\nmsg.payload = {};\nvar lat = data[0];\nvar long = data[1];\nmsg.payload = {};\nmsg.payload = \"MOVE_000_\" + lat + \"_\" + long;\nreturn msg;","outputs":1,"noerr":0,"x":1177.1429443359375,"y":237.60003662109375,"wires":[["3f25221b.852f2e"]]},{"id":"3f25221b.852f2e","type":"mqtt out","z":"dcdaf8f4.e91878","name":"eshipping/warehouse/dashboard/map","topic":"eshipping/warehouse/dashboard/map","qos":"2","retain":"","broker":"3434a624.97253a","x":1549.857177734375,"y":121.9886474609375,"wires":[]},{"id":"6fa1a73d.59e108","type":"function","z":"dcdaf8f4.e91878","name":"set_map_delivered","func":"var message = msg.payload.message.split(\"_\");\nmsg.payload = {};\nmsg.payload = \"END_\" + message[0] + \"_\" + message[1];\nreturn msg;","outputs":1,"noerr":0,"x":973,"y":686,"wires":[["22e0116d.226ffe"]]},{"id":"39d7d361.efad3c","type":"function","z":"dcdaf8f4.e91878","name":"set_map","func":"var data = msg.payload.message.split(\"_\");\nmsg.payload = {};\nvar lat = data[0];\nvar long = data[1];\nmsg.payload = {};\nmsg.payload = \"MOVE_000_\" + lat + \"_\" + long;\nreturn msg;","outputs":1,"noerr":0,"x":1194.1429443359375,"y":799.6000366210937,"wires":[["22e0116d.226ffe"]]},{"id":"22e0116d.226ffe","type":"mqtt out","z":"dcdaf8f4.e91878","name":"eshipping/warehouse/dashboard/map","topic":"eshipping/warehouse/dashboard/map","qos":"2","retain":"","broker":"3434a624.97253a","x":1576.857177734375,"y":686.9886474609375,"wires":[]},{"id":"5b8655bd.85300c","type":"function","z":"dcdaf8f4.e91878","name":"set_map_delivered","func":"var message = msg.payload.message.split(\"_\");\nmsg.payload = {};\nmsg.payload = \"END_\" + message[0] + \"_\" + message[1];\nreturn msg;","outputs":1,"noerr":0,"x":944,"y":1113,"wires":[["fb1ca04b.db3d1"]]},{"id":"bd4580ce.87e5e","type":"function","z":"dcdaf8f4.e91878","name":"set_map","func":"var data = msg.payload.message.split(\"_\");\nmsg.payload = {};\nvar lat = data[0];\nvar long = data[1];\nmsg.payload = {};\nmsg.payload = \"MOVE_001_\" + lat + \"_\" + long;\nreturn msg;","outputs":1,"noerr":0,"x":1214.1429443359375,"y":1208.5999755859375,"wires":[["fb1ca04b.db3d1"]]},{"id":"fb1ca04b.db3d1","type":"mqtt out","z":"dcdaf8f4.e91878","name":"eshipping/warehouse/dashboard/map","topic":"eshipping/warehouse/dashboard/map","qos":"2","retain":"","broker":"3434a624.97253a","x":1521.857177734375,"y":1116.9886474609375,"wires":[]},{"id":"d81ca9bd.4abaf8","type":"function","z":"dcdaf8f4.e91878","name":"set_map_delivered","func":"var message = msg.payload.message.split(\"_\");\nmsg.payload = {};\nmsg.payload = \"END_\" + message[0] + \"_\" + message[1];\nreturn msg;","outputs":1,"noerr":0,"x":931,"y":1395,"wires":[["b5ff4e6f.4823d"]]},{"id":"3b6bd602.87e81a","type":"function","z":"dcdaf8f4.e91878","name":"set_map","func":"var data = msg.payload.message.split(\"_\");\nmsg.payload = {};\nvar lat = data[0];\nvar long = data[1];\nmsg.payload = {};\nmsg.payload = \"MOVE_001_\" + lat + \"_\" + long;\nreturn msg;","outputs":1,"noerr":0,"x":1201.1429443359375,"y":1490.5999755859375,"wires":[["b5ff4e6f.4823d"]]},{"id":"b5ff4e6f.4823d","type":"mqtt out","z":"dcdaf8f4.e91878","name":"eshipping/warehouse/dashboard/map","topic":"eshipping/warehouse/dashboard/map","qos":"2","retain":"","broker":"3434a624.97253a","x":1494.857177734375,"y":1395.9886474609375,"wires":[]},{"id":"7ece015b.fe0d5","type":"function","z":"dcdaf8f4.e91878","name":"set_map_delivered","func":"var message = msg.payload.message.split(\"_\");\nmsg.payload = {};\nmsg.payload = \"END_\" + message[0] + \"_\" + message[1];\nreturn msg;","outputs":1,"noerr":0,"x":947,"y":1675,"wires":[["bee7f9b6.874978"]]},{"id":"8fcaf6fb.ea6408","type":"function","z":"dcdaf8f4.e91878","name":"set_map","func":"var data = msg.payload.message.split(\"_\");\nmsg.payload = {};\nvar lat = data[0];\nvar long = data[1];\nmsg.payload = {};\nmsg.payload = \"MOVE_001_\" + lat + \"_\" + long;\nreturn msg;","outputs":1,"noerr":0,"x":1217.1429443359375,"y":1770.5999755859375,"wires":[["bee7f9b6.874978"]]},{"id":"bee7f9b6.874978","type":"mqtt out","z":"dcdaf8f4.e91878","name":"eshipping/warehouse/dashboard/map","topic":"eshipping/warehouse/dashboard/map","qos":"2","retain":"","broker":"3434a624.97253a","x":1524.857177734375,"y":1678.9886474609375,"wires":[]},{"id":"b185e4f6.4a4018","type":"function","z":"dcdaf8f4.e91878","name":"set_map_delivered","func":"var message = msg.payload.message.split(\"_\");\nmsg.payload = {};\nmsg.payload = \"END_\" + message[0] + \"_\" + message[1];\nreturn msg;","outputs":1,"noerr":0,"x":934,"y":2122,"wires":[["a0f29311.e477a"]]},{"id":"d88383b5.860e","type":"function","z":"dcdaf8f4.e91878","name":"set_map","func":"var data = msg.payload.message.split(\"_\");\nmsg.payload = {};\nvar lat = data[0];\nvar long = data[1];\nmsg.payload = {};\nmsg.payload = \"MOVE_002_\" + lat + \"_\" + long;\nreturn msg;","outputs":1,"noerr":0,"x":1204.1429443359375,"y":2217.5999755859375,"wires":[["a0f29311.e477a"]]},{"id":"a0f29311.e477a","type":"mqtt out","z":"dcdaf8f4.e91878","name":"eshipping/warehouse/dashboard/map","topic":"eshipping/warehouse/dashboard/map","qos":"2","retain":"","broker":"3434a624.97253a","x":1511.857177734375,"y":2125.9886474609375,"wires":[]},{"id":"b069b34e.1c1c5","type":"mqtt out","z":"dcdaf8f4.e91878","name":"eshipping/warehouse/dashboard/map","topic":"eshipping/warehouse/dashboard/map","qos":"2","retain":"","broker":"3434a624.97253a","x":1522,"y":2404,"wires":[]},{"id":"a5a57208.8cfa1","type":"function","z":"dcdaf8f4.e91878","name":"set_map","func":"var data = msg.payload.message.split(\"_\");\nmsg.payload = {};\nvar lat = data[0];\nvar long = data[1];\nmsg.payload = {};\nmsg.payload = \"MOVE_002_\" + lat + \"_\" + long;\nreturn msg;","outputs":1,"noerr":0,"x":1214.2857666015625,"y":2495.611328125,"wires":[["b069b34e.1c1c5"]]},{"id":"fbe2ec25.b989d","type":"function","z":"dcdaf8f4.e91878","name":"set_map_delivered","func":"var message = msg.payload.message.split(\"_\");\nmsg.payload = {};\nmsg.payload = \"END_\" + message[0] + \"_\" + message[1];\nreturn msg;","outputs":1,"noerr":0,"x":944.142822265625,"y":2400.0113525390625,"wires":[["b069b34e.1c1c5"]]},{"id":"4c285974.9dc0d8","type":"mqtt out","z":"dcdaf8f4.e91878","name":"eshipping/warehouse/dashboard/map","topic":"eshipping/warehouse/dashboard/map","qos":"2","retain":"","broker":"3434a624.97253a","x":1534,"y":2684,"wires":[]},{"id":"78008f90.d5ac4","type":"function","z":"dcdaf8f4.e91878","name":"set_map","func":"var data = msg.payload.message.split(\"_\");\nmsg.payload = {};\nvar lat = data[0];\nvar long = data[1];\nmsg.payload = {};\nmsg.payload = \"MOVE_002_\" + lat + \"_\" + long;\nreturn msg;","outputs":1,"noerr":0,"x":1226.2857666015625,"y":2775.611328125,"wires":[["4c285974.9dc0d8"]]},{"id":"5d0ccb1e.38e9c4","type":"function","z":"dcdaf8f4.e91878","name":"set_map_delivered","func":"var message = msg.payload.message.split(\"_\");\nmsg.payload = {};\nmsg.payload = \"END_\" + message[0] + \"_\" + message[1];\nreturn msg;","outputs":1,"noerr":0,"x":956.142822265625,"y":2680.0113525390625,"wires":[["4c285974.9dc0d8"]]},{"id":"9f169152.4bf31","type":"mqtt out","z":"dcdaf8f4.e91878","name":"eshipping/warehouse/dashboard/map","topic":"eshipping/warehouse/dashboard/map","qos":"2","retain":"","broker":"3434a624.97253a","x":1528,"y":3115,"wires":[]},{"id":"ae49cc24.35dec","type":"function","z":"dcdaf8f4.e91878","name":"set_map","func":"var data = msg.payload.message.split(\"_\");\nmsg.payload = {};\nvar lat = data[0];\nvar long = data[1];\nmsg.payload = {};\nmsg.payload = \"MOVE_003_\" + lat + \"_\" + long;\nreturn msg;","outputs":1,"noerr":0,"x":1220.2857666015625,"y":3206.611328125,"wires":[["9f169152.4bf31"]]},{"id":"e7bd210e.06d1c","type":"function","z":"dcdaf8f4.e91878","name":"set_map_delivered","func":"var message = msg.payload.message.split(\"_\");\nmsg.payload = {};\nmsg.payload = \"END_\" + message[0] + \"_\" + message[1];\nreturn msg;","outputs":1,"noerr":0,"x":950.142822265625,"y":3111.0113525390625,"wires":[["9f169152.4bf31"]]},{"id":"edee5a9.06857a8","type":"mqtt out","z":"dcdaf8f4.e91878","name":"eshipping/warehouse/dashboard/map","topic":"eshipping/warehouse/dashboard/map","qos":"2","retain":"","broker":"3434a624.97253a","x":1508,"y":3385,"wires":[]},{"id":"a4285cfc.0a5f1","type":"function","z":"dcdaf8f4.e91878","name":"set_map","func":"var data = msg.payload.message.split(\"_\");\nmsg.payload = {};\nvar lat = data[0];\nvar long = data[1];\nmsg.payload = {};\nmsg.payload = \"MOVE_003_\" + lat + \"_\" + long;\nreturn msg;","outputs":1,"noerr":0,"x":1200.2857666015625,"y":3476.611328125,"wires":[["edee5a9.06857a8"]]},{"id":"c8fddf55.8e482","type":"function","z":"dcdaf8f4.e91878","name":"set_map_delivered","func":"var message = msg.payload.message.split(\"_\");\nmsg.payload = {};\nmsg.payload = \"END_\" + message[0] + \"_\" + message[1];\nreturn msg;","outputs":1,"noerr":0,"x":930.142822265625,"y":3381.0113525390625,"wires":[["edee5a9.06857a8"]]},{"id":"a8f50520.4df0a8","type":"function","z":"dcdaf8f4.e91878","name":"set_map_delivered","func":"var message = msg.payload.message.split(\"_\");\nmsg.payload = {};\nmsg.payload = \"END_\" + message[0] + \"_\" + message[1];\nreturn msg;","outputs":1,"noerr":0,"x":949,"y":3665,"wires":[["93ab0a25.f40bd8"]]},{"id":"ae5a6889.916d48","type":"function","z":"dcdaf8f4.e91878","name":"set_map","func":"var data = msg.payload.message.split(\"_\");\nmsg.payload = {};\nvar lat = data[0];\nvar long = data[1];\nmsg.payload = {};\nmsg.payload = \"MOVE_003_\" + lat + \"_\" + long;\nreturn msg;","outputs":1,"noerr":0,"x":1219.1429443359375,"y":3760.5999755859375,"wires":[["93ab0a25.f40bd8"]]},{"id":"93ab0a25.f40bd8","type":"mqtt out","z":"dcdaf8f4.e91878","name":"eshipping/warehouse/dashboard/map","topic":"eshipping/warehouse/dashboard/map","qos":"2","retain":"","broker":"3434a624.97253a","x":1526.857177734375,"y":3668.9886474609375,"wires":[]},{"id":"2352d7dd.222bd8","type":"function","z":"dcdaf8f4.e91878","name":"set_map_delivered","func":"var message = msg.payload.message.split(\"_\");\nmsg.payload = {};\nmsg.payload = \"END_\" + message[0] + \"_\" + message[1];\nreturn msg;","outputs":1,"noerr":0,"x":968.3333740234375,"y":4180,"wires":[["4881b287.f4111c"]]},{"id":"9cbd8512.c18118","type":"function","z":"dcdaf8f4.e91878","name":"set_map","func":"var data = msg.payload.message.split(\"_\");\nmsg.payload = {};\nvar lat = data[0];\nvar long = data[1];\nmsg.payload = {};\nmsg.payload = \"MOVE_004_\" + lat + \"_\" + long;\nreturn msg;","outputs":1,"noerr":0,"x":1238.476318359375,"y":4275.5999755859375,"wires":[["4881b287.f4111c"]]},{"id":"4881b287.f4111c","type":"mqtt out","z":"dcdaf8f4.e91878","name":"eshipping/warehouse/dashboard/map","topic":"eshipping/warehouse/dashboard/map","qos":"2","retain":"","broker":"3434a624.97253a","x":1546.1905517578125,"y":4183.9886474609375,"wires":[]},{"id":"11701e0f.00b122","type":"function","z":"dcdaf8f4.e91878","name":"set_map_delivered","func":"var message = msg.payload.message.split(\"_\");\nmsg.payload = {};\nmsg.payload = \"END_\" + message[0] + \"_\" + message[1];\nreturn msg;","outputs":1,"noerr":0,"x":961.3333740234375,"y":4456,"wires":[["27571b5.901eee4"]]},{"id":"b301328.eadf1d","type":"function","z":"dcdaf8f4.e91878","name":"set_map","func":"var data = msg.payload.message.split(\"_\");\nmsg.payload = {};\nvar lat = data[0];\nvar long = data[1];\nmsg.payload = {};\nmsg.payload = \"MOVE_004_\" + lat + \"_\" + long;\nreturn msg;","outputs":1,"noerr":0,"x":1231.476318359375,"y":4551.5999755859375,"wires":[["27571b5.901eee4"]]},{"id":"27571b5.901eee4","type":"mqtt out","z":"dcdaf8f4.e91878","name":"eshipping/warehouse/dashboard/map","topic":"eshipping/warehouse/dashboard/map","qos":"2","retain":"","broker":"3434a624.97253a","x":1539.1905517578125,"y":4459.9886474609375,"wires":[]},{"id":"5dbb88be.0eeeb8","type":"function","z":"dcdaf8f4.e91878","name":"set_map_delivered","func":"var message = msg.payload.message.split(\"_\");\nmsg.payload = {};\nmsg.payload = \"END_\" + message[0] + \"_\" + message[1];\nreturn msg;","outputs":1,"noerr":0,"x":971.3333740234375,"y":4747,"wires":[["7df98c2c.21bf44"]]},{"id":"3a02c0d1.a4dc7","type":"function","z":"dcdaf8f4.e91878","name":"set_map","func":"var data = msg.payload.message.split(\"_\");\nmsg.payload = {};\nvar lat = data[0];\nvar long = data[1];\nmsg.payload = {};\nmsg.payload = \"MOVE_004_\" + lat + \"_\" + long;\nreturn msg;","outputs":1,"noerr":0,"x":1241.476318359375,"y":4842.5999755859375,"wires":[["7df98c2c.21bf44"]]},{"id":"7df98c2c.21bf44","type":"mqtt out","z":"dcdaf8f4.e91878","name":"eshipping/warehouse/dashboard/map","topic":"eshipping/warehouse/dashboard/map","qos":"2","retain":"","broker":"3434a624.97253a","x":1549.1905517578125,"y":4750.9886474609375,"wires":[]}]